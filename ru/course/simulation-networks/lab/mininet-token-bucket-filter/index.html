<!DOCTYPE html>
<!-- This site was created with Wowchemy. https://www.wowchemy.com -->
<!-- Last Published: 17 января 2023 г. --><html lang="ru-ru" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.7.0 for Hugo" />
  

  
  












  
  










  







  
  

  
  
  

  
  

  
  
    
    <script src="https://yamadharma.github.io/js/mathjax-config.js"></script>
  

  

  <link rel="stylesheet" href="https://yamadharma.github.io/css/vendor-bundle.min.16f785cdb553c8c4431db6775122af35.css" media="print" onload="this.media='all'">

  
  
  
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.2/css/academicons.min.css" integrity="sha512-KlJCpRsLf+KKu2VQa5vmRuClRFjxc5lXO03ixZt82HZUk41+1I0bD8KBSA0fY290ayMfWYI9udIqeOWSu1/uZg==" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    
    
    
    
      
      
    
    
    

    
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.css" integrity="" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  
  <link rel="stylesheet" href="https://yamadharma.github.io/css/wowchemy.b94444cb4d6a9c84f702b833d5ebaae4.css" />

  
  
  
  
  
  
  
    
    
    <link rel="stylesheet" href="https://yamadharma.github.io/css/libs/chroma/github-light.min.css" title="hl-light" media="print" onload="this.media='all'" >
    <link rel="stylesheet" href="https://yamadharma.github.io/css/libs/chroma/dracula.min.css" title="hl-dark" media="print" onload="this.media='all'" disabled>
  

  
  






<script async src="https://www.googletagmanager.com/gtag/js?id=UA-162854716-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
      dataLayer.push(arguments);
  }

  function trackOutboundLink(url, target) {
    gtag('event', 'click', {
         'event_category': 'outbound',
         'event_label': url,
         'transport_type': 'beacon',
         'event_callback': function () {
           if (target !== '_blank') {
             document.location = url;
           }
         }
    });
    console.debug("Outbound link clicked: " + url);
  }

  function onClickCallback(event) {
    if ((event.target.tagName !== 'A') || (event.target.host === window.location.host)) {
      return;
    }
    trackOutboundLink(event.target, event.target.getAttribute('target'));  
  }

  gtag('js', new Date());
  gtag('config', 'UA-162854716-1', { 'anonymize_ip': true });
  gtag('set', {'cookie_flags': 'SameSite=None;Secure'});

  
  document.addEventListener('click', onClickCallback, false);
</script>























  
  
  






  <meta name="author" content="Дмитрий Сергеевич Кулябов" />





  

<meta name="description" content="Управление пропускной способностью с помощью дисциплина очередей Token Bucket Filter (TBF)" />



<link rel="alternate" hreflang="ru-ru" href="https://yamadharma.github.io/ru/course/simulation-networks/lab/mininet-token-bucket-filter/" />
<link rel="canonical" href="https://yamadharma.github.io/ru/course/simulation-networks/lab/mininet-token-bucket-filter/" />



  <link rel="manifest" href="https://yamadharma.github.io/ru/manifest.webmanifest" />



<link rel="icon" type="image/png" href="https://yamadharma.github.io/media/icon_hu0a661dd90139895e92e2f18ae9404407_611148_32x32_fill_lanczos_center_3.png" />
<link rel="apple-touch-icon" type="image/png" href="https://yamadharma.github.io/media/icon_hu0a661dd90139895e92e2f18ae9404407_611148_180x180_fill_lanczos_center_3.png" />

<meta name="theme-color" content="#1565c0" />










  
  






<meta property="twitter:card" content="summary" />

  <meta property="twitter:site" content="@dskulyabov" />
  <meta property="twitter:creator" content="@dskulyabov" />
<meta property="twitter:image" content="https://yamadharma.github.io/media/icon_hu0a661dd90139895e92e2f18ae9404407_611148_512x512_fill_lanczos_center_3.png" />
<meta property="og:site_name" content="Д. С. Кулябов" />
<meta property="og:url" content="https://yamadharma.github.io/ru/course/simulation-networks/lab/mininet-token-bucket-filter/" />
<meta property="og:title" content="Mininet. Token Bucket Filter | Д. С. Кулябов" />
<meta property="og:description" content="Управление пропускной способностью с помощью дисциплина очередей Token Bucket Filter (TBF)" /><meta property="og:image" content="https://yamadharma.github.io/media/icon_hu0a661dd90139895e92e2f18ae9404407_611148_512x512_fill_lanczos_center_3.png" /><meta property="og:locale" content="ru-ru" />

  
    <meta
      property="article:published_time"
      content="2022-10-19T19:51:00&#43;03:00"
    />
  
  
    <meta property="article:modified_time" content="2022-11-25T16:53:00&#43;03:00">
  







  




  
  
  

  
  

  
  
  
  
  
    <script src="https://cdn.jsdelivr.net/gh/osano/cookieconsent@3.1.1/build/cookieconsent.min.js" integrity="sha512-yXXqOFjdjHNH1GND+1EO0jbvvebABpzGKD66djnUfiKlYME5HGMUJHoCaeE4D5PTG2YsSJf6dwqyUUvQvS0vaA==" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/osano/cookieconsent@3.1.1/build/cookieconsent.min.css" integrity="sha512-LQ97camar/lOliT/MqjcQs5kWgy6Qz/cCRzzRzUCfv0fotsCTC9ZHXaPQmJV8Xu/PVALfJZ7BDezl5lW3/qBxg==" crossorigin="anonymous">
  
  <script>
  window.addEventListener("load", function(){
    window.cookieconsent.initialise({
      "palette": {
        "popup": {
          "background": "#1565c0",
          "text": "rgb(255, 255, 255)"
        },
        "button": {
          "background": "rgb(255, 255, 255)",
          "text": "#1565c0"
        }
      },
      "theme": "classic",
      "content": {
        "message": "Для комфорной навигации на этом сайте используются куки (cookies).",
        "dismiss": "Понял!",
        "link": "Узнать больше",
        "href": "https://www.cookiesandyou.com"
      }
    })});
  </script>



  
  <title>Mininet. Token Bucket Filter | Д. С. Кулябов</title>

  
  
  
  











</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="4c7cebd5234a03b4dfa43a53de4e8c8b" >

  
  
  
  
  
  
  
  
  
  <script src="https://yamadharma.github.io/js/wowchemy-init.min.ec9d49ca50e4b80bdb08f0417a28ed84.js"></script>

  


<aside class="search-modal" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Поиск</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#" aria-label="Close"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Поиск ..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control"
        aria-label="Поиск ...">
        
      </div>

      
      

      

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>



  <div class="page-header header--fixed">
    












<header>
  <nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
    <div class="container-xl">

      
      <div class="d-none d-lg-inline-flex">
        <a class="navbar-brand" href="https://yamadharma.github.io/ru/">Д. С. Кулябов</a>
      </div>
      

      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="Переключить навигацию">
      <span><i class="fas fa-bars"></i></span>
      </button>
      

      
      <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
        <a class="navbar-brand" href="https://yamadharma.github.io/ru/">Д. С. Кулябов</a>
      </div>
      

      
      
      <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

        
        <ul class="navbar-nav d-md-inline-flex">
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="https://yamadharma.github.io/ru/#about"><span>Обо мне</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="https://yamadharma.github.io/ru/#posts"><span>Блог</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="https://yamadharma.github.io/ru/#projects"><span>Проекты</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="https://yamadharma.github.io/ru/#featured"><span>Публикации</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
          

          <li class="nav-item">
            <a class="nav-link  active" href="https://yamadharma.github.io/ru/course/"><span>Курсы</span></a>
          </li>

          
          

          

          
          
          
            
          

          

          
          
          
          

          
            
              
              
            
            
              
              
              
                
              
              
            
          

          <li class="nav-item">
            <a class="nav-link " href="https://yamadharma.github.io/ru/#contact"><span>Контакты</span></a>
          </li>

          
          

        

          
        </ul>
      </div>

      <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

        
        
          
        

        
        
        
        <li class="nav-item">
          <a class="nav-link js-search" href="#" aria-label="Поиск"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        
        
        
        <li class="nav-item dropdown theme-dropdown">
          <a href="#" class="nav-link" data-toggle="dropdown" aria-haspopup="true" aria-label="Display preferences">
            <i class="fas fa-moon" aria-hidden="true"></i>
          </a>
          <div class="dropdown-menu">
            <a href="#" class="dropdown-item js-set-theme-light">
              <span>Light</span>
            </a>
            <a href="#" class="dropdown-item js-set-theme-dark">
              <span>Dark</span>
            </a>
            <a href="#" class="dropdown-item js-set-theme-auto">
              <span>Automatic</span>
            </a>
          </div>
        </li>
        

        
        

      </ul>

    </div>
  </nav>
</header>


  </div>

  <div class="page-body">
    
    
    

    




<div class="container-fluid docs">
  <div class="row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
      <form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <div class="d-flex">
      <span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">
        
        
          Лабораторные работы
        
      </span>
      <span><i class="fas fa-chevron-down"></i></span>
    </div>
  </button>

  
  <button class="form-control sidebar-search js-search d-none d-md-flex">
    <i class="fas fa-search pr-2"></i>
    <span class="sidebar-search-text">Поиск ...</span>
    <span class="sidebar-search-shortcut">/</span>
  </button>
  
</form>

<nav class="collapse docs-links" id="docs-nav">
  
  
  
  
  
  

  
  
    

    
      

      <ul class="nav docs-sidenav">
        <li><a href="https://yamadharma.github.io/ru/course/"><i class="fas fa-arrow-left pr-1"></i>Курсы</a></li>
      </ul>

      
      
        
          
        
      


  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="https://yamadharma.github.io/ru/course/simulation-networks/">Моделирование сетей передачи данных</a>
    
      
        <ul class="nav docs-sidenav">
      


  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="https://yamadharma.github.io/ru/course/simulation-networks/lab/">Лабораторные работы</a>
    
      
        <ul class="nav docs-sidenav">
      


  <li class=""><a href="https://yamadharma.github.io/ru/course/simulation-networks/lab/mininet-intro/">Введение в Mininet</a></li>



  <li class=""><a href="https://yamadharma.github.io/ru/course/simulation-networks/lab/mininet-iperf-intro/">Введение в Iperf</a></li>



  <li class=""><a href="https://yamadharma.github.io/ru/course/simulation-networks/lab/mininet-netem-i/">Использование netem (latency, jitter)</a></li>



  <li class=""><a href="https://yamadharma.github.io/ru/course/simulation-networks/lab/mininet-netem-ii/">Использование netem (потери пакетов)</a></li>



  <li class="active"><a href="https://yamadharma.github.io/ru/course/simulation-networks/lab/mininet-token-bucket-filter/">Token Bucket Filter</a></li>

      
        </ul>
      
    

    
      </div>
    

      
        </ul>
      
    

    
      </div>
    

    
  
</nav>

    </div>

    
    
    <div class="d-none d-xl-block col-xl-2 docs-toc">
      












      <ul class="nav toc-top">
        <li><a href="#" id="back_to_top" class="docs-toc-title">На этой странице</a></li>
      </ul>

      <nav id="TableOfContents">
  <ul>
    <li><a href="#общая-информация"><span class="section-num">1</span> Общая информация</a>
      <ul>
        <li><a href="#цели"><span class="section-num">1.1</span> Цели</a></li>
        <li><a href="#задачи"><span class="section-num">1.2</span> Задачи</a></li>
        <li><a href="#видео-token-bucket-filter-dot-введение"><span class="section-num">1.3</span> Видео: Token Bucket Filter. Введение</a></li>
      </ul>
    </li>
    <li><a href="#теоретические-сведения"><span class="section-num">2</span> Теоретические сведения</a>
      <ul>
        <li><a href="#введение-в-алгоритм-token-bucket"><span class="section-num">2.1</span> Введение в алгоритм Token Bucket</a></li>
        <li><a href="#основной-синтаксис-tbf"><span class="section-num">2.2</span> Основной синтаксис tbf</a></li>
      </ul>
    </li>
    <li><a href="#подготовка-стенда"><span class="section-num">3</span> Подготовка стенда</a>
      <ul>
        <li><a href="#лабораторная-топология"><span class="section-num">3.1</span> Лабораторная топология</a></li>
        <li><a href="#рабочие-файлы"><span class="section-num">3.2</span> Рабочие файлы</a></li>
      </ul>
    </li>
    <li><a href="#интерактивный-эксперимент"><span class="section-num">4</span> Интерактивный эксперимент</a>
      <ul>
        <li><a href="#отсутствие-ограничения-скорости"><span class="section-num">4.1</span> Отсутствие ограничения скорости</a></li>
        <li><a href="#ограничение-скорости-на-конечных-хостах"><span class="section-num">4.2</span> Ограничение скорости на конечных хостах</a>
          <ul>
            <li><a href="#определим-интерфейс-хостов-h1-и-h2"><span class="section-num">4.2.1</span> Определим интерфейс хостов <code>h1</code> и <code>h2</code></a></li>
            <li><a href="#эмуляция-глобальной-сети-10-гбит-с-с-высокой-задержкой"><span class="section-num">4.2.2</span> Эмуляция глобальной сети 10 Гбит/с с высокой задержкой</a></li>
          </ul>
        </li>
        <li><a href="#ограничение-скорости-на-коммутаторах"><span class="section-num">4.3</span> Ограничение скорости на коммутаторах</a></li>
        <li><a href="#объединение-netem-и-tbf"><span class="section-num">4.4</span> Объединение NETEM и TBF</a></li>
        <li><a href="#видео-token-bucket-filter-dot-интерактивный-эксперимент"><span class="section-num">4.5</span> Видео: Token Bucket Filter. Интерактивный эксперимент</a></li>
      </ul>
    </li>
  </ul>
</nav>

      











    </div>
    

    <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role="main">

      <div class="docs-article-container">
        
          
  <nav class="d-none d-md-flex" aria-label="breadcrumb">
    <ol class="breadcrumb">
      
  
    
  
    
  
    
  
    
  

    <li class="breadcrumb-item">
      <a href="https://yamadharma.github.io/ru/">
        
          Home
        
      </a>
    </li>
  

    <li class="breadcrumb-item">
      <a href="https://yamadharma.github.io/ru/course/">
        
          Курсы
        
      </a>
    </li>
  

    <li class="breadcrumb-item">
      <a href="https://yamadharma.github.io/ru/course/simulation-networks/">
        
          Моделирование сетей передачи данных
        
      </a>
    </li>
  

    <li class="breadcrumb-item">
      <a href="https://yamadharma.github.io/ru/course/simulation-networks/lab/">
        
          Лабораторные работы
        
      </a>
    </li>
  

      <li class="breadcrumb-item active" aria-current="page">
        Token Bucket Filter
      </li>
    </ol>
  </nav>




        
      </div>

      
      
      

      <div class="docs-article-container">
        
        <h1>Mininet. Token Bucket Filter</h1>

        <article class="article-style">

          
          

          <p>Управление пропускной способностью с помощью дисциплина очередей Token Bucket Filter (TBF).</p>
<h2 id="общая-информация"><span class="section-num">1</span> Общая информация</h2>
<h3 id="цели"><span class="section-num">1.1</span> Цели</h3>
<ul>
<li>Освоить использование дисциплины очередей Token Bucket Filter (TBF).</li>
</ul>
<h3 id="задачи"><span class="section-num">1.2</span> Задачи</h3>
<ul>
<li>Получить понятие об алгоритме Token Bucket.</li>
<li>Использовать Token Bucket Filter (tbf) в Linux.</li>
<li>Понять, как комбинировать дисциплины очередей в Linux Traffic Control (tc).</li>
<li>Объединить tbf и NETEM.</li>
<li>Эмулируйте свойства WAN в Mininet.</li>
</ul>
<h3 id="видео-token-bucket-filter-dot-введение"><span class="section-num">1.3</span> Видео: Token Bucket Filter. Введение</h3>
<nav>
	<div class="nav nav-tabs" id="nav-tab" role="tablist">

		
		
		
		

		

		<a class="nav-item nav-link  active "
		   id="nav-facedb" data-toggle="tab" href="#facedb"
		   role="tab" aria-controls="nav-home" aria-selected="true">RuTube</a>

		

		<a class="nav-item nav-link "
		   id="nav-ebdfac" data-toggle="tab" href="#ebdfac"
		   role="tab" aria-controls="nav-home" aria-selected="true">Youtube</a>

		

	</div>
</nav>

<div class="tab-content" id="nav-tab-content">

	





<div class="tab-pane fade show active " id="facedb" role="tabpanel" aria-labelledby="nav-1">

	

<div class="embed video-player">
  <iframe class="rutube-player" type="text/html"
	  width="720" height="405"
	  src="https://rutube.ru/play/embed/844474172fbad39a5f8a7ffc8a927a44"
	  webkitAllowFullScreen mozallowfullscreen allowFullScreen
	  allow="clipboard-write" frameborder="0">
  </iframe>
</div>




</div>






<div class="tab-pane fade show " id="ebdfac" role="tabpanel" aria-labelledby="nav-1">

	


<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/9mqs0aw4tQE" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>




</div>



</div>
<h2 id="теоретические-сведения"><span class="section-num">2</span> Теоретические сведения</h2>
<h3 id="введение-в-алгоритм-token-bucket"><span class="section-num">2.1</span> Введение в алгоритм Token Bucket</h3>
<ul>
<li>При моделировании глобальной сети (WAN) иногда необходимо ограничить пропускную способность устройств (конечных хостов и сетевых устройств), чтобы наблюдать за поведением сети в различных условиях.</li>
<li>Token Bucket &mdash; это алгоритм, используемый в сетях с коммутацией пакетов для ограничения пропускной способности и пиковой нагрузки трафика.</li>
<li>Сущность Token Bucket состоит в добавлении токенов (представленных в виде пакетов или байтов) с фиксированной скоростью в буфер (<em>ведро</em>) с фиксированной ёмкостью.</li>
<li>Когда приходит новый пакет длиной \(n\) байт, буфер (ведро) проверяется на количество доступных токенов; если доступно хотя бы \(n\) токенов, \(n\) токенов удаляются из ведра, и пакет отправляется в сеть.</li>
<li>В противном случае токены не удаляются, и пакет считается несоответствующим. В таком случае пакет может быть отброшен, поставлен в очередь или передан, но помечен как несоответствующий.</li>
<li>Параметры алгоритма:
<ul>
<li><code>rate</code> есть скорость передачи; она определяется частотой, с которой токены добавляются в корзину.</li>
<li><em>Burstiness</em> (всплеск):  когда ведро полностью занято (т. е. никакие пакеты не потребляют токены), новые пакеты будут потреблять токены сразу, без ограничений. Всплеск определяется как количество токенов, которые могут поместиться в ведро (или размер ведра).</li>
<li>Иногда создаётся ещё одно маленькое ведро, с размером, равным максимально передаваемому элементу (Maximum Transmission Unit &mdash; MTU). Скорость обработки этого буфера намного превышает исходную (peak rate &mdash; пиковая скорость).</li>
</ul>
</li>
</ul>
<h3 id="основной-синтаксис-tbf"><span class="section-num">2.2</span> Основной синтаксис tbf</h3>
<ul>
<li>Основной синтаксис <code>tbf</code>, используемый с <code>tc</code>, следующий:
<pre><code class="language-shell">tc qdisc [add | ...] dev [dev_id] root tbf limit [BYTES] burst [BYTES] rate [BPS] [mtu BYTES] [ peakrate BPS ] [ latency TIME ]
</code></pre>
</li>
<li>Здесь:
<ul>
<li><code>tc</code> : инструмент управления трафиком Linux;</li>
<li><code>qdisc</code> : дисциплина очереди (qdisc) представляет собой набор правил, определяющих порядок, в котором обслуживаются пакеты, поступающие с выходных данных IP-протокола. Дисциплина очереди применяется к очереди пакетов, чтобы решить, когда отправлять каждый пакет;</li>
<li><code>[add | del | replace | change | show]</code> : операция над <code>qdisc</code>;</li>
<li><code>dev [dev_id]</code>: задаёт интерфейс;</li>
<li><code>tbf</code> : указывает, что используется алгоритм <em>Token Bucket Filter</em>;</li>
<li><code>limit [BYTES]</code> : размер очереди пакетов в байтах;</li>
<li><code>burst [BYTES]</code> : количество байтов, которое может поместиться в корзину;</li>
<li><code>rate [BPS]</code>: скорость передачи, определяемая частотой, с которой токены добавляются в корзину;</li>
<li><code>mtu [BYTES]</code> : максимальная единица передачи в байтах;</li>
<li><code>peakrate [BPS]</code> (пиковая скорость [бит/с]): максимальная скорость пакета;</li>
<li><code>latency [TIME]</code> : максимальное время ожидания пакета в очереди.</li>
</ul>
</li>
</ul>
<h2 id="подготовка-стенда"><span class="section-num">3</span> Подготовка стенда</h2>
<h3 id="лабораторная-топология"><span class="section-num">3.1</span> Лабораторная топология</h3>
<ul>
<li>
<p>В топологии используется сеть 10.0.0.0/8, назначенная Mininet по умолчанию.</p>
</li>
<li>
<p>Топология представляет собой коммутатор с двумя подключёнными к нему хостами.</p>
</li>
<li>
<p>Для запуска топологии (рис. <a href="#figure--fig:tbf:topology">1</a>) используем параметры командной строки:</p>
<pre><code class="language-shell">sudo mn --topo=linear,2 -x
</code></pre>
<p><a id="figure--fig:tbf:topology"></a></p>
<figure>
<svg
xmlns="http://www.w3.org/2000/svg"
xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css"
height="120px" preserveAspectRatio="none"
style="width:690px;height:120px;background:#FFFFFF;" version="1.1"
viewBox="0 0 690 120" width="690px"
zoomAndPan="magnify"><defs/><g><g id="elem_h1"><polygon fill="#F1F1F1"
points="9.5,7,9.5,7.2102,19.5,6.5857,29.5,7.1933,39.5,7.3997,49.5,6.2866,59.5,6.9223,69.5,7,69.4456,6.8687,69.8046,7.0283,70.1984,7.2719,70.4725,7.2264,70.9848,7.7563,71.2678,7.7322,71.0737,7.6518,71.3533,8.0606,71.6937,8.4944,71.6807,8.782,71.8746,9.1552,72,9.5,71.9681,9.5,72.1785,19.7318,72.2391,29.9635,72.5857,40.1953,72.6711,50.427,72.6793,60.6588,72.2546,70.8905,72.4636,81.1223,72.7022,91.354,71.2788,101.5858,72,111.8175,72.209,111.9041,71.7622,112.1332,71.8715,112.5927,71.4082,112.815,71.3931,113.223,71.2678,113.5853,71.3624,113.8137,70.908,113.7167,70.5741,113.9106,70.2503,114.1289,69.9066,114.2992,69.5,114.3175,69.5,114.3136,59.5,114.6047,49.5,113.7451,39.5,114.6019,29.5,114.8657,19.5,114.762,9.5,114.3175,9.5782,114.5063,9.0848,114.0223,8.7097,113.8238,8.3601,113.6868,8.0783,113.7136,7.7322,113.5853,7.6717,113.5602,7.7956,113.3186,7.3855,112.8559,7.1872,112.4809,7.2167,112.2002,7,111.8175,6.3332,111.8175,6.4809,101.5858,7.649,91.354,7.4357,81.1223,7.7345,70.8905,6.6782,60.6588,7.3192,50.427,7.5904,40.1953,6.5276,29.9635,6.9041,19.7318,7,9.5,7.0388,9.5161,7.3472,9.2296,7.2916,8.7924,7.5818,8.4983,7.4152,8.0151,7.7322,7.7322,7.6458,7.5237,8.15,7.7409,8.3479,7.2186,8.8578,7.4496,9.1728,7.2101,9.5,7"
style="stroke:#181818;stroke-width:0.5;"/><image height="48"
width="45" x="17"
xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAwCAIAAAAKMGSIAAABA0lEQVR42u2Z0Q3DIAxEsyIjMAIjdARGYARG6AiM0BG6QU9FQlEkiE0MJarvLwpOHuYi2c72XkPbWhwpJeec4QtRiBXj6IMoKGIc5pqUYwJHomk4BzFS/aEcyqEcN+Lw3j+bmsEhUl5c5Qgh4C52bMYImSZxiLinrXysDA4vrfzYGCOPQ9wTyqEcyqEcgzgeO/2Soxbwr/lQn67JUQtAbRZFdcLx2mlCPUY6l7yosIurfJLn9XrJCn0cwo2l9i9wRmMw1Jg4Du/nQIY6GxBlx8jwYY21ls3B8vkh27isGQhFObEN65xr48X2K3oKsbi4Uoyje/5cc24nRz4Lrhod+Sr/Gz6joejQ6zC0iQAAAABJRU5ErkJggg=="
y="17"/><text fill="#000000" font-family="xkcd Script" font-size="14"
lengthAdjust="spacing" textLength="10" x="36.5"
y="80.2429">h1</text><text fill="#000000" font-family="xkcd Script"
font-size="14" lengthAdjust="spacing" textLength="39" x="20"
y="99.9017">10.0.0.1</text></g><g id="elem_h2"><polygon fill="#F1F1F1"
points="621.5,7,621.5,7.2102,631.5,6.5857,641.5,7.1933,651.5,7.3997,661.5,6.2866,671.5,6.9223,681.5,7,681.4456,6.8687,681.8046,7.0283,682.1984,7.2719,682.4725,7.2264,682.9848,7.7563,683.2678,7.7322,683.0737,7.6518,683.3533,8.0606,683.6937,8.4944,683.6807,8.782,683.8746,9.1552,684,9.5,683.9681,9.5,684.1785,19.7318,684.2391,29.9635,684.5857,40.1953,684.6711,50.427,684.6793,60.6588,684.2546,70.8905,684.4636,81.1223,684.7022,91.354,683.2788,101.5858,684,111.8175,684.209,111.9041,683.7622,112.1332,683.8715,112.5927,683.4082,112.815,683.3931,113.223,683.2678,113.5853,683.3624,113.8137,682.908,113.7167,682.5741,113.9106,682.2503,114.1289,681.9066,114.2992,681.5,114.3175,681.5,114.3136,671.5,114.6047,661.5,113.7451,651.5,114.6019,641.5,114.8657,631.5,114.762,621.5,114.3175,621.5782,114.5063,621.0848,114.0223,620.7097,113.8238,620.3601,113.6868,620.0783,113.7136,619.7322,113.5853,619.6717,113.5602,619.7956,113.3186,619.3855,112.8559,619.1872,112.4809,619.2167,112.2002,619,111.8175,618.3332,111.8175,618.4809,101.5858,619.649,91.354,619.4357,81.1223,619.7345,70.8905,618.6782,60.6588,619.3192,50.427,619.5904,40.1953,618.5276,29.9635,618.9041,19.7318,619,9.5,619.0388,9.5161,619.3472,9.2296,619.2916,8.7924,619.5818,8.4983,619.4152,8.0151,619.7322,7.7322,619.6458,7.5237,620.15,7.7409,620.3479,7.2186,620.8578,7.4496,621.1728,7.2101,621.5,7"
style="stroke:#181818;stroke-width:0.5;"/><image height="48"
width="45" x="629"
xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAwCAIAAAAKMGSIAAABA0lEQVR42u2Z0Q3DIAxEsyIjMAIjdARGYARG6AiM0BG6QU9FQlEkiE0MJarvLwpOHuYi2c72XkPbWhwpJeec4QtRiBXj6IMoKGIc5pqUYwJHomk4BzFS/aEcyqEcN+Lw3j+bmsEhUl5c5Qgh4C52bMYImSZxiLinrXysDA4vrfzYGCOPQ9wTyqEcyqEcgzgeO/2Soxbwr/lQn67JUQtAbRZFdcLx2mlCPUY6l7yosIurfJLn9XrJCn0cwo2l9i9wRmMw1Jg4Du/nQIY6GxBlx8jwYY21ls3B8vkh27isGQhFObEN65xr48X2K3oKsbi4Uoyje/5cc24nRz4Lrhod+Sr/Gz6joejQ6zC0iQAAAABJRU5ErkJggg=="
y="17"/><text fill="#000000" font-family="xkcd Script" font-size="14"
lengthAdjust="spacing" textLength="15" x="646"
y="80.2429">h2</text><text fill="#000000" font-family="xkcd Script"
font-size="14" lengthAdjust="spacing" textLength="44" x="629.5"
y="99.9017">10.0.0.2</text></g><g id="elem_s1"><polygon fill="#F1F1F1"
points="197.5,31.5,197.5,31.7102,208,31.0857,218.5,31.6933,229,31.8997,239.5,30.7866,250,31.4223,260.5,31.5,260.4456,31.3687,260.8046,31.5283,261.1984,31.7719,261.4725,31.7264,261.9848,32.2563,262.2678,32.2322,262.0737,32.1518,262.3533,32.5606,262.6937,32.9944,262.6807,33.282,262.8746,33.6552,263,34,262.9681,34,263.1785,44.5318,263.2391,55.0635,263.5857,65.5953,263.6711,76.127,263,86.6588,263.2092,86.7454,262.932,87.0448,262.8499,87.425,262.7769,87.809,262.1921,87.981,262.2678,88.4265,262.3543,88.6355,261.8764,88.4817,261.6288,88.8838,261.144,88.7134,260.8448,88.9912,260.5,89.1588,260.5,89.9004,250,89.11,239.5,89.2641,229,89.4974,218.5,89.575,208,89.1549,197.5,89.1588,197.5366,89.2472,197.0734,88.836,196.8292,88.9534,196.5093,88.8882,196.1425,88.7099,195.7322,88.4265,195.921,88.5047,195.437,88.0113,195.2385,87.6362,195.1015,87.2866,195.1283,87.0048,195,86.6588,194.8035,86.6588,195.6814,76.127,194.8253,65.5953,194.6569,55.0635,195.2283,44.5318,195,34,194.7946,33.9149,194.9866,33.5802,195.4927,33.3757,195.5735,32.9949,195.812,32.6795,195.7322,32.2322,195.6912,32.1331,196.1265,32.1841,196.5147,32.1212,196.7326,31.6474,197.1342,31.6169,197.5,31.5"
style="stroke:#181818;stroke-width:0.5;"/><image height="18"
width="48" x="205"
xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAASCAIAAACSBMrtAAAAyElEQVR42s2V4RHDIAiFs2JGcARHcARHcARHYARHcIRuUC7cpZDCNVov+n4SHvkCaLbXYtrWBUop7ZPkvS+lCKAY4z5btdYPEA89L2oHNUkAqdkAoMbLoSGWnDO+nVw/gChVrTLccgsIh4h56iitz+2w3ALCipelOx/hoeDxEEK3ZQzQ96FttTjnekYGUrzzPM6n02Fp2yFMsq4DbMyl89yi7oplaQDCuhYQlsb7o8kSD/0F9IxMIJgkuqkVoLkSQLCAxM91Hb0BP+CVCm8acDEAAAAASUVORK5CYII="
y="41.5"/><text fill="#000000" font-family="xkcd Script"
font-size="14" lengthAdjust="spacing" textLength="9" x="226.5"
y="74.7429">s1</text></g><g id="elem_s2"><polygon fill="#F1F1F1"
points="430.5,31.5,430.5,31.7102,441,31.0857,451.5,31.6933,462,31.8997,472.5,30.7866,483,31.4223,493.5,31.5,493.4456,31.3687,493.8046,31.5283,494.1984,31.7719,494.4725,31.7264,494.9848,32.2563,495.2678,32.2322,495.0737,32.1518,495.3533,32.5606,495.6937,32.9944,495.6807,33.282,495.8746,33.6552,496,34,495.9681,34,496.1785,44.5318,496.2391,55.0635,496.5857,65.5953,496.6711,76.127,496,86.6588,496.2092,86.7454,495.932,87.0448,495.8499,87.425,495.7769,87.809,495.1921,87.981,495.2678,88.4265,495.3543,88.6355,494.8764,88.4817,494.6288,88.8838,494.144,88.7134,493.8448,88.9912,493.5,89.1588,493.5,89.9004,483,89.11,472.5,89.2641,462,89.4974,451.5,89.575,441,89.1549,430.5,89.1588,430.5366,89.2472,430.0734,88.836,429.8292,88.9534,429.5093,88.8882,429.1425,88.7099,428.7322,88.4265,428.921,88.5047,428.437,88.0113,428.2385,87.6362,428.1015,87.2866,428.1283,87.0048,428,86.6588,427.8035,86.6588,428.6814,76.127,427.8253,65.5953,427.6569,55.0635,428.2283,44.5318,428,34,427.7946,33.9149,427.9866,33.5802,428.4927,33.3757,428.5735,32.9949,428.812,32.6795,428.7322,32.2322,428.6912,32.1331,429.1265,32.1841,429.5147,32.1212,429.7326,31.6474,430.1342,31.6169,430.5,31.5"
style="stroke:#181818;stroke-width:0.5;"/><image height="18"
width="48" x="438"
xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAASCAIAAACSBMrtAAAAyElEQVR42s2V4RHDIAiFs2JGcARHcARHcARHYARHcIRuUC7cpZDCNVov+n4SHvkCaLbXYtrWBUop7ZPkvS+lCKAY4z5btdYPEA89L2oHNUkAqdkAoMbLoSGWnDO+nVw/gChVrTLccgsIh4h56iitz+2w3ALCipelOx/hoeDxEEK3ZQzQ96FttTjnekYGUrzzPM6n02Fp2yFMsq4DbMyl89yi7oplaQDCuhYQlsb7o8kSD/0F9IxMIJgkuqkVoLkSQLCAxM91Hb0BP+CVCm8acDEAAAAASUVORK5CYII="
y="41.5"/><text fill="#000000" font-family="xkcd Script"
font-size="14" lengthAdjust="spacing" textLength="14" x="457"
y="74.7429">s2</text></g><g id="link_h1_s1"><path d="M72.31,60.5 L72.31,60.7802
L82.515,59.9476 L92.72,60.7577 L102.925,61.0329 L113.13,59.5488
L123.335,60.3964 L133.54,59.9313 L143.745,59.9887 L153.95,60.4091
L164.155,59.5782 L174.36,61.2382 L184.565,59.6596 L194.77,60.5 "
fill="none" style="stroke:#181818;stroke-width:1.0;"/><text
fill="#000000" font-family="xkcd Script" font-size="13"
lengthAdjust="spacing" textLength="43" x="79.9473"
y="75.9155">h1-eth0</text><text fill="#000000" font-family="xkcd
Script" font-size="13" lengthAdjust="spacing" textLength="38"
x="148.9518"
y="76.02">s1-eth1</text></g><g id="link_s1_s2"><path d="M263.1,60.5 L263.1,60.7802
L273.4038,59.9476 L283.7075,60.7577 L294.0113,61.0329 L304.315,59.5488
L314.6188,60.3964 L324.9225,59.9313 L335.2263,59.9887 L345.53,60.4091
L355.8338,59.5782 L366.1375,61.2382 L376.4412,59.6596 L386.745,60.2363
L397.0488,61.0759 L407.3525,60.3856 L417.6563,60.591 L427.96,60.5 "
fill="none" style="stroke:#181818;stroke-width:1.0;"/><text
fill="#000000" font-family="xkcd Script" font-size="13"
lengthAdjust="spacing" textLength="41" x="325" y="55.6543">10
Gbps</text><text fill="#000000" font-family="xkcd Script"
font-size="13" lengthAdjust="spacing" textLength="42" x="270.8484"
y="75.9618">s1-eth2</text><text fill="#000000" font-family="xkcd
Script" font-size="13" lengthAdjust="spacing" textLength="46"
x="373.9387"
y="75.9618">s2-eth2</text></g><g id="link_s2_h2"><path d="M496.09,60.5
L496.09,60.7802 L506.3317,59.9476 L516.5733,60.7577 L526.815,61.0329
L537.0567,59.5488 L547.2983,60.3964 L557.54,59.9313 L567.7817,59.9887
L578.0233,60.4091 L588.265,59.5782 L598.5067,61.2382 L608.7483,59.6596
L618.99,60.5 " fill="none"
style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000"
font-family="xkcd Script" font-size="13" lengthAdjust="spacing"
textLength="42" x="503.837" y="75.9618">s2-eth1</text><text
fill="#000000" font-family="xkcd Script" font-size="13"
lengthAdjust="spacing" textLength="47" x="564.1136"
y="75.9155">h2-eth0</text></g></g></svg>
<figcaption>
<p><span class="figure-number">Рис. 1.: </span>Лабораторная топология</p>
</figcaption>
</figure>
</li>
</ul>
<h3 id="рабочие-файлы"><span class="section-num">3.2</span> Рабочие файлы</h3>
<ul>
<li>Подключимся к виртуальной машине:
<pre><code class="language-shell">ssh -Y mininet@192.168.x.y
</code></pre>
</li>
<li>Для рабочих файлов будем использовать каталог <code>~/work/lab_tbf</code>:
<pre><code class="language-shell">mkdir -p ~/work/lab_tbf
</code></pre>
</li>
</ul>
<h2 id="интерактивный-эксперимент"><span class="section-num">4</span> Интерактивный эксперимент</h2>
<h3 id="отсутствие-ограничения-скорости"><span class="section-num">4.1</span> Отсутствие ограничения скорости</h3>
<ul>
<li>Запустим iPerf3 в режиме сервера, выполните команду <code>iperf3 -s</code> в терминале хоста <code>h2</code>:
<pre><code class="language-shell">iperf3 -s
</code></pre>
</li>
<li>Запустим iPerf3 в клиентском режиме, запустите команду <code>iperf3 -c 10.0.0.2</code> для хоста <code>h1</code>:
<pre><code class="language-shell">iperf3 -c 10.0.0.2
</code></pre>
</li>
<li>Чтобы остановить сервер, нажмите <code>Ctrl+c</code> в терминале хоста <code>h2</code>.</li>
</ul>
<h3 id="ограничение-скорости-на-конечных-хостах"><span class="section-num">4.2</span> Ограничение скорости на конечных хостах</h3>
<ul>
<li>Команду <code>tc</code> можно применить к сетевому интерфейсу устройства для формирования исходящего трафика.</li>
<li>Будем ограничивать скорость отправки конечного хоста с помощью фильтра Token Bucket Filter (tbf), который является реализацией алгоритма Token Bucket.</li>
</ul>
<h4 id="определим-интерфейс-хостов-h1-и-h2"><span class="section-num">4.2.1</span> Определим интерфейс хостов <code>h1</code> и <code>h2</code></h4>
<ul>
<li>На хосте <code>h1</code> введите команду <code>ifconfig</code>, чтобы отобразить информацию, относящуюся к его сетевым интерфейсам и назначенным им IP-адресам.
<ul>
<li>Хост <code>h1</code> имеет два интерфейса: <code>h1-eth0</code> и <code>lo</code>. Интерфейс <code>h1-eth0</code> на хосте <code>h1</code> настроен с IP-адресом 10.0.0.1 и маской подсети 255.0.0.0. Этот интерфейс необходимо использовать в <code>tc</code> при эмуляции сети.</li>
</ul>
</li>
<li>В командной строке хоста <code>h2</code> также введите команду <code>ifconfig</code>.
<ul>
<li>Хост <code>h2</code> имеет два интерфейса: <code>h2-eth0</code> и <code>lo</code>. Интерфейс <code>h2-eth0</code> на хосте <code>h1</code> настроен с IP-адресом 10.0.0.2 и маской подсети 255.0.0.0. Этот интерфейс необходимо использовать в <code>tc</code> при эмуляции сети.</li>
</ul>
</li>
</ul>
<h4 id="эмуляция-глобальной-сети-10-гбит-с-с-высокой-задержкой"><span class="section-num">4.2.2</span> Эмуляция глобальной сети 10 Гбит/с с высокой задержкой</h4>
<ul>
<li>Будем использовать команду <code>tbf</code> на сетевом интерфейсе для управления скоростью исходящего трафика.</li>
<li>Измените пропускную способность хоста <code>h1</code>:
<pre><code class="language-shell">sudo tc qdisc add dev h1-eth0 root tbf rate 10gbit burst 5000000 limit 15000000
</code></pre>
</li>
<li>Эта команда устанавливает пропускную способность на 10 Гбит/с на интерфейсе <code>h1-eth0</code> хоста <code>h1</code>.</li>
<li>Параметры Token Bucket Filter:
<ul>
<li>rate : 10gbit;</li>
<li>burst : 5,000,000;</li>
<li>limit : 15,000,000.</li>
</ul>
</li>
<li>Распишем элементы команды:
<ul>
<li><code>sudo</code> : включить выполнение команды с более высокими привилегиями безопасности;</li>
<li><code>tc</code> : вызвать управление трафиком Linux;</li>
<li><code>qdisc</code> : изменить дисциплину очередей сетевого планировщика;</li>
<li><code>add</code> (добавить): создать новое правило;</li>
<li><code>dev h1-eth0 root</code> : интерфейс, на котором будет применяться правило;</li>
<li><code>tbf</code> : использовать алгоритм Token Bucket Filter;</li>
<li><code>rate</code> : укажите скорость передачи (10 Гбит/с);</li>
<li><code>burst</code> : количество байтов, которое может поместиться в корзину (5 000 000) за один такт;</li>
<li><code>limit</code> : размер очереди в байтах (15 000 000).</li>
</ul>
</li>
<li>Расчёт всплеска.
<ul>
<li><code>tbf</code> требует установки значения всплеска при ограничении скорости. Это значение должно быть достаточно высоким, чтобы обеспечить установленную вами скорость.</li>
<li>Она должна быть не ниже указанной частоты, делённой на HZ, где HZ &mdash; тактовая частота, настроенная как параметр ядра, и может быть извлечена с помощью следующей команды:
<pre><code class="language-shell">egrep '^CONFIG_HZ_[0-9]+' /boot/config-`uname -r`
</code></pre>
</li>
<li>HZ на <code>h1</code> &mdash; 250. Таким образом, для расчёта всплеска делим 10 Гбит/с на 250:
<ul>
<li>10 Gbps = 10,000,000,000 bps;</li>
<li>burst = 10,000,000,000 [bps]/250 [s<sup>-1</sup>]  = 40,000,000 [bit] = 40,000,000/8 [byte] = 5,000,000 [byte].</li>
</ul>
</li>
<li>Полученное значение должно использоваться в команде в качестве значения <em>burst</em> (всплеска).</li>
</ul>
</li>
<li>Проверим конфигурацию с помощью инструмента <code>iperf3</code> для измерения пропускной способности.</li>
<li>Запустим iPerf3 в режиме сервера, выполните команду <code>iperf3 -s</code> в терминале хоста <code>h2</code>:
<pre><code class="language-shell">iperf3 -s
</code></pre>
</li>
<li>Запустим iPerf3 в клиентском режиме, запустите команду <code>iperf3 -c 10.0.0.2</code> для хоста <code>h1</code>:
<pre><code class="language-shell">iperf3 -c 10.0.0.2
</code></pre>
</li>
<li>Чтобы остановить сервер, нажмите <code>Ctrl+c</code> в терминале хоста <code>h2</code>.</li>
<li>Удалите конфигурацию на хосте <code>h1</code>:
<pre><code class="language-shell">sudo tc qdisc del dev h1-eth0 root
</code></pre>
</li>
</ul>
<h3 id="ограничение-скорости-на-коммутаторах"><span class="section-num">4.3</span> Ограничение скорости на коммутаторах</h3>
<ul>
<li>
<p>Применим Token Bucket Filter к интерфейсам коммутатора.</p>
</li>
<li>
<p>При ограничении скорости на интерфейсе <code>s1-eth2</code> коммутатора <code>s1</code> все сеансы связи между коммутатором <code>s1</code> и коммутатором <code>s2</code> будут фильтроваться в соответствии с применяемыми правилами.</p>
</li>
<li>
<p>Введите в терминале <code>s1</code> команду <code>ifconfig</code>, чтобы отобразить информацию, связанную с его сетевыми интерфейсами:</p>
<ul>
<li><code>s1-eth1</code> : интерфейс, соединяющий коммутатор <code>s1</code> с хостом <code>h1</code>;</li>
<li><code>s1-eth2</code> : интерфейс, соединяющий коммутатор <code>s1</code> с коммутатором <code>s2</code>;</li>
<li><code>s2-eth1</code> : интерфейс, соединяющий коммутатор <code>s2</code> с хостом <code>h2</code>;</li>
<li><code>s2-eth2</code> : интерфейс, соединяющий коммутатор <code>s2</code> с коммутатором <code>s1</code>.</li>
</ul>
</li>
<li>
<p>Примените правило ограничения скорости <code>tbf</code> к интерфейсу коммутатора <code>s1</code>, который соединяет его с коммутатором <code>s2</code> (<code>s1-eth2</code>):</p>
<pre><code class="language-shell">sudo tc qdisc add dev s1-eth2 root tbf rate 10gbit burst 5000000 limit 15000000
</code></pre>
<ul>
<li>Параметры Token Bucket Filter следующие:
<ul>
<li><code>rate</code> : 10gbit;</li>
<li><code>burst</code> : 5,000,000;</li>
<li><code>limit</code> : 15,000,000.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Проверим конфигурацию с помощью инструмента <code>iperf3</code> для измерения пропускной способности.</p>
</li>
<li>
<p>Запустим iPerf3 в режиме сервера, выполните команду <code>iperf3 -s</code> в терминале хоста <code>h2</code>:</p>
<pre><code class="language-shell">iperf3 -s
</code></pre>
</li>
<li>
<p>Запустим iPerf3 в клиентском режиме, запустите команду <code>iperf3 -c 10.0.0.2</code> для хоста <code>h1</code>:</p>
<pre><code class="language-shell">iperf3 -c 10.0.0.2
</code></pre>
</li>
<li>
<p>Чтобы остановить сервер, нажмите <code>Ctrl+c</code> в терминале хоста <code>h2</code>.</p>
</li>
<li>
<p>Удалите конфигурацию на коммутаторе <code>s1</code>:</p>
<pre><code class="language-shell">sudo tc qdisc del dev s1-eth2 root
</code></pre>
</li>
</ul>
<h3 id="объединение-netem-и-tbf"><span class="section-num">4.4</span> Объединение NETEM и TBF</h3>
<ul>
<li>
<p>NETEM используется для введения задержки, джиттера, повреждения пакетов и т. д.</p>
</li>
<li>
<p>TBF может использоваться для ограничения скорости.</p>
</li>
<li>
<p>Возможно комбинировать несколько модулей.</p>
</li>
<li>
<p>Первый <code>qdisc</code> (<code>qdisc1</code>) присоединён к корневой метке. Затем последующие <code>qdisc</code> можно прикрепить к своим родителям, указав правильную метку.</p>
</li>
<li>
<p>Объединим NETEM и TBF, чтобы сделать эмуляцию адекватней. Введём задержку, джиттер и повреждение пакетов, указав скорость на интерфейсе коммутатора <code>s1</code>.</p>
</li>
<li>
<p>Введём в терминале коммутатора <code>s1</code>:</p>
<pre><code class="language-shell">sudo tc qdisc add dev s1-eth2 root handle 1: netem delay 10ms
</code></pre>
<ul>
<li>Ключевое слово <code>handle</code> задаёт дескриптор подключения, имеющий смысл очерёдности подключения разных дисциплин <code>qdisc</code>.</li>
</ul>
</li>
<li>
<p>Теперь можно убедиться, что соединение от хоста <code>h1</code> к хосту <code>h2</code> имеет заданную задержку.</p>
</li>
<li>
<p>Запустите команду <code>ping</code> с терминала хоста <code>h1</code>:</p>
<pre><code class="language-shell">ping 10.0.0.2
</code></pre>
</li>
<li>
<p>Нажмите <code>Ctrl+c</code>, чтобы остановить тест.</p>
</li>
<li>
<p>Добавим второе правило на коммутаторе <code>s1</code>, которое задаёт ограничение скорости с помощью <code>tbf</code>:</p>
<pre><code class="language-shell">sudo tc qdisc add dev s1-eth2 parent 1: handle 2: tbf rate 2gbit burst 1000000 limit 2000000
</code></pre>
<ul>
<li>Параметры Token Bucket Filter следующие:
<ul>
<li><code>rate</code> : 2gbit;</li>
<li><code>burst</code> : 1,000,000;</li>
<li><code>limit</code> : 2,000,000.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Проверим предыдущую конфигурацию с помощью инструмента iperf3 для измерения пропускной способности.</p>
</li>
<li>
<p>Запустим iPerf3 в режиме сервера, выполните команду <code>iperf3 -s</code> в терминале хоста <code>h2</code>:</p>
<pre><code class="language-shell">iperf3 -s
</code></pre>
</li>
<li>
<p>Запустим iPerf3 в клиентском режиме, запустите команду <code>iperf3 -c 10.0.0.2</code> для хоста <code>h1</code>:</p>
<pre><code class="language-shell">iperf3 -c 10.0.0.2
</code></pre>
</li>
<li>
<p>Чтобы остановить сервер, нажмите <code>Ctrl+c</code> в терминале хоста <code>h2</code>.</p>
</li>
<li>
<p>Удалите конфигурацию на коммутаторе <code>s1</code>:</p>
<pre><code class="language-shell">sudo tc qdisc del dev s1-eth2 root
</code></pre>
</li>
</ul>
<h3 id="видео-token-bucket-filter-dot-интерактивный-эксперимент"><span class="section-num">4.5</span> Видео: Token Bucket Filter. Интерактивный эксперимент</h3>
<nav>
	<div class="nav nav-tabs" id="nav-tab" role="tablist">

		
		
		
		

		

		<a class="nav-item nav-link  active "
		   id="nav-acdefb" data-toggle="tab" href="#acdefb"
		   role="tab" aria-controls="nav-home" aria-selected="true">RuTube</a>

		

		<a class="nav-item nav-link "
		   id="nav-cbfaed" data-toggle="tab" href="#cbfaed"
		   role="tab" aria-controls="nav-home" aria-selected="true">Youtube</a>

		

	</div>
</nav>

<div class="tab-content" id="nav-tab-content">

	





<div class="tab-pane fade show active " id="acdefb" role="tabpanel" aria-labelledby="nav-1">

	

<div class="embed video-player">
  <iframe class="rutube-player" type="text/html"
	  width="720" height="405"
	  src="https://rutube.ru/play/embed/273ce5d8455a3ba7c18e99a0ce03ced4"
	  webkitAllowFullScreen mozallowfullscreen allowFullScreen
	  allow="clipboard-write" frameborder="0">
  </iframe>
</div>




</div>






<div class="tab-pane fade show " id="cbfaed" role="tabpanel" aria-labelledby="nav-1">

	


<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/ncCPgMUdgjM" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>




</div>



</div>

        </article>

        





        



        
        
        <div class="article-widget">
          
<div class="post-nav">
  
  
  
  <div class="post-nav-item">
    <div class="meta-nav">Предыдущий</div>
    <a href="https://yamadharma.github.io/ru/course/simulation-networks/lab/mininet-netem-ii/" rel="next">Mininet. Использование netem (потери пакетов)</a>
  </div>
  
  
</div>

        </div>
        
      </div>

      <div class="body-footer">
        <p>Обновлено 2022-11-25</p>

        




        




        

  
  


      </div>

      <footer class="site-footer">

  












  
  
  
  
  













  
  
  

  
  
  

  

  
  <p class="powered-by copyright-license-text">
    © 2006—2023 Dmitry S. Kulyabov. This work is licensed under <a href="https://creativecommons.org/licenses/by/4.0" rel="noopener noreferrer" target="_blank">CC BY 4.0</a>
  </p>
  

  <p class="powered-by footer-license-icons">
    <a href="https://creativecommons.org/licenses/by/4.0" rel="noopener noreferrer" target="_blank" aria-label="Creative Commons">
      <i class="fab fa-creative-commons fa-2x" aria-hidden="true"></i>
      <i class="fab fa-creative-commons-by fa-2x" aria-hidden="true"></i>
      
      
    </a>
  </p>





  <p class="powered-by">
    
    
    
      
      
      
      
      
      
      Published with <a href="https://wowchemy.com/?utm_campaign=poweredby" target="_blank" rel="noopener">Wowchemy</a> — the free, <a href="https://github.com/wowchemy/wowchemy-hugo-themes" target="_blank" rel="noopener">open source</a> website builder that empowers creators.
    
  </p>
</footer>


    </main>
  </div>
</div>

  </div>

  <div class="page-footer">
    
    
  </div>

  


<script src="https://yamadharma.github.io/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js"></script>




  

  
  

  






  <script src="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.js" integrity="" crossorigin="anonymous"></script>




<script src="https://cdn.jsdelivr.net/gh/bryanbraun/anchorjs@4.2.2/anchor.min.js" integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin="anonymous"></script>
<script>
  anchors.add();
</script>





  
  <script id="search-hit-fuse-template" type="text/x-template">
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script>
  
    <script src="https://cdn.jsdelivr.net/gh/krisk/Fuse@v3.2.1/dist/fuse.min.js" integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/gh/julmot/mark.js@8.11.1/dist/jquery.mark.min.js" integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin="anonymous"></script>
  












  
  
  
  
  
  
  







<script id="page-data" type="application/json">{"use_headroom":false}</script>












  
  


<script src="https://yamadharma.github.io/ru/js/wowchemy.min.42afebc34d9998643bda73d4863a2a26.js"></script>



  <script src="https://yamadharma.github.io/js/wowchemy-map.a26e9d2f7238ba5b868384f1c5bc6477.js" type="module"></script>




  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Процитировать</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        
        <pre><code></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Копия
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Скачать
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>


  <script src="https://yamadharma.github.io/js/wowchemy-publication.68f8d7090562ca65fc6d3cb3f8f2d2cb.js" type="module"></script>


















</body>
</html>
