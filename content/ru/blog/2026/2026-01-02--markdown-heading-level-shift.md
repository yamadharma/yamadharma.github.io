---
title: "Markdown. Сдвиг уровня заголовков"
author: ["Dmitry S. Kulyabov"]
date: 2026-01-02T20:57:00+03:00
lastmod: 2026-01-25T21:39:00+03:00
tags: ["emacs", "markdown"]
categories: ["computer-science"]
draft: false
slug: "markdown-heading-level-shift"
---

Markdown. Сдвиг уровня заголовков

<!--more-->

{{< toc >}}


## <span class="section-num">1</span> Сдвиг на один уровень вверх {#сдвиг-на-один-уровень-вверх}

-   Регулярное выражение добавляет одну решётку `#` к любому количеству существующих решёток в начале строки.


### <span class="section-num">1.1</span> Регулярное выражение {#регулярное-выражение}

```shell
^(#+)(.*)$
```


### <span class="section-num">1.2</span> Замена {#замена}

```shell
$1#$2
```


### <span class="section-num">1.3</span> Как это работает {#как-это-работает}


#### <span class="section-num">1.3.1</span> Регулярное выражение {#регулярное-выражение}

-   `^` --- начало строки (гарантирует, что мы меняем только заголовки, а не `#` внутри текста).
-   `(#+)`--- захватывающая группа:
    -   `#` --- символ решётки;
    -   `+` --- одно или более повторений (любая длина последовательности `#` в начале строки).
-   `(.*)` --- захватывающая группа: весь остальной текст строки (содержание заголовка).
-   **`$`** --- конец строки.


#### <span class="section-num">1.3.2</span> Замена {#замена}

-   `$1` --- первая захваченная группа (исходные решётки);
-   `#` --- добавляем ещё одну решётку (повышаем уровень);
-   `$2` --- вторая захваченная группа (текст заголовка).


### <span class="section-num">1.4</span> Пример {#пример}

-   Было:

<!--listend-->

```markdown
# Заголовок 1
## Заголовок 2
### Заголовок 3
#### Заголовок 4
##### Заголовок 5
###### Заголовок 6
####### Заголовок 7  ← нестандартный, но валидный для некоторых парсеров
```

-   Стало:

<!--listend-->

```markdown
## Заголовок 1
### Заголовок 2
#### Заголовок 3
##### Заголовок 4
###### Заголовок 5
####### Заголовок 6
######## Заголовок 7
```


### <span class="section-num">1.5</span> Замечания {#замечания}

-   H6 и выше:
    -   Стандарт Markdown поддерживает до H6 (`######`).
    -   Если у вас есть `#######` (7 решёток), замена создаст `########` (8 решёток). Это невалидный синтаксис по спецификации, но некоторые парсеры (например, GitHub) его обрабатывают.

-   Пробелы после `#`:
    -   Шаблон работает независимо от наличия пробелов:
        -   `#Заголовок` → `##Заголовок`
        -   `# Заголовок` → `## Заголовок`

-   Заголовки с замыкающими `#`:
    -   Если используются формы вроде `# Заголовок #`, сначала уберите замыкающие `#` отдельным поиском/заменой:
        ```shell
        ^(#+)(.*?)\s*#*\s*$
        ```

        -   Замена: `$1$2`.


## <span class="section-num">2</span> Сдвиг на один уровень вниз {#сдвиг-на-один-уровень-вниз}

-   Для понижения уровня заголовков Markdown (H2 → H1, H3 → H2 и т. д.) нужно убрать одну решётку `#` из начала строки.
-   При этом заголовки H1 (`# ...`) должны остаться без изменений (иначе получится невалидный синтаксис).


### <span class="section-num">2.1</span> Регулярное выражение {#регулярное-выражение}

```shell
^(#+)(#)(.*)$
```


### <span class="section-num">2.2</span> Замена {#замена}

```shell
$1$3
```


### <span class="section-num">2.3</span> Как это работает {#как-это-работает}


#### <span class="section-num">2.3.1</span> Регулярное выражение {#регулярное-выражение}

-   `^` --- начало строки (гарантирует, что меняем только заголовки).
-   `(#+)` --- первая захватывающая группа:
-   `#+` --- одна или более решёток (захватывает все `#` в начале, _кроме последней_).
-   `(#)` --- вторая захватывающая группа:
    -   ровно одна решётка `#` (которую мы уберём).
-   `(.*)` --- третья захватывающая группа:
    -   весь остальной текст строки (содержание заголовка).
-   `$` --- конец строки.


### <span class="section-num">2.4</span> Замена {#замена}

-   `$1` --- первые решётки (без последней);
-   `$3` --- текст заголовка (пропускаем `$2`, т. к. именно её удаляем).


### <span class="section-num">2.5</span> Пример {#пример}

-   Было:

<!--listend-->

```markdown
# Заголовок 1          ← не изменится (H1)
## Заголовок 2         ← станет H1
### Заголовок 3        ← станет H2
#### Заголовок 4       ← станет H3
##### Заголовок 5      ← станет H4
###### Заголовок 6     ← станет H5
####### Заголовок 7   ← станет H6 (если парсер поддерживает)
```

-   Стало:

<!--listend-->

```markdown
# Заголовок 1
# Заголовок 2
## Заголовок 3
### Заголовок 4
#### Заголовок 5
##### Заголовок 6
###### Заголовок 7
```


### <span class="section-num">2.6</span> Замечания {#замечания}

-   H1 остаётся без изменений:
    -   Шаблон `(#+)(#)` требует _минимум две решётки_ в начале строки.
    -   Строки вида `# Заголовок` (H1) не совпадут и не изменятся.

-   Пробелы после `#`:
    -   Шаблон работает независимо от пробелов:
        -   `##Заголовок` → `#Заголовок`
        -   `## Заголовок` → `# Заголовок`

-   Заголовки с замыкающими `#`:
    -   Если есть формы вроде `## Заголовок ##`, сначала уберите замыкающие `#` отдельным поиском/заменой:
        ```shell
        ^(#+)(.*?)\s*#*\s*$
        ```
    -   Замена: `$1$2`.

-   Ограничение до H6 (опционально):
    -   Если нужно _не опускать ниже H6_, используйте:
        ```regex
        ^(#{2,6})#(.*)$
        ```
    -   Замена: `$1$3`.
    -   Это понизит H2--H6, но оставит H1 и H7+ без изменений.


## <span class="section-num">3</span> Регулярные выражения для Emacs {#регулярные-выражения-для-emacs}

-   Регулярные выражения в нотации Emacs.
-   Ключевые особенности:
    -   Экранирование групп: `\(` и `\)` вместо `(` и `)`;
    -   Экранирование квантификаторов: `\+` вместо `+`, `\{1,5\}` вместо `{1,5}`;
    -   Обратные ссылки: `\1`, `\2` вместо `$1`, `$2`.


### <span class="section-num">3.1</span> Сдвиг заголовков вверх (H1 → H2, H2 → H3 и т. д.) (c ограничением по уровню) {#сдвиг-заголовков-вверх--h1-h2-h2-h3-и-т-dot-д-dot----c-ограничением-по-уровню}

-   Регулярное выражение (Emacs)

<!--listend-->

```emacs
^\(#\{1,5\}\)\(.*\)$
```

-   Замена (Emacs)

<!--listend-->

```emacs
\1#\2
```


#### <span class="section-num">3.1.1</span> Пояснение {#пояснение}

-   `^` --- начало строки;
-   `\(#\{1,5\}\)` --- захватываем от 1 до 5 решёток;
-   `\(.*\)` --- захватываем остальную часть строки;
-   `$` --- конец строки;
-   `\1#\2` --- вставляем первую группу, добавляем `#`, вставляем вторую группу.


### <span class="section-num">3.2</span> Сдвиг заголовков вверх (без ограничения по уровню) {#сдвиг-заголовков-вверх--без-ограничения-по-уровню}

-   Регулярное выражение (Emacs)

<!--listend-->

```emacs
^\(#+\)\(.*\)$
```

-   Замена (Emacs)

<!--listend-->

```emacs
\1#\2
```


#### <span class="section-num">3.2.1</span> Пояснение {#пояснение}

-   `\(#+\)` --- захватываем одну или более решёток;
-   остальное --- аналогично предыдущему.


### <span class="section-num">3.3</span> Сдвиг заголовков вниз (H2 → H1, H3 → H2 и т. д.; H1 не меняется) {#сдвиг-заголовков-вниз--h2-h1-h3-h2-и-т-dot-д-dot-h1-не-меняется}

-   Регулярное выражение (Emacs):

<!--listend-->

```emacs
^\(#+\)#\(.*\)$
```

-   Замена (Emacs):

<!--listend-->

```emacs
\1\2
```


#### <span class="section-num">3.3.1</span> Пояснение {#пояснение}

-   `\(#+\)` --- захватываем все решётки, _кроме последней_;
-   `#` --- одна решётка, которую удаляем;
-   `\(.*\)` --- остальная часть строки;
-   `\1\2` --- вставляем первую и третью группы (вторую пропускаем).


### <span class="section-num">3.4</span> Сдвиг заголовков вниз с ограничением до H6 (H2--H6 понижаем, H1 и H7+ не трогаем) {#сдвиг-заголовков-вниз-с-ограничением-до-h6--h2-h6-понижаем-h1-и-h7-plus-не-трогаем}

-   Регулярное выражение (Emacs):

<!--listend-->

```emacs
^\(#\{2,6\}\)#\(.*\)$
```

-   Замена (Emacs):

<!--listend-->

```emacs
\1\2
```


#### <span class="section-num">3.4.1</span> Пояснение {#пояснение}

-   `\(#\{2,6\}\)` --- захватываем от 2 до 6 решёток (т. е. уровни H2--H6);
-   `#` --- удаляемая решётка;
-   `\(.*\)` --- текст заголовка;
-   `\1\2` --- склеиваем первую и третью группы.


### <span class="section-num">3.5</span> Как применять в Emacs {#как-применять-в-emacs}

-   Откройте файл в Emacs.
-   Нажмите `M-x replace-regexp` (или `C-M-%` для `query-replace-regexp`).
-   Введите регулярное выражение и замену в формате выше.
-   Нажмите `Enter` --- Emacs предложит поочерёдно подтвердить замены.


### <span class="section-num">3.6</span> Примечания {#примечания}

-   Экранирование: в Emacs `+`, `{`, `}`, `(` и `)` требуют обратного слеша `\`.
-   Группы: `\(` и `\)` создают группы, `\1`, `\2` ссылаются на них.
-   Пробелы и табуляции: если в заголовках есть пробелы после `#`, выражения работают корректно (пробелы входят в `.*`).
-   Замыкающие `#`: если есть формы вроде `# Заголовок #`, сначала уберите замыкающие `#` отдельным поиском:
    -   Regexp: `^\(#+\)\(.*?\)\s*#*\s*$`
    -   Replace: `\1\2`


## <span class="section-num">4</span> Регулярные выражения для sed {#регулярные-выражения-для-sed}


### <span class="section-num">4.1</span> Синтаксис `sed` для замены по регулярным выражениям {#синтаксис-sed-для-замены-по-регулярным-выражениям}

-   Общий формат:
    ```shell
    sed -i 's/шаблон/замена/g' файл.md
    ```

    -   `-i` --- редактирование файла «на месте» (in‑place);
    -   `s/` --- команда замены (_substitute_);
    -   `/шаблон/замена/` --- шаблон поиска и строка замены;
    -   `g` --- глобальная замена (все совпадения в строке; для заголовков обычно не нужно, т. к. одно совпадение на строку);
    -   `'...'` --- кавычки, экранирующие спецсимволы для оболочки.

-   В BSD‑версии `sed` требуется суффикс после `-i` (например, `-i ''`). В GNU `sed` (Linux) можно `-i` без суффикса.


### <span class="section-num">4.2</span> Сдвиг заголовков вверх (H1 → H2, H2 → H3 и т. д.) {#сдвиг-заголовков-вверх--h1-h2-h2-h3-и-т-dot-д-dot}


#### <span class="section-num">4.2.1</span> С ограничением до H5 (H6 не меняется) {#с-ограничением-до-h5--h6-не-меняется}

-   Команда:

<!--listend-->

```shell
sed -i '' 's/^\(#\{1,5\}\)\(.*\)$/\1#\2/g' файл.md
```

<!--list-separator-->

1.  Пояснение

    -   `^` --- начало строки;
    -   `\(#\{1,5\}\)` --- захватывающая группа: от 1 до 5 решёток `#`;
    -   `\(.*\)` --- захватывающая группа: весь остальной текст строки;
    -   `$` --- конец строки;
    -   `\1#\2` --- подстановка: первая группа + одна решётка + вторая группа.

<!--list-separator-->

2.  Пример

    -   Было: `# Заголовок` → Стало: `## Заголовок`
    -   Было: `##### Заголовок` → Стало: `###### Заголовок`
    -   `###### Заголовок` (H6) → не меняется.


#### <span class="section-num">4.2.2</span> Без ограничения по уровню (любой H → H+1) {#без-ограничения-по-уровню--любой-h-h-plus-1}

-   Команда:

<!--listend-->

```shell
sed -E -i 's/^(#+)(.*)$/\1#\2/g' файл.md
```

-   Пояснение:
    -   `(#+)` захватывает одну или более решёток (не ограничиваясь 5).

<!--list-separator-->

1.  Пример

    -   `####### Заголовок` (7 решёток) → `######## Заголовок` (8 решёток).


### <span class="section-num">4.3</span> Сдвиг заголовков вниз (H2 → H1, H3 → H2 и т. д.; H1 не меняется) {#сдвиг-заголовков-вниз--h2-h1-h3-h2-и-т-dot-д-dot-h1-не-меняется}


#### <span class="section-num">4.3.1</span> Без ограничений (любой H≥2 → H−1) {#без-ограничений--любой-h-2-h-1}

-   Команда:

<!--listend-->

```shell
sed -E -i 's/^(#+)#(.*)$/\1\2/g' файл.md
```

<!--list-separator-->

1.  Пояснение

    -   `(#+)` --- захватываем все решётки, _кроме последней_;
    -   `#` --- одна решётка, которую удаляем;
    -   `(.*)` --- текст заголовка;
    -   `\1\2` --- склеиваем первую и третью группы (вторая --- удаляемая решётка).

<!--list-separator-->

2.  Пример

    -   `## Заголовок` → `# Заголовок`
    -   `### Заголовок` → `## Заголовок`
    -   `# Заголовок` (H1) → не меняется (требуется минимум две решётки).


#### <span class="section-num">4.3.2</span> С ограничением до H6 (H2--H6 → H−1, H1 и H7+ не меняются) {#с-ограничением-до-h6--h2-h6-h-1-h1-и-h7-plus-не-меняются}

<!--list-separator-->

1.  Команда

    ```shell
    sed -E -i 's/^(#{2,6})#(.*)$/\1\2/g' файл.md
    ```

    -   Отличие:
        -   `(#{2,6})` захватывает от 2 до 6 решёток.

<!--list-separator-->

2.  Пример

    -   `## Заголовок` (H2) → `# Заголовок` (H1);
    -   `###### Заголовок` (H6) → `##### Заголовок` (H5);
    -   `####### Заголовок` (H7) → не меняется.


### <span class="section-num">4.4</span> Итоговые команды {#итоговые-команды}


#### <span class="section-num">4.4.1</span> Сдвиг вверх (без ограничений) {#сдвиг-вверх--без-ограничений}

```shell
sed -E -i 's/^(#+)(.*)$/\1#\2/g' файл.md
```


#### <span class="section-num">4.4.2</span> Сдвиг вниз (без ограничений) {#сдвиг-вниз--без-ограничений}

```shell
sed -E -i 's/^(#+)#(.*)$/\1\2/g' файл.md
```


#### <span class="section-num">4.4.3</span> Сдвиг вверх (до H5) {#сдвиг-вверх--до-h5}

```shell
sed -E -i '' 's/^(#{1,5})(.*)$/\1#\2/g' файл.md
```


#### <span class="section-num">4.4.4</span> Сдвиг вниз (до H6) {#сдвиг-вниз--до-h6}

```shell
sed -E -i 's/^(#{2,6})#(.*)$/\1\2/g' файл.md
```


#### <span class="section-num">4.4.5</span> Примечания {#примечания}

-   Пробелы после `#`:
    -   Все приведённые команды работают независимо от наличия пробелов после решёток:

    -   `##Заголовок` → `#Заголовок`;
    -   `## Заголовок` → `# Заголовок`.

-   Замыкающие `#` (форма `# Заголовок #`):
    -   Если такие есть, сначала уберите их отдельной командой:
        ```shell
        sed -E -i 's/^(#+)(.*?)\s*#*\s*$/\1\2/g' файл.md
        ```
    -   Это удалит все `#` в конце строки после пробела.

-   Тестирование перед применением:
    -   Чтобы увидеть результат без изменения файла, опустите `-i`:
        ```shell
        sed -E 's/^(#+)(.*)$/\1#\2/g' файл.md
        ```
    -   Вывод отобразится в терминале.
