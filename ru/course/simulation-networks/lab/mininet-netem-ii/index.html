<!doctype html><html lang=ru-ru><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=generator content="Hugo Blox Builder 5.9.7"><script src=https://yamadharma.github.io/js/mathjax-config.js></script><link rel=stylesheet href=https://yamadharma.github.io/css/vendor-bundle.min.26c458e6907dc03073573976b7f4044e.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1.9.4/css/academicons.min.css integrity="sha512-IW0nhlW5MgNydsXJO40En2EoCkTTjZhI3yuODrZIc8cQ4h1XcF53PsqDHa09NqnkXuIe0Oiyyj171BqZFwISBw==" crossorigin=anonymous media=print onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.css integrity crossorigin=anonymous media=print onload='this.media="all"'><script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js integrity crossorigin=anonymous async></script><link rel=stylesheet href=https://yamadharma.github.io/css/wowchemy.de5da8240005c33ff0ce234874325fdf.css><link rel=stylesheet href=https://yamadharma.github.io/css/libs/chroma/github-light.min.css title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=https://yamadharma.github.io/css/libs/chroma/dracula.min.css title=hl-dark media=print onload='this.media="all"' disabled><script async src="https://www.googletagmanager.com/gtag/js?id=UA-162854716-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}function trackOutboundLink(e,t){gtag("event","click",{event_category:"outbound",event_label:e,transport_type:"beacon",event_callback:function(){t!=="_blank"&&(document.location=e)}}),console.debug("Outbound link clicked: "+e)}function onClickCallback(e){if(e.target.tagName!=="A"||e.target.host===window.location.host)return;trackOutboundLink(e.target,e.target.getAttribute("target"))}gtag("js",new Date),gtag("config","UA-162854716-1",{anonymize_ip:!0}),gtag("set",{cookie_flags:"SameSite=None;Secure"}),document.addEventListener("click",onClickCallback,!1)</script><meta name=author content="Дмитрий Сергеевич Кулябов"><meta name=description content="Использование netem (потери пакетов)"><link rel=alternate hreflang=ru-ru href=https://yamadharma.github.io/ru/course/simulation-networks/lab/mininet-netem-ii/><link rel=canonical href=https://yamadharma.github.io/ru/course/simulation-networks/lab/mininet-netem-ii/><link rel=manifest href=https://yamadharma.github.io/ru/manifest.webmanifest><link rel=icon type=image/png href=https://yamadharma.github.io/media/icon_hu10409781601724418176.png><link rel=apple-touch-icon type=image/png href=https://yamadharma.github.io/media/icon_hu16056463462840539100.png><meta name=theme-color content="#1565c0"><meta property="twitter:card" content="summary"><meta property="twitter:site" content="@dskulyabov"><meta property="twitter:creator" content="@dskulyabov"><meta property="twitter:image" content="https://yamadharma.github.io/media/icon_hu15752663207405015554.png"><meta property="og:type" content="article"><meta property="og:site_name" content="Д. С. Кулябов"><meta property="og:url" content="https://yamadharma.github.io/ru/course/simulation-networks/lab/mininet-netem-ii/"><meta property="og:title" content="Mininet. Использование netem (потери пакетов) | Д. С. Кулябов"><meta property="og:description" content="Использование netem (потери пакетов)"><meta property="og:image" content="https://yamadharma.github.io/media/icon_hu15752663207405015554.png"><meta property="og:locale" content="ru-ru"><meta property="article:published_time" content="2022-10-13T14:27:00+03:00"><meta property="article:modified_time" content="2023-10-12T20:18:00+03:00"><script src=https://cdn.jsdelivr.net/gh/osano/cookieconsent@3.1.1/build/cookieconsent.min.js integrity="sha512-yXXqOFjdjHNH1GND+1EO0jbvvebABpzGKD66djnUfiKlYME5HGMUJHoCaeE4D5PTG2YsSJf6dwqyUUvQvS0vaA==" crossorigin=anonymous></script><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/osano/cookieconsent@3.1.1/build/cookieconsent.min.css integrity="sha512-LQ97camar/lOliT/MqjcQs5kWgy6Qz/cCRzzRzUCfv0fotsCTC9ZHXaPQmJV8Xu/PVALfJZ7BDezl5lW3/qBxg==" crossorigin=anonymous><script>window.addEventListener("load",function(){window.cookieconsent.initialise({palette:{popup:{background:"#1565c0",text:"rgb(255, 255, 255)"},button:{background:"rgb(255, 255, 255)",text:"#1565c0"}},theme:"classic",content:{message:"Для комфорной навигации на этом сайте используются куки (cookies).",dismiss:"Понял!",link:"Узнать больше",href:"https://www.cookiesandyou.com"}})})</script><title>Mininet. Использование netem (потери пакетов) | Д. С. Кулябов</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=705d8b403027e002ae4af7bf61685bad><script src=https://yamadharma.github.io/js/wowchemy-init.min.9e4214442a7711d35691acd58f6f6361.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class=col-6><h1>Поиск</h1></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=Close><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box><input name=q id=search-query placeholder="Поиск ..." autocapitalize=off autocomplete=off autocorrect=off spellcheck=false type=search class=form-control aria-label="Поиск ..."></div></section><section class=section-search-results><div id=search-hits></div></section></div></aside><div class="page-header header--fixed"><header><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=https://yamadharma.github.io/ru/>Д. С. Кулябов</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label="Переключить навигацию">
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=https://yamadharma.github.io/ru/>Д. С. Кулябов</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=https://yamadharma.github.io/ru/#about><span>Обо мне</span></a></li><li class=nav-item><a class=nav-link href=https://yamadharma.github.io/ru/#posts><span>Блог</span></a></li><li class=nav-item><a class=nav-link href=https://yamadharma.github.io/ru/#projects><span>Проекты</span></a></li><li class=nav-item><a class=nav-link href=https://yamadharma.github.io/ru/#featured><span>Публикации</span></a></li><li class=nav-item><a class="nav-link active" href=https://yamadharma.github.io/ru/course/><span>Курсы</span></a></li><li class=nav-item><a class=nav-link href=https://yamadharma.github.io/ru/#contact><span>Контакты</span></a></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=Поиск><i class="fas fa-search" aria-hidden=true></i></a></li><li class="nav-item dropdown theme-dropdown"><a href=# class=nav-link data-toggle=dropdown aria-haspopup=true aria-label="Display preferences"><i class="fas fa-moon" aria-hidden=true></i></a><div class=dropdown-menu><a href=# class="dropdown-item js-set-theme-light"><span>Light</span>
</a><a href=# class="dropdown-item js-set-theme-dark"><span>Dark</span>
</a><a href=# class="dropdown-item js-set-theme-auto"><span>Automatic</span></a></div></li></ul></div></nav></header></div><div class=page-body><div class="container-fluid docs"><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 docs-sidebar"><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation"><div class=d-flex><span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">Лабораторные работы
</span><span><i class="fas fa-chevron-down"></i></span></div></button>
<button class="form-control sidebar-search js-search d-none d-md-flex">
<i class="fas fa-search pr-2"></i>
<span class=sidebar-search-text>Поиск ...</span>
<span class=sidebar-search-shortcut>/</span></button></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li><a href=https://yamadharma.github.io/ru/course/><i class="fas fa-arrow-left pr-1"></i>Курсы</a></li></ul><div class=docs-toc-item><a class=docs-toc-link href=https://yamadharma.github.io/ru/course/simulation-networks/>Моделирование сетей передачи данных</a><ul class="nav docs-sidenav"><div class=docs-toc-item><a class=docs-toc-link href=https://yamadharma.github.io/ru/course/simulation-networks/lab/>Лабораторные работы</a><ul class="nav docs-sidenav"><li><a href=https://yamadharma.github.io/ru/course/simulation-networks/lab/mininet-intro/>Введение в Mininet</a></li><li><a href=https://yamadharma.github.io/ru/course/simulation-networks/lab/mininet-iperf-intro/>Введение в Iperf</a></li><li><a href=https://yamadharma.github.io/ru/course/simulation-networks/lab/mininet-netem-i/>Использование netem (latency, jitter)</a></li><li class=active><a href=https://yamadharma.github.io/ru/course/simulation-networks/lab/mininet-netem-ii/>Использование netem (потери пакетов)</a></li><li><a href=https://yamadharma.github.io/ru/course/simulation-networks/lab/mininet-token-bucket-filter/>Token Bucket Filter</a></li></ul></div></ul></div></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>На этой странице</a></li></ul><nav id=TableOfContents><ul><li><a href=#общая-информация><span class=section-num>1</span> Общая информация</a><ul><li><a href=#цели><span class=section-num>1.1</span> Цели</a></li><li><a href=#задачи><span class=section-num>1.2</span> Задачи</a></li><li><a href=#видео-использование-netem-ii-dot-введение><span class=section-num>1.3</span> Видео: Использование netem II. Введение</a></li></ul></li><li><a href=#теоретические-сведения><span class=section-num>2</span> Теоретические сведения</a><ul><li><a href=#проблемы-с-передачей-пакетов><span class=section-num>2.1</span> Проблемы с передачей пакетов</a></li></ul></li><li><a href=#подготовка-стенда><span class=section-num>3</span> Подготовка стенда</a><ul><li><a href=#лабораторная-топология><span class=section-num>3.1</span> Лабораторная топология</a></li><li><a href=#рабочие-файлы><span class=section-num>3.2</span> Рабочие файлы</a></li></ul></li><li><a href=#интерактивный-эксперимент><span class=section-num>4</span> Интерактивный эксперимент</a><ul><li><a href=#добавление-изменение-потери-пакетов><span class=section-num>4.1</span> Добавление/изменение потери пакетов</a></li><li><a href=#определение-интерфейсов-хостов-h1-и-h2><span class=section-num>4.2</span> Определение интерфейсов хостов <code>h1</code> и <code>h2</code></a></li><li><a href=#добавка-потери-пакетов-на-интерфейс-подключённый-к-глобальной-сети><span class=section-num>4.3</span> Добавка потери пакетов на интерфейс, подключённый к глобальной сети</a></li><li><a href=#добавка-значения-корреляции-для-потери-пакетов><span class=section-num>4.4</span> Добавка значения корреляции для потери пакетов</a></li><li><a href=#добавка-повреждения-пакетов><span class=section-num>4.5</span> Добавка повреждения пакетов</a></li><li><a href=#добавка-переупорядочивание-пакетов><span class=section-num>4.6</span> Добавка переупорядочивание пакетов</a></li><li><a href=#добавка-дублирования-пакетов><span class=section-num>4.7</span> Добавка дублирования пакетов</a></li><li><a href=#видео-использование-netem-ii-dot-интерактивный-эксперимент><span class=section-num>4.8</span> Видео: Использование netem II. Интерактивный эксперимент</a></li></ul></li><li><a href=#воспроизводимый-эксперимент><span class=section-num>5</span> Воспроизводимый эксперимент</a><ul><li><a href=#постановка-задания><span class=section-num>5.1</span> Постановка задания</a></li><li><a href=#добавление-потери-пакетов-на-интерфейс-подключённый-к-эмулируемой-глобальной-сети><span class=section-num>5.2</span> Добавление потери пакетов на интерфейс, подключённый к эмулируемой глобальной сети</a></li></ul></li></ul></nav></div><main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role=main><div class=docs-article-container><nav class="d-none d-md-flex" aria-label=breadcrumb><ol class=breadcrumb><li class=breadcrumb-item><a href=https://yamadharma.github.io/ru/>Home</a></li><li class=breadcrumb-item><a href=https://yamadharma.github.io/ru/course/>Курсы</a></li><li class=breadcrumb-item><a href=https://yamadharma.github.io/ru/course/simulation-networks/>Моделирование сетей передачи данных</a></li><li class=breadcrumb-item><a href=https://yamadharma.github.io/ru/course/simulation-networks/lab/>Лабораторные работы</a></li><li class="breadcrumb-item active" aria-current=page>Использование netem (потери пакетов)</li></ol></nav></div><div class=docs-article-container><h1>Mininet. Использование netem (потери пакетов)</h1><article class=article-style><p>Использование netem. Потери пакетов, дублирование пакетов, изменение порядка, повреждение пакетов.</p><h2 id=общая-информация><span class=section-num>1</span> Общая информация</h2><h3 id=цели><span class=section-num>1.1</span> Цели</h3><ul><li>Освоить моделирование следующих параметров сети: потеря пакетов, дублирование пакетов, изменение порядка и повреждение пакетов.</li></ul><h3 id=задачи><span class=section-num>1.2</span> Задачи</h3><ul><li>В ходе работы требуется освоить следующие умения:<ul><li>эмуляция сети, характеризующихся такими параметрами, как задержка, потеря пакетов, повреждение пакетов, переупорядочивание пакетов и дублирование пакетов;</li><li>измерение производительности глобальных сетей, характеризующихся различными значениями параметров.</li></ul></li></ul><h3 id=видео-использование-netem-ii-dot-введение><span class=section-num>1.3</span> Видео: Использование netem II. Введение</h3><nav><div class="nav nav-tabs" id=nav-tab role=tablist><a class="nav-item nav-link active" id=nav-cbdafe data-toggle=tab href=#cbdafe role=tab aria-controls=nav-home aria-selected=true>RuTube</a>
<a class="nav-item nav-link" id=nav-cbaedf data-toggle=tab href=#cbaedf role=tab aria-controls=nav-home aria-selected=true>Youtube</a></div></nav><div class=tab-content id=nav-tab-content><div class="tab-pane fade show active" id=cbdafe role=tabpanel aria-labelledby=nav-1><div class="embed video-player"><iframe class=rutube-player type=text/html width=720 height=405 src=https://rutube.ru/play/embed/dbb8edc601a8941aa093a15303b5391d webkitallowfullscreen mozallowfullscreen allowfullscreen allow=clipboard-write frameborder=0></iframe></div></div><div class="tab-pane fade show" id=cbaedf role=tabpanel aria-labelledby=nav-1><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen loading=eager referrerpolicy=strict-origin-when-cross-origin src="https://www.youtube.com/embed/E6yKPh6Vhq4?autoplay=0&controls=1&end=0&loop=0&mute=0&start=0" style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 title="YouTube video"></iframe></div></div></div><h2 id=теоретические-сведения><span class=section-num>2</span> Теоретические сведения</h2><h3 id=проблемы-с-передачей-пакетов><span class=section-num>2.1</span> Проблемы с передачей пакетов</h3><ol><li>Потеря пакета<ul><li>Пакет, проходящий через сеть, не достигает пункта назначения.</li><li>Распространённой причиной потери пакетов является неспособность маршрутизаторов удерживать пакеты, поступающие со скоростью, превышающей скорость отправления.</li><li>Маршрутизатор ограничен объёмом буферной памяти, используемой для мгновенного хранения пакетов.</li><li>Когда происходит потеря пакетов, TCP уменьшает окно перегрузки и, следовательно, пропускную способность вдвое.</li></ul></li><li>Переупорядочивание пакетов<ul><li>Пакеты принимаются в порядке, отличном от того, в котором они были отправлены.</li><li>Переупорядочивание пакетов (неупорядоченная доставка пакетов) обычно является результатом того, что пакеты следуют по разным маршрутам для достижения пункта назначения.</li><li>Переупорядочивание пакетов может ухудшить пропускную способность TCP-соединений в сетях с высокой пропускной способностью и высокой задержкой.</li><li>Для каждого сегмента, полученного не по порядку, получатель TCP отправляет подтверждение (ACK) для последнего правильно принятого сегмента.</li><li>Как только отправитель TCP получает три подтверждения для одного и того же сегмента (тройной дубликат ACK), отправитель считает, что получатель неправильно принял пакет, следующий за пакетом, который подтверждается три раза.</li><li>Тогда отправитель уменьшает окно перегрузки и пропускную способность в два раза.</li></ul></li><li>Повреждение пакета<ul><li>Повреждение битов, составляющих пакет.</li><li>Обычно происходит на физическом уровне.</li><li>В случае повреждения некоторые биты могут иметь значения, отличные от первоначально отправленных узлом-отправителем.</li><li>Узел получателя отбрасывает такие пакеты.</li><li>Процесс-отправитель TCP не получит подтверждения для соответствующего сегмента и будет считать его потерянным сегментом.</li><li>Отправитель уменьшает окно перегрузки и пропускную способность в два раза.</li></ul></li><li>Дублирование пакетов<ul><li>Несколько копий пакета присутствуют в сети и принимаются пунктом назначения.</li><li>Дублирование пакетов является результатом повторных передач, когда узел-отправитель повторно передает неподтвержденные (NACK) пакеты.</li></ul></li></ol><h2 id=подготовка-стенда><span class=section-num>3</span> Подготовка стенда</h2><h3 id=лабораторная-топология><span class=section-num>3.1</span> Лабораторная топология</h3><ul><li><p>В топологии используется сеть 10.0.0.0/8, назначенная Mininet по умолчанию.</p></li><li><p>Топология представляет собой коммутатор с двумя подключёнными к нему хостами.</p></li><li><p>Для запуска топологии (рис. <a href=#figure--fig:netem-ii:topology>1</a>) используем параметры командной строки:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sudo mn --topo<span class=o>=</span>single,2 -x
</span></span></code></pre></div><p><a id=figure--fig:netem-ii:topology></a></p><figure><svg xmlns:xlink="http://www.w3.org/1999/xlink" height="120" preserveAspectRatio="none" style="width:453px;height:120px;background:#fff" viewBox="0 0 453 120" width="453" zoomAndPan="magnify"><defs/><g><g id="elem_h1"><polygon fill="#f1f1f1" points="9.5,7,9.5,7.2102,19.5,6.5857,29.5,7.1933,39.5,7.3997,49.5,6.2866,59.5,6.9223,69.5,7,69.4456,6.8687,69.8046,7.0283,70.1984,7.2719,70.4725,7.2264,70.9848,7.7563,71.2678,7.7322,71.0737,7.6518,71.3533,8.0606,71.6937,8.4944,71.6807,8.782,71.8746,9.1552,72,9.5,71.9681,9.5,72.1785,19.7318,72.2391,29.9635,72.5857,40.1953,72.6711,50.427,72.6793,60.6588,72.2546,70.8905,72.4636,81.1223,72.7022,91.354,71.2788,101.5858,72,111.8175,72.209,111.9041,71.7622,112.1332,71.8715,112.5927,71.4082,112.815,71.3931,113.223,71.2678,113.5853,71.3624,113.8137,70.908,113.7167,70.5741,113.9106,70.2503,114.1289,69.9066,114.2992,69.5,114.3175,69.5,114.3136,59.5,114.6047,49.5,113.7451,39.5,114.6019,29.5,114.8657,19.5,114.762,9.5,114.3175,9.5782,114.5063,9.0848,114.0223,8.7097,113.8238,8.3601,113.6868,8.0783,113.7136,7.7322,113.5853,7.6717,113.5602,7.7956,113.3186,7.3855,112.8559,7.1872,112.4809,7.2167,112.2002,7,111.8175,6.3332,111.8175,6.4809,101.5858,7.649,91.354,7.4357,81.1223,7.7345,70.8905,6.6782,60.6588,7.3192,50.427,7.5904,40.1953,6.5276,29.9635,6.9041,19.7318,7,9.5,7.0388,9.5161,7.3472,9.2296,7.2916,8.7924,7.5818,8.4983,7.4152,8.0151,7.7322,7.7322,7.6458,7.5237,8.15,7.7409,8.3479,7.2186,8.8578,7.4496,9.1728,7.2101,9.5,7" style="stroke:#181818;stroke-width:.5"/><image height="48" width="45" x="17" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAwCAIAAAAKMGSIAAABYUlEQVR4Xu2Y7Y3DIAyGu2JGyAgZ4UbICBmBEW4ERugI3eCsvEAxifnwWbqexPMrjfHLE0olmsfrM3iUN/6I4OG937ZtGYe6qJdFqggeOglAvSxSRfAoswdhkSqmB+fGw/eRt7BIFTcerC6jaKlw46GARaqYHpzpwZkenH/lse/7dxWeqaHt4S2OF00aHsdxUJWeuCwYQSvd5VGvmoCvdcBjtwaxzrkxD1wbgtjpEUHs9IggdnpEEDs9IogVPb4y8mrotgOxokc2MiDd/yWIFT0+ZT1y8iquDUHs9IggVvTIRgZwn85mzhTEOsnjmXGtmiN65GBQcjcn/SQbHsu5PBhTp2w76ex99Xgs584o3wZlIOH2jWOcpU2XxxUyo3M2SaQnphUuxqzr+p6nRfBIe7iHYrXpoxM2EB3K04LVCR6j0MTrSTmzDA1Ou/KK0uN2N/Qg7VylB76LUSr/yJUe5vwAo6Ho0KlFbyoAAAAASUVORK5CYII=" y="17"/><text fill="#000" font-family="xkcd Script" font-size="14" lengthAdjust="spacing" textLength="10" x="36.5" y="80.2429">h1</text><text fill="#000" font-family="xkcd Script" font-size="14" lengthAdjust="spacing" textLength="39" x="20" y="99.9017">10.0.0.1</text></g><g id="elem_h2"><polygon fill="#f1f1f1" points="384.5,7,384.5,7.2102,394.5,6.5857,404.5,7.1933,414.5,7.3997,424.5,6.2866,434.5,6.9223,444.5,7,444.4456,6.8687,444.8046,7.0283,445.1984,7.2719,445.4725,7.2264,445.9848,7.7563,446.2678,7.7322,446.0737,7.6518,446.3533,8.0606,446.6937,8.4944,446.6807,8.782,446.8746,9.1552,447,9.5,446.9681,9.5,447.1785,19.7318,447.2391,29.9635,447.5857,40.1953,447.6711,50.427,447.6793,60.6588,447.2546,70.8905,447.4636,81.1223,447.7022,91.354,446.2788,101.5858,447,111.8175,447.209,111.9041,446.7622,112.1332,446.8715,112.5927,446.4082,112.815,446.3931,113.223,446.2678,113.5853,446.3624,113.8137,445.908,113.7167,445.5741,113.9106,445.2503,114.1289,444.9066,114.2992,444.5,114.3175,444.5,114.3136,434.5,114.6047,424.5,113.7451,414.5,114.6019,404.5,114.8657,394.5,114.762,384.5,114.3175,384.5782,114.5063,384.0848,114.0223,383.7097,113.8238,383.3601,113.6868,383.0783,113.7136,382.7322,113.5853,382.6717,113.5602,382.7956,113.3186,382.3855,112.8559,382.1872,112.4809,382.2167,112.2002,382,111.8175,381.3332,111.8175,381.4809,101.5858,382.649,91.354,382.4357,81.1223,382.7345,70.8905,381.6782,60.6588,382.3192,50.427,382.5904,40.1953,381.5276,29.9635,381.9041,19.7318,382,9.5,382.0388,9.5161,382.3472,9.2296,382.2916,8.7924,382.5818,8.4983,382.4152,8.0151,382.7322,7.7322,382.6458,7.5237,383.15,7.7409,383.3479,7.2186,383.8578,7.4496,384.1728,7.2101,384.5,7" style="stroke:#181818;stroke-width:.5"/><image height="48" width="45" x="392" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAwCAIAAAAKMGSIAAABYUlEQVR4Xu2Y7Y3DIAyGu2JGyAgZ4UbICBmBEW4ERugI3eCsvEAxifnwWbqexPMrjfHLE0olmsfrM3iUN/6I4OG937ZtGYe6qJdFqggeOglAvSxSRfAoswdhkSqmB+fGw/eRt7BIFTcerC6jaKlw46GARaqYHpzpwZkenH/lse/7dxWeqaHt4S2OF00aHsdxUJWeuCwYQSvd5VGvmoCvdcBjtwaxzrkxD1wbgtjpEUHs9IggdnpEEDs9IogVPb4y8mrotgOxokc2MiDd/yWIFT0+ZT1y8iquDUHs9IggVvTIRgZwn85mzhTEOsnjmXGtmiN65GBQcjcn/SQbHsu5PBhTp2w76ex99Xgs584o3wZlIOH2jWOcpU2XxxUyo3M2SaQnphUuxqzr+p6nRfBIe7iHYrXpoxM2EB3K04LVCR6j0MTrSTmzDA1Ou/KK0uN2N/Qg7VylB76LUSr/yJUe5vwAo6Ho0KlFbyoAAAAASUVORK5CYII=" y="17"/><text fill="#000" font-family="xkcd Script" font-size="14" lengthAdjust="spacing" textLength="15" x="409" y="80.2429">h2</text><text fill="#000" font-family="xkcd Script" font-size="14" lengthAdjust="spacing" textLength="44" x="392.5" y="99.9017">10.0.0.2</text></g><g id="elem_s1"><polygon fill="#f1f1f1" points="195.5,31.83,195.5,32.0402,206,31.4157,216.5,32.0233,227,32.2297,237.5,31.1166,248,31.7523,258.5,31.83,258.4456,31.6987,258.8046,31.8583,259.1984,32.1019,259.4725,32.0564,259.9848,32.5863,260.2678,32.5622,260.0737,32.4818,260.3533,32.8906,260.6937,33.3244,260.6807,33.612,260.8746,33.9852,261,34.33,260.9681,34.33,261.1785,44.8618,261.2391,55.3935,261.5857,65.9253,261.6711,76.457,261,86.9888,261.2092,87.0754,260.932,87.3748,260.8499,87.755,260.7769,88.139,260.1921,88.311,260.2678,88.7565,260.3543,88.9655,259.8764,88.8117,259.6288,89.2138,259.144,89.0434,258.8448,89.3212,258.5,89.4888,258.5,90.2304,248,89.44,237.5,89.5941,227,89.8274,216.5,89.905,206,89.4849,195.5,89.4888,195.5366,89.5772,195.0734,89.166,194.8292,89.2834,194.5093,89.2182,194.1425,89.0399,193.7322,88.7565,193.921,88.8347,193.437,88.3413,193.2385,87.9662,193.1015,87.6166,193.1283,87.3348,193,86.9888,192.8035,86.9888,193.6814,76.457,192.8253,65.9253,192.6569,55.3935,193.2283,44.8618,193,34.33,192.7946,34.2449,192.9866,33.9102,193.4927,33.7057,193.5735,33.3249,193.812,33.0095,193.7322,32.5622,193.6912,32.4631,194.1265,32.5141,194.5147,32.4512,194.7326,31.9774,195.1342,31.9469,195.5,31.83" style="stroke:#181818;stroke-width:.5"/><image height="18" width="48" x="203" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAASCAIAAACSBMrtAAAA4klEQVR4Xs2WYRHDIAyFa7ESKgEJSEACEpCABCQgAQfLJXcQMtig20G/n6958JpQrkd6GIcUdlMCWWvPTSilQghVIGOMrFpOjLEE4tJ6qB3UpCoQqyl476WEBESqyKzFOQe7k+tLICptrvJ3y1AgGCLUNUfZe90blqFAsCKJmfwIPgqua61vW4hfAwkdNpu1XNeVH6XBQAnPJifr0Hau8+lw3Y9Z0nighBucnesAGiM6T5CleVZ6lolAsG4vECwN94dUP1oMItWpQGvoBuJjXgnd1P490F6qQDLzDujYPe5/6AU/4JUKUwnC3AAAAABJRU5ErkJggg==" y="41.83"/><text fill="#000" font-family="xkcd Script" font-size="14" lengthAdjust="spacing" textLength="9" x="224.5" y="75.0729">s1</text></g><g id="link_h1_s1"><path d="M72.39 60.66V60.9402L82.4117 60.1076 92.4333 60.9177 102.455 61.1929 112.4767 59.7088l10.0216.8476 10.0217-.4651L142.5417 60.1487 152.5633 60.5691l10.0217-.8309 10.0217 1.66 10.0216-1.5786L192.65 60.66" fill="none" style="stroke:#181818;stroke-width:1"/><text fill="#000" font-family="xkcd Script" font-size="13" lengthAdjust="spacing" textLength="43" x="80.0386" y="76.098">h1-eth0</text><text fill="#000" font-family="xkcd Script" font-size="13" lengthAdjust="spacing" textLength="38" x="147.1477" y="76.0979">s1-eth1</text></g><g id="link_s1_h2"><path d="M261.16 60.66V60.9402L271.1925 60.1076 281.225 60.9177 291.2575 61.1929 301.29 59.7088l10.0325.8476 10.0325-.4651L331.3875 60.1487 341.42 60.5691l10.0325-.8309 10.0325 1.66 10.0325-1.5786L381.55 60.66" fill="none" style="stroke:#181818;stroke-width:1"/><text fill="#000" font-family="xkcd Script" font-size="13" lengthAdjust="spacing" textLength="42" x="268.9169" y="76.0979">s1-eth2</text><text fill="#000" font-family="xkcd Script" font-size="13" lengthAdjust="spacing" textLength="47" x="326.9645" y="76.041">h2-eth0</text></g></g></svg><figcaption><p><span class=figure-number>Рис. 1.: </span>Лабораторная топология</p></figcaption></figure></li></ul><h3 id=рабочие-файлы><span class=section-num>3.2</span> Рабочие файлы</h3><ul><li>Подключимся к виртуальной машине:<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ssh -Y mininet@192.168.x.y
</span></span></code></pre></div></li><li>Для рабочих файлов будем использовать каталог <code>~/work/lab_netem_ii</code>:<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>mkdir -p ~/work/lab_netem_ii
</span></span></code></pre></div></li></ul><h2 id=интерактивный-эксперимент><span class=section-num>4</span> Интерактивный эксперимент</h2><h3 id=добавление-изменение-потери-пакетов><span class=section-num>4.1</span> Добавление/изменение потери пакетов</h3><ul><li><p>Работа с NETEM осуществляется с помощью утилиты командной строки <code>tc</code>.</p></li><li><p>Без дополнительных параметров NETEM ведёт себя как базовая очередь FIFO без задержек, потерь, дублирования или переупорядочения пакетов.</p></li><li><p>Основной синтаксис <code>tc</code>, используемый с NETEM, следующий:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>sudo tc qdisc <span class=o>[</span>add<span class=p>|</span>del<span class=p>|</span>replace<span class=p>|</span>change<span class=p>|</span>show<span class=o>]</span> dev dev_id root netem opts
</span></span></code></pre></div><ul><li><code>sudo</code>: выполнить команду с более высокими привилегиями;</li><li><code>tc</code>: команда, используемая для взаимодействия с NETEM;</li><li><code>qdisc</code>: дисциплина очереди (<code>qdisc</code>) представляет собой набор правил, определяющих порядок, в котором обслуживаются пакеты, поступающие по протоколу IP.<ul><li>Дисциплина очереди применяется к очереди пакетов, чтобы решить, когда отправлять каждый пакет.</li></ul></li><li><code>[add|del|replace|change|show]</code> (добавить, удалить, заменить, изменить, показать): операция над <code>qdisc</code>:<ul><li>чтобы добавить задержку на определённом интерфейсе, применяется операция <code>add</code>;</li><li>чтобы изменить или удалить задержку на определённом интерфейсе, применяется операция <code>change</code> или <code>del</code>;</li></ul></li><li><code>dev_id</code>: параметр указывает интерфейс, подлежащий эмуляции;</li><li><code>opts</code>: параметр указывает величину задержки, потери пакетов, дублирования, повреждения и другие.</li></ul></li></ul><h3 id=определение-интерфейсов-хостов-h1-и-h2><span class=section-num>4.2</span> Определение интерфейсов хостов <code>h1</code> и <code>h2</code></h3><ul><li>Необходимо идентифицировать интерфейсы на подключенных хостах.</li><li>На хосте <code>h1</code> введите команду <code>ifconfig</code>, чтобы отобразить информацию, относящуюся к его сетевым интерфейсам и назначенным им IP-адресам.<ul><li>Вывод команды <code>ifconfig</code> показывает, что хост <code>h1</code> имеет два интерфейса: <code>h1-eth0</code> и <code>lo</code>.</li><li>Интерфейс <code>h1-eth0</code> необходимо использовать в <code>tc</code> при эмуляции WAN.</li></ul></li><li>На хосте <code>h2</code> введите команду <code>ifconfig</code>.</li><li>Вывод команды <code>ifconfig</code> показывает, что хост <code>h2</code> имеет два интерфейса: <code>h2-eth0</code> и <code>lo</code>.</li><li>Интерфейс <code>h2-eth0</code> необходимо использовать в <code>tc</code> при эмуляции WAN.</li></ul><h3 id=добавка-потери-пакетов-на-интерфейс-подключённый-к-глобальной-сети><span class=section-num>4.3</span> Добавка потери пакетов на интерфейс, подключённый к глобальной сети</h3><ul><li>Пакеты могут быть потеряны во время передачи из-за таких факторов, как битовые ошибки и перегрузка сети.</li><li>Скорость потерянных пакетов часто измеряется как процентная доля потерянных пакетов по отношению к количеству отправленных пакетов.</li><li>В терминале хоста <code>h1</code> введите следующую команду:<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>tc qdisc add dev h1-eth0 root netem loss 10%
</span></span></code></pre></div></li><li>Эта команда добавляет 10% потери пакетов к интерфейсу <code>h1-eth0</code> хоста <code>h1</code>.</li><li>Теперь можно проверить наличие потерь пакетов, используя команду <code>ping</code> с терминала хоста <code>h1</code>. Параметр <code>-c</code> указывает общее количество пакетов для отправки:<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ping 10.0.0.2 -c <span class=m>200</span>
</span></span></code></pre></div></li><li>Обратите внимание на значения <code>icmp_seq</code>. Некоторые номера последовательности отсутствуют из-за потери пакетов.</li><li>В сводном отчёте <code>ping</code> сообщает о проценте потерянных пакетов после завершения передачи.</li><li>Данный сценарий эмулирует 10% потери пакетов в однонаправленном канале от хоста <code>h1</code> к хосту <code>h2</code>.</li><li>Если мы хотим эмулировать потерю пакетов в обоих направлениях, к хосту <code>h2</code> также необходимо добавить потерю пакетов в размере 10%.</li><li>В терминале хоста <code>h2</code> введите следующую команду:<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>tc qdisc add dev h2-eth0 root netem loss 10%
</span></span></code></pre></div></li><li>Можно убедиться, что соединение между хостом <code>h1</code> и хостом <code>h2</code> имеет больше потерь пакетов (10% от хоста <code>h1</code> + 10% от хоста <code>h2</code>), повторив команду <code>ping</code> на терминале хоста <code>h1</code>:<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ping 10.0.0.2 -c <span class=m>200</span>
</span></span></code></pre></div></li><li>Обратите внимание на значения <code>icmp_seq</code>. Некоторые номера последовательности отсутствуют из-за потери пакетов.</li><li>В сводном отчёте <code>ping</code> сообщает о проценте потерянных пакетов после завершения передачи.</li><li>Чтобы удалить добавленную потерю пакетов и восстановить конфигурацию по умолчанию, необходимо удалить правила интерфейсов на хосте <code>h1</code> и хосте <code>h2</code>.</li><li>В терминале хоста <code>h1</code> введите следующую команду:<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>tc qdisc del dev h1-eth0 root netem
</span></span></code></pre></div></li><li>Примените те же действия для удаления правил на хосте <code>h2</code>. В терминале хоста <code>h2</code> введите следующую команду:<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>tc qdisc del dev h2-eth0 root netem
</span></span></code></pre></div></li><li>В результате дисциплина организации очереди tc восстановит свои значения по умолчанию.</li><li>Теперь можно убедиться, что соединение от хоста <code>h1</code> к хосту <code>h2</code> не имеет явной потери пакетов.</li><li>Запустите команду <code>ping</code> с терминала хоста <code>h1</code>:<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ping 10.0.0.2
</span></span></code></pre></div></li><li>Нажмите <code>Ctrl+c</code>, чтобы остановить тест.</li></ul><h3 id=добавка-значения-корреляции-для-потери-пакетов><span class=section-num>4.4</span> Добавка значения корреляции для потери пакетов</h3><ul><li>Можно добавить необязательную корреляцию.</li><li>В терминале хоста <code>h1</code> введите следующую команду:<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>tc qdisc add dev h1-eth0 root netem loss 50% 50%
</span></span></code></pre></div></li><li>Команда вводит коэффициент потери пакетов 50% (такой высокий уровень потери пакетов маловероятен), и каждая последующая вероятность зависит на 50% от последней.</li><li>Теперь пользователь может проверить, что между хостом <code>h1</code> и хостом <code>h2</code> теряются пакеты, используя команду <code>ping</code> с терминала хоста <code>h1</code>:<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ping 10.0.0.2 -c <span class=m>50</span>
</span></span></code></pre></div></li><li>Обратите внимание на значения <code>icmp_seq</code>. Некоторые номера последовательности отсутствуют из-за потери пакетов.</li><li>В сводном отчёте <code>ping</code> сообщает о проценте потерянных пакетов после завершения передачи.</li><li>В терминале хоста <code>h1</code> введите следующую команду, чтобы удалить предыдущие конфигурации:<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>tc qdisc del dev h1-eth0 root netem
</span></span></code></pre></div></li></ul><h3 id=добавка-повреждения-пакетов><span class=section-num>4.5</span> Добавка повреждения пакетов</h3><ul><li>Помимо потери пакетов, с помощью NETEM можно эмулировать повреждение пакетов.</li><li>В терминале хоста <code>h1</code> введите следующую команду:<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>tc qdisc add dev h1-eth0 root netem corrupt 0.01%
</span></span></code></pre></div></li><li>Добавленное здесь новое значение представляет собой процент повреждения пакетов (0,01%).</li><li>Теперь пользователь может проверить предыдущую конфигурацию с помощью инструмента <code>iperf3</code> для проверки повторных передач.</li><li>Запустите iPerf3 в режиме сервера в терминале хоста <code>h2</code>:<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>iperf3 -s
</span></span></code></pre></div></li><li>Запустите iPerf3 в клиентском режиме в терминале хоста <code>h1</code>:<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>iperf3 -c 10.0.0.2
</span></span></code></pre></div></li><li>Посмотрите значения повторной передачи на каждом временном интервале и общее количество повторно переданных пакетов.</li><li>В терминале хоста <code>h1</code> введите следующую команду, чтобы удалить предыдущие конфигурации:<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>tc qdisc del dev h1-eth0 root netem
</span></span></code></pre></div></li><li>Чтобы остановить сервер, нажмите <code>Ctrl+c</code> в терминале хоста <code>h2</code>.</li></ul><h3 id=добавка-переупорядочивание-пакетов><span class=section-num>4.6</span> Добавка переупорядочивание пакетов</h3><ul><li>Иногда пакеты доставляются не в том порядке, в котором они были отправлены.</li><li>Для эмуляции переупорядочивания в NETEM используется опция переупорядочивания.</li><li>Посмотрим поведение трафика без переупорядочивания пакетов.</li><li>В терминале хоста <code>h1</code> введём:<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ping 10.0.0.2
</span></span></code></pre></div></li><li>Нажмите <code>Ctrl+c</code>, чтобы остановить тест.</li><li>В терминале хоста <code>h1</code> введите следующую команду:<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>tc qdisc add dev h1-eth0 root netem delay 10ms reorder 25% 50%
</span></span></code></pre></div></li><li>В этой команде 25% пакетов (со значением корреляции 50%) будут отправлены немедленно, а остальные 75% будут задержаны на 10 мс.</li><li>Пользователь может проверить эффект переупорядочивания пакетов с помощью команды <code>ping</code> на терминале хоста <code>h1</code> (нажмите <code>Ctrl+c</code>, чтобы остановить тест):<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ping 10.0.0.2
</span></span></code></pre></div></li><li>Первый и второй пакеты не будут иметь задержки (один из четырех, или 25%), а следующие три пакета будут иметь задержку около 10 миллисекунд (три из четырех, или 75%).</li><li>В терминале хоста <code>h1</code> введите следующую команду, чтобы удалить предыдущие конфигурации:<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>tc qdisc del dev h1-eth0 root netem
</span></span></code></pre></div></li></ul><h3 id=добавка-дублирования-пакетов><span class=section-num>4.7</span> Добавка дублирования пакетов</h3><ul><li>Дублированные пакеты могут присутствовать в сетях в результате повторных передач.</li><li>NETEM предоставляет возможность эмуляции дублирования пакетов.</li><li>В терминале хоста <code>h1</code> введите следующую команду:<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>tc qdisc add dev h1-eth0 root netem duplicate 50%
</span></span></code></pre></div></li><li>Команда создаст дублирование 50% (т. е. 50% пакетов будут получены дважды).</li><li>Пользователь может проверить эффект дублирования пакетов с помощью команды <code>ping</code> на терминале хоста <code>h1</code> (нажмите <code>Ctrl+c</code>, чтобы остановить тест):<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ping 10.0.0.2
</span></span></code></pre></div></li><li>Дубликаты пакетов помечаются как <code>DUP!</code>.</li><li>Измеренная скорость дублирования пакетов будет приближаться к настроенной скорости по мере выполнения большего количества попыток.</li><li>В терминале хоста <code>h1</code> введите следующую команду, чтобы удалить предыдущие конфигурации:<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>tc qdisc del dev h1-eth0 root netem
</span></span></code></pre></div></li></ul><h3 id=видео-использование-netem-ii-dot-интерактивный-эксперимент><span class=section-num>4.8</span> Видео: Использование netem II. Интерактивный эксперимент</h3><nav><div class="nav nav-tabs" id=nav-tab role=tablist><a class="nav-item nav-link active" id=nav-afebdc data-toggle=tab href=#afebdc role=tab aria-controls=nav-home aria-selected=true>RuTube</a>
<a class="nav-item nav-link" id=nav-dafecb data-toggle=tab href=#dafecb role=tab aria-controls=nav-home aria-selected=true>Youtube</a></div></nav><div class=tab-content id=nav-tab-content><div class="tab-pane fade show active" id=afebdc role=tabpanel aria-labelledby=nav-1><div class="embed video-player"><iframe class=rutube-player type=text/html width=720 height=405 src=https://rutube.ru/play/embed/b374d511a828ef5d969a6c538f9d18b1 webkitallowfullscreen mozallowfullscreen allowfullscreen allow=clipboard-write frameborder=0></iframe></div></div><div class="tab-pane fade show" id=dafecb role=tabpanel aria-labelledby=nav-1><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen loading=eager referrerpolicy=strict-origin-when-cross-origin src="https://www.youtube.com/embed/l061lvu_8w4?autoplay=0&controls=1&end=0&loop=0&mute=0&start=0" style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 title="YouTube video"></iframe></div></div></div><h2 id=воспроизводимый-эксперимент><span class=section-num>5</span> Воспроизводимый эксперимент</h2><h3 id=постановка-задания><span class=section-num>5.1</span> Постановка задания</h3><ul><li>Будем исследовать задержки и построим графики для них.</li><li>Выполните все интерактивные эксперименты в виде воспроизводимых.</li><li>Для каждого эксперимента <code>expname</code> создайте свой каталог:<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>mkdir -p ~/work/lab_netem_ii/expname
</span></span></code></pre></div></li><li>В него мы будем помещать файлы эксперимента.</li><li>Здесь <code>expname</code> может принимать значения <code>simple-drop</code>, <code>correlation-drop</code> и т.п.</li><li>Для каждого эксперимента создайте скрипт для проведения эксперимента <code>lab_netem_i.py</code> и скрипт для визуализации <code>ping_plot</code>.</li><li>Кроме визуализации вычислите минимальное, среднее, максимальное и стандартное отклонение времени приёма-передачи.</li><li>Для примера реализуем задание простейшей задержки.</li></ul><h3 id=добавление-потери-пакетов-на-интерфейс-подключённый-к-эмулируемой-глобальной-сети><span class=section-num>5.2</span> Добавление потери пакетов на интерфейс, подключённый к эмулируемой глобальной сети</h3><ul><li>В качестве примера исследуем</li><li>Создадим каталог <code>simple-drop</code>:<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>mkdir -p ~/work/lab_netem_ii/simple-drop
</span></span><span class=line><span class=cl><span class=nb>cd</span> ~/work/lab_netem_ii/simple-drop
</span></span></code></pre></div></li><li>Создадим скрипт для эксперимента <code>lab_netem_ii.py</code>:<div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/env python</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>Simple experiment.
</span></span></span><span class=line><span class=cl><span class=s2>Output: ping.dat
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>mininet.net</span> <span class=kn>import</span> <span class=n>Mininet</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>mininet.node</span> <span class=kn>import</span> <span class=n>Controller</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>mininet.cli</span> <span class=kn>import</span> <span class=n>CLI</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>mininet.log</span> <span class=kn>import</span> <span class=n>setLogLevel</span><span class=p>,</span> <span class=n>info</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>emptyNet</span><span class=p>():</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;Create an empty network and add nodes to it.&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>net</span> <span class=o>=</span> <span class=n>Mininet</span><span class=p>(</span> <span class=n>controller</span><span class=o>=</span><span class=n>Controller</span><span class=p>,</span> <span class=n>waitConnected</span><span class=o>=</span><span class=kc>True</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>info</span><span class=p>(</span> <span class=s1>&#39;*** Adding controller</span><span class=se>\n</span><span class=s1>&#39;</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>net</span><span class=o>.</span><span class=n>addController</span><span class=p>(</span> <span class=s1>&#39;c0&#39;</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>info</span><span class=p>(</span> <span class=s1>&#39;*** Adding hosts</span><span class=se>\n</span><span class=s1>&#39;</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>h1</span> <span class=o>=</span> <span class=n>net</span><span class=o>.</span><span class=n>addHost</span><span class=p>(</span> <span class=s1>&#39;h1&#39;</span><span class=p>,</span> <span class=n>ip</span><span class=o>=</span><span class=s1>&#39;10.0.0.1&#39;</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>h2</span> <span class=o>=</span> <span class=n>net</span><span class=o>.</span><span class=n>addHost</span><span class=p>(</span> <span class=s1>&#39;h2&#39;</span><span class=p>,</span> <span class=n>ip</span><span class=o>=</span><span class=s1>&#39;10.0.0.2&#39;</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>info</span><span class=p>(</span> <span class=s1>&#39;*** Adding switch</span><span class=se>\n</span><span class=s1>&#39;</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>s1</span> <span class=o>=</span> <span class=n>net</span><span class=o>.</span><span class=n>addSwitch</span><span class=p>(</span> <span class=s1>&#39;s1&#39;</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>info</span><span class=p>(</span> <span class=s1>&#39;*** Creating links</span><span class=se>\n</span><span class=s1>&#39;</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>net</span><span class=o>.</span><span class=n>addLink</span><span class=p>(</span> <span class=n>h1</span><span class=p>,</span> <span class=n>s1</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>net</span><span class=o>.</span><span class=n>addLink</span><span class=p>(</span> <span class=n>h2</span><span class=p>,</span> <span class=n>s1</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>info</span><span class=p>(</span> <span class=s1>&#39;*** Starting network</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>net</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>info</span><span class=p>(</span> <span class=s1>&#39;*** Set loss</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>h1</span><span class=o>.</span><span class=n>cmdPrint</span><span class=p>(</span> <span class=s1>&#39;tc qdisc add dev h1-eth0 root netem loss 10%&#39;</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>h2</span><span class=o>.</span><span class=n>cmdPrint</span><span class=p>(</span> <span class=s1>&#39;tc qdisc add dev h2-eth0 root netem loss 10%&#39;</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>  <span class=c1># Wait 10 seconds</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>info</span><span class=p>(</span> <span class=s1>&#39;*** Ping</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>h1</span><span class=o>.</span><span class=n>cmdPrint</span><span class=p>(</span> <span class=s1>&#39;ping -c 200&#39;</span><span class=p>,</span> <span class=n>h2</span><span class=o>.</span><span class=n>IP</span><span class=p>(),</span> <span class=s1>&#39;| grep &#34;time=&#34; | awk </span><span class=se>\&#39;</span><span class=s1>{print $5, $7}</span><span class=se>\&#39;</span><span class=s1> | sed -e </span><span class=se>\&#39;</span><span class=s1>s/time=//g</span><span class=se>\&#39;</span><span class=s1> -e </span><span class=se>\&#39;</span><span class=s1>s/icmp_seq=//g</span><span class=se>\&#39;</span><span class=s1> &gt; ping.dat&#39;</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>info</span><span class=p>(</span> <span class=s1>&#39;*** Stopping network&#39;</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>net</span><span class=o>.</span><span class=n>stop</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>setLogLevel</span><span class=p>(</span> <span class=s1>&#39;info&#39;</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>emptyNet</span><span class=p>()</span>
</span></span></code></pre></div></li><li>Создадим скрипт для визуализации <code>ping_plot</code>:<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=cp>#!/usr/bin/gnuplot --persist
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=nb>set</span> terminal png crop
</span></span><span class=line><span class=cl><span class=nb>set</span> output <span class=s1>&#39;ping.png&#39;</span>
</span></span><span class=line><span class=cl><span class=nb>set</span> xlabel <span class=s2>&#34;Sequence number&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>set</span> ylabel <span class=s2>&#34;Delay (ms)&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>set</span> grid
</span></span><span class=line><span class=cl>plot <span class=s2>&#34;ping.dat&#34;</span> with lines
</span></span></code></pre></div></li><li>Зададим права доступа:<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>chmod +x ping_plot
</span></span></code></pre></div></li><li>Создадим <code>Makefile</code>:<div class=highlight><pre tabindex=0 class=chroma><code class=language-makefile data-lang=makefile><span class=line><span class=cl><span class=nf>all</span><span class=o>:</span> <span class=n>ping</span>.<span class=n>dat</span> <span class=n>ping</span>.<span class=n>png</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>ping.dat</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        sudo python lab_netem_i.py
</span></span><span class=line><span class=cl>        sudo chown mininet:mininet ping.dat
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>ping.png</span><span class=o>:</span> <span class=n>ping</span>.<span class=n>dat</span>
</span></span><span class=line><span class=cl>        ./ping_plot
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>clean</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        -rm -f *.dat *.png
</span></span></code></pre></div></li><li>Выполним эксперимент:<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>make
</span></span></code></pre></div></li><li>Посмотрите график.</li><li>Вычислите минимальное, среднее, максимальное и стандартное отклонение времени приёма-передачи.</li><li>Очистите каталог от результатов проведения экспериментов:<div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>make clean
</span></span></code></pre></div></li></ul></article><div class=article-tags><a class="badge badge-light" href=https://yamadharma.github.io/ru/tag/network/>Network</a>
<a class="badge badge-light" href=https://yamadharma.github.io/ru/tag/education/>Education</a></div><div class=article-widget><div class=post-nav><div class=post-nav-item><div class=meta-nav>Предыдущий</div><a href=https://yamadharma.github.io/ru/course/simulation-networks/lab/mininet-netem-i/ rel=next>Mininet. Использование netem (latency, jitter)</a></div><div class=post-nav-item><div class=meta-nav>Следующий</div><a href=https://yamadharma.github.io/ru/course/simulation-networks/lab/mininet-token-bucket-filter/ rel=prev>Mininet. Token Bucket Filter</a></div></div></div></div><div class=body-footer><p>Обновлено 2023-10-12</p><div class="article-widget content-widget-hr"><h3>Похожие</h3><ul><li><a href=https://yamadharma.github.io/ru/post/2023/10/08/gns3-kvm-disable/>Отключение поддержки KVM в GNS3</a></li><li><a href=https://yamadharma.github.io/ru/post/2022/11/29/gns3-hyperv/>GNS3 на Hyper-V</a></li><li><a href=https://yamadharma.github.io/ru/course/simulation-networks/lab/mininet-netem-i/>Mininet. Использование netem (latency, jitter)</a></li><li><a href=https://yamadharma.github.io/ru/course/simulation-networks/lab/mininet-iperf-intro/>Mininet. Введение в Iperf</a></li><li><a href=https://yamadharma.github.io/ru/course/nettech/configuring-dhcpv6-ipv6/>Адресация IPv4 и IPv6. Настройка DHCPv6 для IPv6</a></li></ul></div></div><footer class=site-footer><p class="powered-by copyright-license-text">© 2006—2024 Dmitry S. Kulyabov. This work is licensed under <a href=https://creativecommons.org/licenses/by/4.0 rel="noopener noreferrer" target=_blank>CC BY 4.0</a></p><p class="powered-by footer-license-icons"><a href=https://creativecommons.org/licenses/by/4.0 rel="noopener noreferrer" target=_blank aria-label="Creative Commons"><i class="fab fa-creative-commons fa-2x" aria-hidden=true></i>
<i class="fab fa-creative-commons-by fa-2x" aria-hidden=true></i></a></p><p class=powered-by>Published with <a href="https://hugoblox.com/?utm_campaign=poweredby" target=_blank rel=noopener>Hugo Blox Builder</a> — the free, <a href=https://github.com/HugoBlox/hugo-blox-builder target=_blank rel=noopener>open source</a> website builder that empowers creators.</p></footer></main></div></div></div><div class=page-footer></div><script src=https://yamadharma.github.io/js/vendor-bundle.min.50933d940896e49f984a778650d5f7f5.js></script><script src=https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.js integrity crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/anchor-js@5.0.0/anchor.min.js integrity="sha256-aQmOEF2ZD4NM/xt4hthzREIo/2PFkOX/g01WjxEV7Ys=" crossorigin=anonymous></script><script>anchors.add()</script><script id=search-hit-fuse-template type=text/x-template>
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script><script src=https://cdn.jsdelivr.net/gh/krisk/Fuse@v3.2.1/dist/fuse.min.js integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/gh/julmot/mark.js@8.11.1/dist/jquery.mark.min.js integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin=anonymous></script><script id=page-data type=application/json>{"use_headroom":false}</script><script src=https://yamadharma.github.io/ru/js/wowchemy.min.38bc0c3a6a7eed1b35a03377dafb000b.js></script><script src=https://yamadharma.github.io/js/wowchemy-map.a26e9d2f7238ba5b868384f1c5bc6477.js type=module></script><div id=modal class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><h5 class=modal-title>Процитировать</h5><button type=button class=close data-dismiss=modal aria-label=Close>
<span aria-hidden=true>&#215;</span></button></div><div class=modal-body><pre><code></code></pre></div><div class=modal-footer><a class="btn btn-outline-primary my-1 js-copy-cite" href=# target=_blank><i class="fas fa-copy"></i> Копия
</a><a class="btn btn-outline-primary my-1 js-download-cite" href=# target=_blank><i class="fas fa-download"></i> Скачать</a><div id=modal-error></div></div></div></div></div><script src=https://yamadharma.github.io/js/wowchemy-publication.9c0e895144aef5a693008b5c5d450147.js type=module></script></body></html>