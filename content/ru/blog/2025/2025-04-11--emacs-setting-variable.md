---
title: "Emacs. Установка значения переменной"
author: ["Dmitry S. Kulyabov"]
date: 2025-04-11T09:38:00+03:00
lastmod: 2025-04-11T19:20:00+03:00
tags: ["emacs"]
categories: ["computer-science"]
draft: false
slug: "emacs-setting-variable"
---

Emacs. Установка значения переменной.

<!--more-->

{{< toc >}}


## <span class="section-num">1</span> Общая информация {#общая-информация}

-   Основные функции для присваивания значения:
    -   `set`, `setq`
    -   `set-default`
    -   `defcustom`
    -   `custom-set-value`
    -   `custom-set-variables`
    -   `customize-set-value`
    -   `customize-set-variable`
    -   `setopt`


## <span class="section-num">2</span> Функции установки значения переменной {#функции-установки-значения-переменной}

-   В Emacs существует несколько способов работы с переменными.


### <span class="section-num">2.1</span> setq {#setq}

-   Базовая функция для установки значения переменной
-   Просто присваивает новое значение без дополнительной логики
-   Работает с любыми переменными, не только с пользовательскими опциями
-   Не вызывает пользовательские функции установки (set functions)
    ```elisp
    (setq my-variable "значение")
    ```


### <span class="section-num">2.2</span> setopt {#setopt}

-   Введено в Emacs 29 как более безопасная альтернатива `setq`
-   Вызывает все связанные функции установки
-   Выполняет проверку типа значения
-   Рекомендуется использовать для пользовательских опций
    ```elisp
    (setopt my-custom-variable "значение")
    ```


### <span class="section-num">2.3</span> custom-set-variable {#custom-set-variable}

-   Часть системы пользовательских настроек Emacs
-   Создаёт запись в файле настроек
-   Обеспечивает совместимость с интерфейсом настроек Emacs
-   Вызывает функции установки и валидации
-   Сохраняет значение в памяти и в файле настроек
-   Разработчик пакета может перехватить присваивание значения переменной, объявленной с помощью `defcustom`, и выполнить какой-то дополнительный код.
    ```elisp
    (custom-set-variable 'my-custom-variable "значение")
    ```


## <span class="section-num">3</span> Различия {#различия}


### <span class="section-num">3.1</span> Назначение {#назначение}

-   `setq` - для простой установки значений
-   `setopt` - для безопасной установки пользовательских опций
-   `custom-set-variable` - для установки значений с сохранением в файл настроек


### <span class="section-num">3.2</span> Функциональность {#функциональность}

-   `setq` просто присваивает значение
-   `setopt` выполняет проверку и вызывает функции установки
-   `custom-set-variable` делает то же, что и `setopt`, плюс сохраняет в файл


### <span class="section-num">3.3</span> Использование {#использование}

-   `set` : основная функция для установки значения переменной
-   `setq` : версия, которая автоматически квотирует свой первый аргумент.
    -   `(setq foo bar)` есть сокращение от `(set (quote foo) bar)`
    -   Это полезно, поскольку цитирование первого аргумента — это то, что вы хотите сделать почти всегда.
    -   `setq` используется для любых переменных в коде
-   `setq-default` : `(set-default foo bar)` означает «если только не существует более четкого определения `foo`, в текущем буфере использовать строку значений».
    -   Применяется ко всем буферам.
    -   Некоторые переменные не могут быть установлены глобально.
    -   Всякий раз, когда вы устанавливаете переменную, она устанавливается только для текущего буфера.
    -   Если вы хотите имитировать установку этой переменной глобально, вы используете `set-default` или `setq-default` .
-   `setopt` : рекомендуется для пользовательских опций
-   `custom-set-variable` : применяется при работе с пользовательскими настройками
-   `defvar` : позволяет писателю пакета определить переменную и предоставить некоторую документацию
-   `defcustom` базируется на `defvar`.
    -   Позволяет указать место в иерархии параметров, а также информацию о типе данных.
    -   Сообщает emacs, что это переменная, и позволяет разработчику создать `custom` интерфейс для установки значения.
    -   Можно задать ограничения на значения переменной.


### <span class="section-num">3.4</span> Рекомендации по использованию {#рекомендации-по-использованию}

-   Используйте `setq` или `setq-default` для:
    -   установки значений обычных переменных
    -   временных переменных в функциях
    -   переменных, не требующих специальной обработки

<!--listend-->

-   Используйте `setopt` для:
    -   установки значений пользовательских опций
    -   переменных, определенных через `defcustom`
    -   когда важна проверка типа и вызов функций установки

-   Используйте `custom-set-variable` для:
    -   установки пользовательских настроек через интерфейс настроек
    -   когда нужно сохранить значение в файл настроек
    -   при работе с пользовательским интерфейсом настроек


### <span class="section-num">3.5</span> Пример использования {#пример-использования}

```elisp
;; Простая установка переменной
(setq my-temp-variable "временное значение")

;; Безопасная установка пользовательской опции
(setopt my-custom-variable "безопасное значение")

;; Установка через пользовательский интерфейс
(custom-set-variable 'my-custom-variable "сохраненное значение")
```

-   `custom-set-variable` обычно используется автоматически при настройке через интерфейс настроек Emacs
-   `setopt` является рекомендуемым способом установки пользовательских опций наямная с Emacs 29
-   `setq` остается базовым способом установки значений без дополнительной логики
