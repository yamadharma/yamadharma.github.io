<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>gentoo | Д. С. Кулябов</title><link>https://yamadharma.github.io/ru/tag/gentoo/</link><atom:link href="https://yamadharma.github.io/ru/tag/gentoo/index.xml" rel="self" type="application/rss+xml"/><description>gentoo</description><generator>Wowchemy (https://wowchemy.com)</generator><language>ru-ru</language><copyright>© 2023 Dmitry S. Kulyabov</copyright><lastBuildDate>Sat, 17 Sep 2022 13:31:00 +0300</lastBuildDate><image><url>https://yamadharma.github.io/media/icon_hu0a661dd90139895e92e2f18ae9404407_611148_512x512_fill_lanczos_center_3.png</url><title>gentoo</title><link>https://yamadharma.github.io/ru/tag/gentoo/</link></image><item><title>Стандартные каталоги Gentoo</title><link>https://yamadharma.github.io/ru/post/2022/09/17/gentoo-standard-directories/</link><pubDate>Sat, 17 Sep 2022 13:31:00 +0300</pubDate><guid>https://yamadharma.github.io/ru/post/2022/09/17/gentoo-standard-directories/</guid><description>&lt;p>Стандартные каталоги Gentoo.&lt;/p>
&lt;details class="toc-inpage d-print-none " open>
&lt;summary class="font-weight-bold">Содержание&lt;/summary>
&lt;nav id="TableOfContents">
&lt;ul>
&lt;li>&lt;a href="#конфигурация-portage">&lt;span class="section-num">1&lt;/span> Конфигурация portage&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#основные-файлы-настройки">&lt;span class="section-num">1.1&lt;/span> Основные файлы настройки&lt;/a>&lt;/li>
&lt;li>&lt;a href="#информация-из-определённого-профиля">&lt;span class="section-num">1.2&lt;/span> Информация из определённого профиля&lt;/a>&lt;/li>
&lt;li>&lt;a href="#пользовательская-конфигурация">&lt;span class="section-num">1.3&lt;/span> Пользовательская конфигурация&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#каталоги-системы-portage">&lt;span class="section-num">2&lt;/span> Каталоги системы portage&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#изменение-расположения-каталогов">&lt;span class="section-num">2.1&lt;/span> Изменение расположения каталогов&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#миграция-каталогов">&lt;span class="section-num">2.1.1&lt;/span> Миграция каталогов&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#репозитории-ebuild-файлов">&lt;span class="section-num">2.2&lt;/span> Репозитории ebuild-файлов&lt;/a>&lt;/li>
&lt;li>&lt;a href="#gentoo-репозиторий-ebuild-файлов">&lt;span class="section-num">2.3&lt;/span> Gentoo репозиторий ebuild-файлов&lt;/a>&lt;/li>
&lt;li>&lt;a href="#двоичные-пакеты">&lt;span class="section-num">2.4&lt;/span> Двоичные пакеты&lt;/a>&lt;/li>
&lt;li>&lt;a href="#исходный-код">&lt;span class="section-num">2.5&lt;/span> Исходный код&lt;/a>&lt;/li>
&lt;li>&lt;a href="#база-состояния-portage">&lt;span class="section-num">2.6&lt;/span> База состояния Portage&lt;/a>&lt;/li>
&lt;li>&lt;a href="#кеш-portage">&lt;span class="section-num">2.7&lt;/span> Кеш Portage&lt;/a>&lt;/li>
&lt;li>&lt;a href="#временные-файлы-portage">&lt;span class="section-num">2.8&lt;/span> Временные файлы Portage&lt;/a>&lt;/li>
&lt;li>&lt;a href="#каталог-компиляции">&lt;span class="section-num">2.9&lt;/span> Каталог компиляции&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/nav>
&lt;/details>
&lt;h2 id="конфигурация-portage">&lt;span class="section-num">1&lt;/span> Конфигурация portage&lt;/h2>
&lt;h3 id="основные-файлы-настройки">&lt;span class="section-num">1.1&lt;/span> Основные файлы настройки&lt;/h3>
&lt;ul>
&lt;li>Portage поставляется с настройками по умолчанию, которые хранятся в &lt;code>/usr/share/portage/config/make.globals&lt;/code>.&lt;/li>
&lt;li>Все настройки Portage обрабатываются с помощью переменных.&lt;/li>
&lt;li>У portage есть конфигурационные файлы по умолчанию, которые является частью системного профиля.&lt;/li>
&lt;li>Системный профиль задаётся с помощью символьной ссылки &lt;code>/etc/portage/make.profile&lt;/code>.&lt;/li>
&lt;li>Для замены конфигурационных переменных следует использовать файл &lt;code>/etc/portage/make.conf&lt;/code>.&lt;/li>
&lt;li>Пример конфигурационного файла: &lt;code>/usr/share/portage/config/make.conf.example&lt;/code>.&lt;/li>
&lt;/ul>
&lt;h3 id="информация-из-определённого-профиля">&lt;span class="section-num">1.2&lt;/span> Информация из определённого профиля&lt;/h3>
&lt;ul>
&lt;li>Каталог &lt;code>/etc/portage/make.profile&lt;/code> является символьной ссылкой на один из профилей.&lt;/li>
&lt;li>По умолчанию это &lt;code>/var/db/repos/gentoo/profiles/&lt;/code>.&lt;/li>
&lt;li>Профиль, на который указывает символьная ссылка, и есть системный профиль.&lt;/li>
&lt;li>Профиль содержит информацию о конкретной архитектуре и настройках программного обеспечения.&lt;/li>
&lt;/ul>
&lt;h3 id="пользовательская-конфигурация">&lt;span class="section-num">1.3&lt;/span> Пользовательская конфигурация&lt;/h3>
&lt;ul>
&lt;li>Для пользовательских настроек следует использовать файлы в &lt;code>/etc/portage/&lt;/code>.&lt;/li>
&lt;li>Пользователи могут создать в &lt;code>/etc/portage/&lt;/code> следующие файлы:
&lt;ul>
&lt;li>&lt;code>package.mask&lt;/code>: список пакетов, которые Portage никогда не будет устанавливать;&lt;/li>
&lt;li>&lt;code>package.unmask&lt;/code>: список пакетов, которые Portage будет устанавливать, даже если они заблокированы на системном уровне;&lt;/li>
&lt;li>&lt;code>package.accept_keywords&lt;/code>: список пакетов, которые Portage будет устанавливать, даже если они не подходят для используемой системы или архитектуры;&lt;/li>
&lt;li>&lt;code>package.use&lt;/code> список пакетов, для которых необходимо использовать специфичные USE-флаги, а не брать системные USE-флаги.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Они могут быть не файлами, а каталогами (содержимое разбито по отдельным файлам).&lt;/li>
&lt;/ul>
&lt;h2 id="каталоги-системы-portage">&lt;span class="section-num">2&lt;/span> Каталоги системы portage&lt;/h2>
&lt;h3 id="изменение-расположения-каталогов">&lt;span class="section-num">2.1&lt;/span> Изменение расположения каталогов&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>На основании обсуждения &lt;a href="https://bugs.gentoo.org/662982" target="_blank" rel="noopener">#662982&lt;/a> были внесены изменения в расположение каталогов portage.&lt;/p>
&lt;div class="table-caption">
&lt;span class="table-number">&amp;#1058;&amp;#1072;&amp;#1073;&amp;#1083;&amp;#1080;&amp;#1094;&amp;#1072; 1:&lt;/span>
Смена расположения каталогов системы portage
&lt;/div>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Назначение&lt;/th>
&lt;th>Старый путь&lt;/th>
&lt;th>Новый путь&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Дерево portage&lt;/td>
&lt;td>&lt;code>/usr/portage&lt;/code>&lt;/td>
&lt;td>&lt;code>/var/db/repos/gentoo&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Исходный код пакетов&lt;/td>
&lt;td>&lt;code>/usr/portage/distfiles&lt;/code>&lt;/td>
&lt;td>&lt;code>/var/cache/distfiles&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Бинарные пакеты&lt;/td>
&lt;td>&lt;code>/usr/portage/packages&lt;/code>&lt;/td>
&lt;td>&lt;code>/var/cache/binpkgs&lt;/code>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;/li>
&lt;/ul>
&lt;h4 id="миграция-каталогов">&lt;span class="section-num">2.1.1&lt;/span> Миграция каталогов&lt;/h4>
&lt;ul>
&lt;li>Удалите (или закомментируйте) любые записи &lt;code>PORTDIR&lt;/code>, &lt;code>DISTDIR&lt;/code>, &lt;code>PKGDIR&lt;/code> в &lt;code>/etc/portage/make.conf&lt;/code>.&lt;/li>
&lt;li>Значения переменных окружения можно посмотреть командой:
&lt;pre>&lt;code class="language-shell">emerge --info -v
emerge --info -v | grep PORTDIR
emerge --info -v | grep DISTDIR
emerge --info -v | grep PKGDIR
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Если &lt;code>/var/db/repos/&lt;/code> не существует, создайте его.&lt;/li>
&lt;li>Переместите &lt;code>/usr/portage/distfiles&lt;/code> в &lt;code>/var/cache/distfiles&lt;/code>.&lt;/li>
&lt;li>Переместите &lt;code>/usr/portage/packages&lt;/code> в &lt;code>/var/cache/binpkgs&lt;/code>.&lt;/li>
&lt;li>Переместите &lt;code>/usr/portage&lt;/code> в &lt;code>/var/db/repos/gentoo&lt;/code>.&lt;/li>
&lt;li>Измените переменную &lt;code>location&lt;/code> в файле &lt;code>/etc/portage/repos.conf/gentoo.conf&lt;/code> (или аналогичном) на &lt;code>/var/db/repos/gentoo&lt;/code>.&lt;/li>
&lt;li>Переустановите &lt;code>portage&lt;/code>:
&lt;pre>&lt;code class="language-shell">DISTDIR=/var/cache/distfiles PKGDIR=/var/cache/binpkgs emerge --oneshot portage
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Если вы запускаете локальное зеркало rsync, отредактируйте запись пути в &lt;code>/etc/rsyncd.conf&lt;/code> так, чтобы она указывала на &lt;code>/var/db/repos/gentoo&lt;/code>.&lt;/li>
&lt;li>Если вы делитесь своими дистрибутивами, не забудьте обновить любую символическую ссылку или файл конфигурации, которые вам нужны для этого.&lt;/li>
&lt;/ul>
&lt;h3 id="репозитории-ebuild-файлов">&lt;span class="section-num">2.2&lt;/span> Репозитории ebuild-файлов&lt;/h3>
&lt;ul>
&lt;li>Репозитории ebuild-файлов по умолчанию находится в /var/db/repos/&amp;lt;reponame&amp;gt;.&lt;/li>
&lt;/ul>
&lt;h3 id="gentoo-репозиторий-ebuild-файлов">&lt;span class="section-num">2.3&lt;/span> Gentoo репозиторий ebuild-файлов&lt;/h3>
&lt;ul>
&lt;li>Gentoo репозиторий ebuild-файлов по умолчанию находится в &lt;code>/var/db/repos/gentoo&lt;/code>.&lt;/li>
&lt;li>Месторасположение определяется файлом &lt;code>repos.conf&lt;/code>, пример которого можно найти в &lt;code>/usr/share/portage/config/repos.conf&lt;/code>.&lt;/li>
&lt;li>Чтобы изменить значения по умолчанию, скопируйте этот файл в &lt;code>/etc/portage/repos.conf/gentoo.conf&lt;/code> и измените &lt;code>location&lt;/code>.&lt;/li>
&lt;li>Не забудьте сменить символьную ссылку на &lt;code>/etc/portage/make.profile&lt;/code>, если хотите хранить (меняя переменную) Gentoo репозиторий ebuild-файлов в другом месте.&lt;/li>
&lt;li>После изменения настройки location в &lt;code>/etc/portage/repos.conf/gentoo.conf&lt;/code> рекомендуется изменить следующие переменные &lt;code>/etc/portage/make.conf&lt;/code>, так как они не заметят изменений в &lt;code>location&lt;/code>: &lt;code>PKGDIR&lt;/code>, &lt;code>DISTDIR&lt;/code>, &lt;code>RPMDIR&lt;/code>.&lt;/li>
&lt;/ul>
&lt;h3 id="двоичные-пакеты">&lt;span class="section-num">2.4&lt;/span> Двоичные пакеты&lt;/h3>
&lt;ul>
&lt;li>Бинарные пакеты находятся в каталоге &lt;code>/var/cache/binpkgs&lt;/code>.&lt;/li>
&lt;li>Этот каталог определяется переменной &lt;code>PKGDIR&lt;/code>.&lt;/li>
&lt;/ul>
&lt;h3 id="исходный-код">&lt;span class="section-num">2.5&lt;/span> Исходный код&lt;/h3>
&lt;ul>
&lt;li>По умолчанию исходный код для приложений хранится в каталоге &lt;code>/var/cache/distfiles&lt;/code>.&lt;/li>
&lt;li>Этот каталог определяется переменной &lt;code>DISTDIR&lt;/code>.&lt;/li>
&lt;/ul>
&lt;h3 id="база-состояния-portage">&lt;span class="section-num">2.6&lt;/span> База состояния Portage&lt;/h3>
&lt;ul>
&lt;li>База состояния системы (какие пакеты установлены, какие файлы какому пакету принадлежат и т.д.) находится в каталоге &lt;code>/var/db/pkg&lt;/code>.&lt;/li>
&lt;/ul>
&lt;h3 id="кеш-portage">&lt;span class="section-num">2.7&lt;/span> Кеш Portage&lt;/h3>
&lt;ul>
&lt;li>Кэш portage хранится в &lt;code>/var/cache/edb&lt;/code>.&lt;/li>
&lt;li>Можно отчистить это каталог, если на данный момент не запущено никаких приложений Portage.&lt;/li>
&lt;/ul>
&lt;h3 id="временные-файлы-portage">&lt;span class="section-num">2.8&lt;/span> Временные файлы Portage&lt;/h3>
&lt;ul>
&lt;li>Временные файлы Portage по умолчанию хранятся в &lt;code>/var/tmp/&lt;/code>.&lt;/li>
&lt;li>Этот каталог определяется с помощью переменной &lt;code>PORTAGE_TMPDIR&lt;/code>.&lt;/li>
&lt;/ul>
&lt;h3 id="каталог-компиляции">&lt;span class="section-num">2.9&lt;/span> Каталог компиляции&lt;/h3>
&lt;ul>
&lt;li>Portage создаёт специальные каталоги в &lt;code>/var/tmp/portage/&lt;/code> для всех компилируемых пакетов.&lt;/li>
&lt;li>Этот каталог определяется переменной &lt;code>PORTAGE_TMPDIR&lt;/code>.&lt;/li>
&lt;/ul></description></item><item><title>Linux. Дистрибутив Gentoo</title><link>https://yamadharma.github.io/ru/post/2022/09/17/linux-gentoo-distribution/</link><pubDate>Sat, 17 Sep 2022 13:18:00 +0300</pubDate><guid>https://yamadharma.github.io/ru/post/2022/09/17/linux-gentoo-distribution/</guid><description>&lt;p>Дистрибутив Gentoo.&lt;/p>
&lt;details class="toc-inpage d-print-none " open>
&lt;summary class="font-weight-bold">Содержание&lt;/summary>
&lt;nav id="TableOfContents">
&lt;ul>
&lt;li>&lt;a href="#общая-информация">&lt;span class="section-num">1&lt;/span> Общая информация&lt;/a>&lt;/li>
&lt;li>&lt;a href="#администрирование-gentoo">&lt;span class="section-num">2&lt;/span> Администрирование Gentoo&lt;/a>&lt;/li>
&lt;/ul>
&lt;/nav>
&lt;/details>
&lt;h2 id="общая-информация">&lt;span class="section-num">1&lt;/span> Общая информация&lt;/h2>
&lt;h2 id="администрирование-gentoo">&lt;span class="section-num">2&lt;/span> Администрирование Gentoo&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://yamadharma.github.io/ru/post/2022/09/17/gentoo-standard-directories/">Стандартные каталоги Gentoo&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Перенос Linux на btrfs</title><link>https://yamadharma.github.io/ru/post/2021/05/21/installing-linux-btrfs/</link><pubDate>Fri, 21 May 2021 20:38:00 +0300</pubDate><guid>https://yamadharma.github.io/ru/post/2021/05/21/installing-linux-btrfs/</guid><description>&lt;p>Перенос Gentoo Linux с одного диска на другой. На новом диске делается система btrfs.&lt;/p>
&lt;details class="toc-inpage d-print-none " open>
&lt;summary class="font-weight-bold">Содержание&lt;/summary>
&lt;nav id="TableOfContents">
&lt;ul>
&lt;li>&lt;a href="#исходное-состояние-системы">&lt;span class="section-num">1&lt;/span> Исходное состояние системы&lt;/a>&lt;/li>
&lt;li>&lt;a href="#разбиение-диска">&lt;span class="section-num">2&lt;/span> Разбиение диска&lt;/a>&lt;/li>
&lt;li>&lt;a href="#подготовка-раздела-с-btrfs">&lt;span class="section-num">3&lt;/span> Подготовка раздела с btrfs&lt;/a>&lt;/li>
&lt;li>&lt;a href="#копирование-существующих-файловых-систем">&lt;span class="section-num">4&lt;/span> Копирование существующих файловых систем&lt;/a>&lt;/li>
&lt;li>&lt;a href="#установка-загрузчика">&lt;span class="section-num">5&lt;/span> Установка загрузчика&lt;/a>&lt;/li>
&lt;li>&lt;a href="#создадим-файл-монтирования-fstab">&lt;span class="section-num">6&lt;/span> Создадим файл монтирования fstab&lt;/a>&lt;/li>
&lt;li>&lt;a href="#отключение-cow">&lt;span class="section-num">7&lt;/span> Отключение CoW&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#копирование-специальных-файловых-систем">&lt;span class="section-num">7.1&lt;/span> Копирование специальных файловых систем&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#файл-подкачки-на-файловой-системе-btrfs">&lt;span class="section-num">8&lt;/span> Файл подкачки на файловой системе btrfs&lt;/a>&lt;/li>
&lt;/ul>
&lt;/nav>
&lt;/details>
&lt;h2 id="исходное-состояние-системы">&lt;span class="section-num">1&lt;/span> Исходное состояние системы&lt;/h2>
&lt;ul>
&lt;li>Исходно система установлена на LVM:
&lt;ul>
&lt;li>&lt;code>/dev/sdb1&lt;/code>: &lt;code>/boot/EFI&lt;/code>;&lt;/li>
&lt;li>&lt;code>/dev/sdb2&lt;/code>: &lt;code>/boot&lt;/code>;&lt;/li>
&lt;li>&lt;code>/dev/vgs/root&lt;/code>: &lt;code>/&lt;/code>;&lt;/li>
&lt;li>&lt;code>/dev/vgs/var&lt;/code>: &lt;code>/var&lt;/code>;&lt;/li>
&lt;li>&lt;code>/dev/vgs/var_tmp&lt;/code>: &lt;code>/var/tmp&lt;/code>;&lt;/li>
&lt;li>&lt;code>/dev/vgs/vm&lt;/code>: &lt;code>/var/vm&lt;/code>;&lt;/li>
&lt;li>&lt;code>/dev/vgs/portage&lt;/code>: &lt;code>/usr/portage&lt;/code>;&lt;/li>
&lt;li>&lt;code>/dev/vgs/portage_local&lt;/code>: &lt;code>/usr/local/share/portage&lt;/code>;&lt;/li>
&lt;li>&lt;code>/dev/vgs/portage_com&lt;/code>: &lt;code>/com/lib/portage&lt;/code>;&lt;/li>
&lt;li>&lt;code>/dev/vgs/home&lt;/code>: &lt;code>/home&lt;/code>.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="разбиение-диска">&lt;span class="section-num">2&lt;/span> Разбиение диска&lt;/h2>
&lt;ul>
&lt;li>Установим тип разбиения в GPT.&lt;/li>
&lt;li>Разобьём на партиции:
&lt;ul>
&lt;li>p1 &amp;mdash; 500M, для &lt;code>EFI&lt;/code>.&lt;/li>
&lt;li>p2 &amp;mdash; 500&amp;ndash;1024M, для &lt;code>/boot&lt;/code>.&lt;/li>
&lt;li>p3 &amp;mdash; двойная оперативная память, для &lt;code>swap&lt;/code>.
&lt;ul>
&lt;li>Также можно разместить файл подкачки на &lt;code>btrfs&lt;/code> (см. &lt;a href="https://yamadharma.github.io/ru/post/2022/05/20/btrfs-swap-file/">Файл подкачки на btrfs&lt;/a>).&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>p4 &amp;mdash; всё остальное для &lt;code>btrfs&lt;/code>.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Создадим файловые системы:
&lt;ul>
&lt;li>p1 (&lt;code>EFI&lt;/code>):
&lt;pre>&lt;code class="language-shell">mkfs.vfat -F32 -n EFI /dev/sda1
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>p2 (&lt;code>/boot&lt;/code>):
&lt;pre>&lt;code class="language-shell">mkfs.ext4 -L boot /dev/sda2
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>p3 (&lt;code>swap&lt;/code> в случае отдельной партиции):
&lt;pre>&lt;code class="language-shell">mkswap -L swap /dev/sda3
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>p4 (&lt;code>btrfs&lt;/code>)
&lt;pre>&lt;code class="language-shell">mkfs.btrfs /dev/sda4
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="подготовка-раздела-с-btrfs">&lt;span class="section-num">3&lt;/span> Подготовка раздела с btrfs&lt;/h2>
&lt;ul>
&lt;li>Подмонтируем раздел с btrfs:
&lt;pre>&lt;code class="language-shell">mkdir /mnt/gentoo
mount -tbtrfs -orelatime,discard,autodefrag,compress=zstd:9 /dev/sda4 /mnt/gentoo/
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Создадим подтома на btrfs (см. &lt;a href="https://yamadharma.github.io/ru/post/2021/08/27/btrfs-subvolumes/">Подтома btrfs&lt;/a>):
&lt;pre>&lt;code class="language-shell">cd /mnt/gentoo/
btrfs subvol create @
btrfs subvol create @var
btrfs subvol create @var_tmp
btrfs subvol create @var_log
btrfs subvol create @vm
btrfs subvol create @home
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>И подтома специально для &lt;em>Gentoo Linux&lt;/em>:
&lt;pre>&lt;code class="language-shell">cd /mnt/gentoo/
btrfs subvol create @portage
btrfs subvol create @portage_local
btrfs subvol create @portage_com
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Если используется файл подкачки на файловой системе, то создадим для него подтом:
&lt;pre>&lt;code class="language-shell">cd /mnt/gentoo/
btrfs subvol create @swap
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;h2 id="копирование-существующих-файловых-систем">&lt;span class="section-num">4&lt;/span> Копирование существующих файловых систем&lt;/h2>
&lt;ul>
&lt;li>Создадим точку монтирования:
&lt;pre>&lt;code class="language-shell">mkdir /mnt/from
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Подмонтируем и скопируем root-партицию:
&lt;pre>&lt;code class="language-shell">mount /dev/vgs/root /mnt/from/
rsync -av -HS --delete /mnt/from/ /mnt/gentoo/@
umount /mnt/from/
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Подмонтируем и скопируем &lt;code>/var&lt;/code>:
&lt;pre>&lt;code class="language-shell">mount /dev/vgs/var /mnt/from/
rsync -av -HS --delete /mnt/from/ /mnt/gentoo/@var
umount /mnt/from/
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Подмонтируем и скопируем &lt;code>portage&lt;/code>:
&lt;pre>&lt;code class="language-shell">mount /dev/vgs/portage /mnt/from/
rsync -av -HS --delete /mnt/from/ /mnt/gentoo/@portage
umount /mnt/from/
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Подмонтируем и скопируем &lt;code>portage_local&lt;/code>:
&lt;pre>&lt;code class="language-shell">mount /dev/vgs/portage_local /mnt/from/
rsync -av -HS --delete /mnt/from/ /mnt/gentoo/@portage_local
umount /mnt/from/
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Подмонтируем и скопируем &lt;code>/boot&lt;/code>:
&lt;pre>&lt;code class="language-shell">mkdir /mnt/to/
mount /dev/sda2 /mnt/to
mount /dev/sdb2 /mnt/from/
rsync -av -HS --delete /mnt/from/ /mnt/to/
umount /mnt/to
umount /mnt/from
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;h2 id="установка-загрузчика">&lt;span class="section-num">5&lt;/span> Установка загрузчика&lt;/h2>
&lt;ul>
&lt;li>Перемонтируем файловую систему &lt;code>btrfs&lt;/code>:
&lt;pre>&lt;code class="language-shell">umount /mnt/gentoo
mount -tbtrfs -orelatime,discard,autodefrag,compress=zstd:9,subvol=@ /dev/sda4 /mnt/gentoo/
mount -tbtrfs -orelatime,discard,autodefrag,compress=zstd:9,subvol=@var /dev/sda4 /mnt/gentoo/var
mount -tbtrfs -orelatime,discard,autodefrag,compress=zstd:9,subvol=@var_tmp /dev/sda4 /mnt/gentoo/var/tmp
mount /dev/sda2 /mnt/gentoo/boot/
mount /dev/sda1 /mnt/gentoo/boot/efi
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Подмонтируем псевдо-файловые системы:
&lt;pre>&lt;code class="language-shell">mount -o bind /dev /mnt/gentoo/dev/
mount -o bind /proc /mnt/gentoo/proc/
mount -o bind /sys /mnt/gentoo/sys/
mount -o bind /run /mnt/gentoo/run/
mount -t efivarfs efivarfs /mnt/gentoo/sys/firmware/efi/efivars
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Установим загрузчик:
&lt;pre>&lt;code class="language-shell">cd /mnt/gentoo/
chroot /mnt/gentoo/ /bin/bash
grub-install /boot/
grub-mkconfig -o /boot/grub/grub.cfg
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;h2 id="создадим-файл-монтирования-fstab">&lt;span class="section-num">6&lt;/span> Создадим файл монтирования fstab&lt;/h2>
&lt;ul>
&lt;li>Узнаем идентификатор партиции с файловой системой btrfs:
&lt;pre>&lt;code class="language-shell">blkid /dev/sda4
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Получим строчку:
&lt;pre>&lt;code class="language-shell">UUID=&amp;quot;&amp;lt;uuid_number&amp;gt;&amp;quot;
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Создадим файл &lt;code>/mnt/gentoo/etc/fstab&lt;/code>:
&lt;pre>&lt;code class="language-conf-unix">LABEL=&amp;quot;boot&amp;quot; /boot ext4 relatime,discard 1 1
LABEL=&amp;quot;EFI&amp;quot; /boot/efi vfat defaults,discard,flush,tz=UTC 0 0
LABEL=&amp;quot;swap&amp;quot; none swap sw 0 0
UUID=&amp;quot;&amp;lt;uuid_number&amp;gt;&amp;quot; / btrfs relatime,discard,autodefrag,compress=zstd:9,subvol=@ 0 0
UUID=&amp;quot;&amp;lt;uuid_number&amp;gt;&amp;quot; /var btrfs relatime,discard,autodefrag,compress=zstd:9,subvol=@var 0 0
UUID=&amp;quot;&amp;lt;uuid_number&amp;gt;&amp;quot; /var/tmp btrfs relatime,discard,autodefrag,compress=zstd:9,subvol=@var_tmp 0 0
UUID=&amp;quot;&amp;lt;uuid_number&amp;gt;&amp;quot; /var/vm btrfs relatime,discard,autodefrag,compress=zstd:9,subvol=@vm 0 0
UUID=&amp;quot;&amp;lt;uuid_number&amp;gt;&amp;quot; /home btrfs relatime,discard,autodefrag,compress=zstd:9,subvol=@home 0 0
UUID=&amp;quot;&amp;lt;uuid_number&amp;gt;&amp;quot; /usr/portage btrfs relatime,discard,autodefrag,compress=zstd:9,subvol=@portage 0 0
UUID=&amp;quot;&amp;lt;uuid_number&amp;gt;&amp;quot; /usr/local/share/portage btrfs relatime,discard,autodefrag,compress=zstd:9,subvol=@portage_local 0 0
UUID=&amp;quot;&amp;lt;uuid_number&amp;gt;&amp;quot; /com/lib/portage btrfs relatime,discard,autodefrag,compress=zstd:9,subvol=@portage_com 0 0
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Если используется файл подкачки, то вместо отдельной партиции следует подключить этот файл в &lt;code>/mnt/gentoo/etc/fstab&lt;/code>:
&lt;pre>&lt;code class="language-conf-unix">UUID=&amp;quot;&amp;lt;uuid_number&amp;gt;&amp;quot; /swap btrfs relatime,discard,autodefrag,compress=zstd:9,subvol=@swap 0 0
/swap/swapfile none swap sw 0 0
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;h2 id="отключение-cow">&lt;span class="section-num">7&lt;/span> Отключение CoW&lt;/h2>
&lt;ul>
&lt;li>Для файловых систем с образами виртуальных машин следует отключить CoW (copy-on-write).&lt;/li>
&lt;li>Так же стоит отключить &lt;em>CoW&lt;/em> для часто изменяемых файлов (например, журналов).&lt;/li>
&lt;li>Подмонтируем файловую систему &lt;code>btrfs&lt;/code>:
&lt;pre>&lt;code class="language-shell">mount -tbtrfs -orelatime,discard,autodefrag,compress=zstd:9,subvol=@vm /dev/sda4 /mnt/gentoo/var/vm
mount -tbtrfs -orelatime,discard,autodefrag,compress=zstd:9,subvol=@libvirt /dev/sda4 /mnt/gentoo/var/lib/libvirt/images
mount -tbtrfs -orelatime,discard,autodefrag,compress=zstd:9,subvol=@var_log /dev/sda4 /mnt/gentoo/var/log
mount -tbtrfs -orelatime,discard,autodefrag,compress=zstd:9,subvol=@var_tmp /dev/sda4 /mnt/gentoo/var/tmp
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Отключим для этого подтома CoW:
&lt;ul>
&lt;li>Для &lt;code>/var/vm&lt;/code>
&lt;pre>&lt;code class="language-shell">cd /mnt/gentoo/var/
chattr +C vm
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Для &lt;code>/var/lib/libvirt/images&lt;/code>
&lt;pre>&lt;code class="language-shell">cd /mnt/gentoo/var/lib/libvirt/
chattr +C images
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Для &lt;code>/var/log&lt;/code>
&lt;pre>&lt;code class="language-shell">cd /mnt/gentoo/var/
chattr +C log
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Для &lt;code>/var/tmp&lt;/code>
&lt;pre>&lt;code class="language-shell">cd /mnt/gentoo/var/
chattr +C tmp
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Посмотреть результат можно командой:
&lt;pre>&lt;code class="language-shell">lsattr -a /mnt/gentoo/var/
lsattr -a /mnt/gentoo/var/lib/libvirt/
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;h3 id="копирование-специальных-файловых-систем">&lt;span class="section-num">7.1&lt;/span> Копирование специальных файловых систем&lt;/h3>
&lt;ul>
&lt;li>Файловые системы с отключённым CoW (copy-on-write) копируются после монтирования каталога.&lt;/li>
&lt;li>Скопируем файлы:
&lt;pre>&lt;code class="language-shell">mount /dev/vgs/vm /mnt/from/
rsync -av -HS --delete /mnt/from/ /mnt/gentoo/var/vm
umount /mnt/from/
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;h2 id="файл-подкачки-на-файловой-системе-btrfs">&lt;span class="section-num">8&lt;/span> Файл подкачки на файловой системе btrfs&lt;/h2>
&lt;ul>
&lt;li>Для раздела файла подкачки следует отключить CoW (copy-on-write).&lt;/li>
&lt;li>Подмонтируем файловую систему &lt;code>btrfs&lt;/code>:
&lt;pre>&lt;code class="language-shell">mount -tbtrfs -orelatime,discard,autodefrag,compress=zstd:9,subvol=@ /dev/sda4 /mnt/gentoo/
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Создадим точку монтирования:
&lt;pre>&lt;code class="language-shell">mkdir /mnt/gentoo/swap
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Подмонтируем подтом &lt;code>@swap&lt;/code>:
&lt;pre>&lt;code class="language-shell">mount -o subvol=@swap /dev/sda4 /mnt/gentoo/swap
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Отключим для этого подтома CoW:
&lt;pre>&lt;code class="language-shell">chattr +C /mnt/gentoo/swap
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Создадим файл подкачки:
&lt;pre>&lt;code class="language-shell">truncate -s 0 /mnt/gentoo/swap/swapfile
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Установим права доступа &lt;code>600&lt;/code> к файлу подкачки:
&lt;pre>&lt;code class="language-shell">chmod 600 /mnt/gentoo/swap/swapfile
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Установим размер файла подкачки исходя из размера оперативной памяти:
&lt;pre>&lt;code class="language-shell">fallocate -l $(free -h --si | awk 'NR == 2 {print $2}') /mnt/gentoo/swap/swapfile
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Отформатируем файл подкачки:
&lt;pre>&lt;code class="language-shell">mkswap /mnt/gentoo/swap/swapfile
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Активируем файл подкачки:
&lt;pre>&lt;code class="language-shell">swapon /mnt/gentoo/swap/swapfile
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul></description></item><item><title>Window manager i3</title><link>https://yamadharma.github.io/ru/post/2021/05/14/window-manager-i3/</link><pubDate>Fri, 14 May 2021 11:32:00 +0300</pubDate><guid>https://yamadharma.github.io/ru/post/2021/05/14/window-manager-i3/</guid><description>&lt;p>Менеджер окон &lt;em>i3&lt;/em>.&lt;/p>
&lt;details class="toc-inpage d-print-none " open>
&lt;summary class="font-weight-bold">Содержание&lt;/summary>
&lt;nav id="TableOfContents">
&lt;ul>
&lt;li>&lt;a href="#общая-информация">&lt;span class="section-num">1&lt;/span> Общая информация&lt;/a>&lt;/li>
&lt;li>&lt;a href="#репозиторий-конфигурации">&lt;span class="section-num">2&lt;/span> Репозиторий конфигурации&lt;/a>&lt;/li>
&lt;li>&lt;a href="#файл-конфигурации">&lt;span class="section-num">3&lt;/span> Файл конфигурации&lt;/a>&lt;/li>
&lt;li>&lt;a href="#навигация">&lt;span class="section-num">4&lt;/span> Навигация&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#клавиша-модификатор">&lt;span class="section-num">4.1&lt;/span> Клавиша-модификатор&lt;/a>&lt;/li>
&lt;li>&lt;a href="#основные-комбинации-клавиш">&lt;span class="section-num">4.2&lt;/span> Основные комбинации клавиш&lt;/a>&lt;/li>
&lt;li>&lt;a href="#перемещение-фокуса">&lt;span class="section-num">4.3&lt;/span> Перемещение фокуса&lt;/a>&lt;/li>
&lt;li>&lt;a href="#перемещение-окон">&lt;span class="section-num">4.4&lt;/span> Перемещение окон&lt;/a>&lt;/li>
&lt;li>&lt;a href="#modifying-windows">&lt;span class="section-num">4.5&lt;/span> Modifying windows&lt;/a>&lt;/li>
&lt;li>&lt;a href="#структура-расположения-контейнеров">&lt;span class="section-num">4.6&lt;/span> Структура расположения контейнеров&lt;/a>&lt;/li>
&lt;li>&lt;a href="#floating">&lt;span class="section-num">4.7&lt;/span> Floating&lt;/a>&lt;/li>
&lt;li>&lt;a href="#рабочие-области--workspaces">&lt;span class="section-num">4.8&lt;/span> Рабочие области (workspaces)&lt;/a>&lt;/li>
&lt;li>&lt;a href="#opening-applications-closing-windows">&lt;span class="section-num">4.9&lt;/span> Opening applications / Closing windows&lt;/a>&lt;/li>
&lt;li>&lt;a href="#выход-перезапуск">&lt;span class="section-num">4.10&lt;/span> Выход/Перезапуск&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#настройка">&lt;span class="section-num">5&lt;/span> Настройка&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#терминал">&lt;span class="section-num">5.1&lt;/span> Терминал&lt;/a>&lt;/li>
&lt;li>&lt;a href="#управление-окном-с-помощью-мышки">&lt;span class="section-num">5.2&lt;/span> Управление окном с помощью мышки&lt;/a>&lt;/li>
&lt;li>&lt;a href="#строка-статуса">&lt;span class="section-num">5.3&lt;/span> Строка статуса&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#i3bar">&lt;span class="section-num">5.3.1&lt;/span> i3bar&lt;/a>&lt;/li>
&lt;li>&lt;a href="#py3status">&lt;span class="section-num">5.3.2&lt;/span> py3status&lt;/a>&lt;/li>
&lt;li>&lt;a href="#polybar">&lt;span class="section-num">5.3.3&lt;/span> polybar&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#запуск-приложений">&lt;span class="section-num">5.4&lt;/span> Запуск приложений&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#rofi">&lt;span class="section-num">5.4.1&lt;/span> rofi&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#блокировка-экрана">&lt;span class="section-num">5.5&lt;/span> Блокировка экрана&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#блокировщик-экрана-i3lock">&lt;span class="section-num">5.5.1&lt;/span> Блокировщик экрана &lt;code>i3lock&lt;/code>&lt;/a>&lt;/li>
&lt;li>&lt;a href="#блокировщик-экрана-i3lock-color">&lt;span class="section-num">5.5.2&lt;/span> Блокировщик экрана &lt;code>i3lock-color&lt;/code>&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#приложения">&lt;span class="section-num">6&lt;/span> Приложения&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#снимки-экрана">&lt;span class="section-num">6.1&lt;/span> Снимки экрана&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#совместимость-приложений">&lt;span class="section-num">7&lt;/span> Совместимость приложений&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#java">&lt;span class="section-num">7.1&lt;/span> Java&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#серое-окно-приложения-не-меняют-размер-с-помощью-wm-меню-сразу-закрываются">&lt;span class="section-num">7.1.1&lt;/span> Серое окно, приложения не меняют размер с помощью WM, меню сразу закрываются&lt;/a>&lt;/li>
&lt;li>&lt;a href="#меню-в-приложениях-плавает-отдельно-им-невозможно-пользоваться">&lt;span class="section-num">7.1.2&lt;/span> Меню в приложениях плавает отдельно, им невозможно пользоваться&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/nav>
&lt;/details>
&lt;h2 id="общая-информация">&lt;span class="section-num">1&lt;/span> Общая информация&lt;/h2>
&lt;ul>
&lt;li>Тайловый менеджер окон.&lt;/li>
&lt;li>&lt;a href="https://i3wm.org/" target="_blank" rel="noopener">https://i3wm.org/&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="репозиторий-конфигурации">&lt;span class="section-num">2&lt;/span> Репозиторий конфигурации&lt;/h2>
&lt;ul>
&lt;li>Я сделал репозиторий со своей конфигурацией: &lt;a href="https://github.com/yamadharma/config-i3" target="_blank" rel="noopener">https://github.com/yamadharma/config-i3&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="файл-конфигурации">&lt;span class="section-num">3&lt;/span> Файл конфигурации&lt;/h2>
&lt;ul>
&lt;li>Файлы конфигурации просматриваются в следующем порядке:
&lt;ul>
&lt;li>&lt;code>$XDG_CONFIG_HOME/i3/config&lt;/code> (&lt;code>~/.config/i3/config&lt;/code>);&lt;/li>
&lt;li>&lt;code>~/.i3/config&lt;/code>;&lt;/li>
&lt;li>&lt;code>$XDG_CONFIG_DIRS/i3/config&lt;/code> (&lt;code>/etc/xdg/i3/config&lt;/code>);&lt;/li>
&lt;li>&lt;code>/etc/i3/config&lt;/code>.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Начиная с версии 4.20, можно подключать другие файлы конфигурации из основного файла конфигурации &lt;em>i3&lt;/em>.
&lt;ul>
&lt;li>Примеры использования директивы &lt;code>include&lt;/code>:
&lt;pre>&lt;code class="language-cfg"># Тильда преобразуется в домашний каталог пользователя
include ~/.config/i3/assignments.conf
# Переменные среды разыменовываются
include $HOME/.config/i3/assignments.conf
# Символы подстановки раскрываются
include ~/.config/i3/config.d/*.conf
# Можно выполнять команду
include ~/.config/i3/`hostname`.conf
# Каждый путь загружается только один раз
include ~/.config/i3/config
# Относительные пути интерпретируются относительно каталога конфигурационного файла
include assignments.conf
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="навигация">&lt;span class="section-num">4&lt;/span> Навигация&lt;/h2>
&lt;h3 id="клавиша-модификатор">&lt;span class="section-num">4.1&lt;/span> Клавиша-модификатор&lt;/h3>
&lt;ul>
&lt;li>В качестве модификатора обычно используется:
&lt;ul>
&lt;li>&lt;code>Alt&lt;/code>:
&lt;pre>&lt;code class="language-conf-unix">set $mod Mod1
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>&lt;code>Super&lt;/code> (Клавиша со значком &lt;em>Windows&lt;/em>):
&lt;pre>&lt;code class="language-conf-unix">set $mod Mod4
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Предпочитаю &lt;code>Super&lt;/code>, чтобы не конфликтовать с Emacs.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="основные-комбинации-клавиш">&lt;span class="section-num">4.2&lt;/span> Основные комбинации клавиш&lt;/h3>
&lt;ul>
&lt;li>&lt;code>Mod&lt;/code> + &lt;code>Enter&lt;/code>: открыть терминал.&lt;/li>
&lt;/ul>
&lt;h3 id="перемещение-фокуса">&lt;span class="section-num">4.3&lt;/span> Перемещение фокуса&lt;/h3>
&lt;ul>
&lt;li>Фокус можно перемещать как с помощью стрелок, так и с помощью буквенных клавиш, как в редакторе &lt;em>vi&lt;/em>.
&lt;ul>
&lt;li>&lt;code>Mod&lt;/code> + &lt;code>h&lt;/code> или &lt;code>Mod&lt;/code> + &lt;code>Left&lt;/code>: сдвиг фокуса влево.&lt;/li>
&lt;li>&lt;code>Mod&lt;/code> + &lt;code>j&lt;/code> или &lt;code>Mod&lt;/code> + &lt;code>Down&lt;/code>: сдвиг фокуса вниз.&lt;/li>
&lt;li>&lt;code>Mod&lt;/code> + &lt;code>k&lt;/code> или &lt;code>Mod&lt;/code> + &lt;code>Up&lt;/code>: сдвиг фокуса вверх.&lt;/li>
&lt;li>&lt;code>Mod&lt;/code> + &lt;code>l&lt;/code> или &lt;code>Mod&lt;/code> + &lt;code>Right&lt;/code>: сдвиг фокуса вправо.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Конфигурация выглядит следующим образом:
&lt;pre>&lt;code class="language-conf-unix">## Home row direction keys, like vim
set $left h
set $down j
set $up k
set $right l
## Move your focus around
bindsym $mod+$left focus left
bindsym $mod+$down focus down
bindsym $mod+$up focus up
bindsym $mod+$right focus right
## Or use $mod+[up|down|left|right]
bindsym $mod+Left focus left
bindsym $mod+Down focus down
bindsym $mod+Up focus up
bindsym $mod+Right focus right
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Впрочем, следует заметить, что также могут использоваться и другие соглашения:
&lt;ul>
&lt;li>&lt;code>j&lt;/code>: влево;&lt;/li>
&lt;li>&lt;code>k&lt;/code>: вниз;&lt;/li>
&lt;li>&lt;code>l&lt;/code>: вверх;&lt;/li>
&lt;li>&lt;code>;&lt;/code>: вправо.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Поскольку в данном менеджере окон поддерживаются контейнеры, то можно переключить фокус на родительский контейнер:
&lt;ul>
&lt;li>&lt;code>Mod&lt;/code> + &lt;code>a&lt;/code>: переключить фокус на родительский контейнер.&lt;/li>
&lt;li>Конфигурация:
&lt;pre>&lt;code class="language-conf-unix">## Move focus to the parent container
bindsym $mod+a focus parent
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;code>Mod&lt;/code> + &lt;code>Space&lt;/code>: переключить режим фокуса.&lt;/li>
&lt;/ul>
&lt;h3 id="перемещение-окон">&lt;span class="section-num">4.4&lt;/span> Перемещение окон&lt;/h3>
&lt;ul>
&lt;li>Делается аналогично перемещению фокуса, но с добавлением модификатора &lt;code>Shift&lt;/code>:
&lt;ul>
&lt;li>&lt;code>Mod&lt;/code> + &lt;code>Shift&lt;/code> + &lt;code>h&lt;/code> или &lt;code>Mod&lt;/code> + &lt;code>Shift&lt;/code> + &lt;code>Left&lt;/code>: перемещение влево;&lt;/li>
&lt;li>&lt;code>Mod&lt;/code> + &lt;code>Shift&lt;/code> + &lt;code>j&lt;/code> или &lt;code>Mod&lt;/code> + &lt;code>Shift&lt;/code> + &lt;code>Down&lt;/code>: перемещение вниз;&lt;/li>
&lt;li>&lt;code>Mod&lt;/code> + &lt;code>Shift&lt;/code> + &lt;code>k&lt;/code> или &lt;code>Mod&lt;/code> + &lt;code>Shift&lt;/code> + &lt;code>Up&lt;/code>: перемещение вверх;&lt;/li>
&lt;li>&lt;code>Mod&lt;/code> + &lt;code>Shift&lt;/code> + &lt;code>l&lt;/code> или &lt;code>Mod&lt;/code> + &lt;code>Shift&lt;/code> + &lt;code>Right&lt;/code>: перемещение вправо.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Конфигурация выглядит следующим образом:
&lt;pre>&lt;code class="language-conf-unix">## Move the focused window with the same, but add Shift
bindsym $mod+Shift+$left move left
bindsym $mod+Shift+$down move down
bindsym $mod+Shift+$up move up
bindsym $mod+Shift+$right move right
## Ditto, with arrow keys
bindsym $mod+Shift+Left move left
bindsym $mod+Shift+Down move down
bindsym $mod+Shift+Up move up
bindsym $mod+Shift+Right move right
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;h3 id="modifying-windows">&lt;span class="section-num">4.5&lt;/span> Modifying windows&lt;/h3>
&lt;ul>
&lt;li>&lt;code>Mod&lt;/code> + f toggle fullscreen&lt;/li>
&lt;li>&lt;code>Mod&lt;/code> + v split a window vertically&lt;/li>
&lt;li>&lt;code>Mod&lt;/code> + h split a window horizontally&lt;/li>
&lt;li>&lt;code>Mod&lt;/code> + r resize mode&lt;/li>
&lt;/ul>
&lt;h3 id="структура-расположения-контейнеров">&lt;span class="section-num">4.6&lt;/span> Структура расположения контейнеров&lt;/h3>
&lt;ul>
&lt;li>Поддерживаются следующие расположения контейнеров:
&lt;ul>
&lt;li>&lt;code>Mod&lt;/code> + &lt;code>e&lt;/code>: переключение разделённого расположения (split layout);&lt;/li>
&lt;li>&lt;code>Mod&lt;/code> + &lt;code>s&lt;/code>: стековое размещение (stacking layout);&lt;/li>
&lt;li>&lt;code>Mod&lt;/code> + &lt;code>w&lt;/code>: размещение с табами (tabbed layout).&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Конфигурация:
&lt;pre>&lt;code class="language-conf-unix">## Switch the current container between different layout styles
bindsym $mod+s layout stacking
bindsym $mod+w layout tabbed
bindsym $mod+e layout toggle split
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Для раскладки по умолчанию я использую табы:
&lt;pre>&lt;code class="language-conf-unix">### Layout mode for new containers
## default|stacking|tabbed
workspace_layout tabbed
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;h3 id="floating">&lt;span class="section-num">4.7&lt;/span> Floating&lt;/h3>
&lt;ul>
&lt;li>&lt;code>Mod&lt;/code> + Shift + Space toggle floating&lt;/li>
&lt;li>&lt;code>Mod&lt;/code> + Left click drag floating&lt;/li>
&lt;/ul>
&lt;h3 id="рабочие-области--workspaces">&lt;span class="section-num">4.8&lt;/span> Рабочие области (workspaces)&lt;/h3>
&lt;ul>
&lt;li>Сконфигурим рабочие области:
&lt;pre>&lt;code class="language-conf-unix">## Define names for workspaces
set $ws1 1
set $ws2 2
set $ws3 3
set $ws4 4
set $ws5 5
set $ws6 6
set $ws7 7
set $ws8 8
set $ws9 9
set $ws10 10
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>&lt;code>Mod&lt;/code> + &lt;code>0&lt;/code> &amp;ndash; &lt;code>9&lt;/code>: переключиться на соответствующую рабочую область:
&lt;pre>&lt;code class="language-conf-unix">## Switch to workspace
bindsym $mod+1 workspace $ws1
bindsym $mod+2 workspace $ws2
bindsym $mod+3 workspace $ws3
bindsym $mod+4 workspace $ws4
bindsym $mod+5 workspace $ws5
bindsym $mod+6 workspace $ws6
bindsym $mod+7 workspace $ws7
bindsym $mod+8 workspace $ws8
bindsym $mod+9 workspace $ws9
bindsym $mod+0 workspace $ws10
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>&lt;code>Mod&lt;/code> + &lt;code>Shift&lt;/code> + &lt;code>0&lt;/code> &amp;ndash; &lt;code>9&lt;/code>: перенести окно на соответствующую рабочую область:
&lt;pre>&lt;code class="language-conf-unix">## Move focused container to workspace
bindsym $mod+Shift+1 move container to workspace $ws1
bindsym $mod+Shift+2 move container to workspace $ws2
bindsym $mod+Shift+3 move container to workspace $ws3
bindsym $mod+Shift+4 move container to workspace $ws4
bindsym $mod+Shift+5 move container to workspace $ws5
bindsym $mod+Shift+6 move container to workspace $ws6
bindsym $mod+Shift+7 move container to workspace $ws7
bindsym $mod+Shift+8 move container to workspace $ws8
bindsym $mod+Shift+9 move container to workspace $ws9
bindsym $mod+Shift+0 move container to workspace $ws10
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;h3 id="opening-applications-closing-windows">&lt;span class="section-num">4.9&lt;/span> Opening applications / Closing windows&lt;/h3>
&lt;ul>
&lt;li>&lt;code>Mod&lt;/code> + d open application launcher (dmenu)&lt;/li>
&lt;li>&lt;code>Mod&lt;/code> + Shift + q kill a window&lt;/li>
&lt;/ul>
&lt;h3 id="выход-перезапуск">&lt;span class="section-num">4.10&lt;/span> Выход/Перезапуск&lt;/h3>
&lt;ul>
&lt;li>&lt;code>Mod&lt;/code> + &lt;code>Shift&lt;/code> + &lt;code>c&lt;/code>: перечитать конфигурационный файл.
&lt;pre>&lt;code class="language-conf-unix">## ~/.config/i3/config
## reload the configuration file
bindsym $mod+Shift+c reload
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>&lt;code>Mod&lt;/code> + &lt;code>Shift&lt;/code> + &lt;code>r&lt;/code>: перестартовать &lt;em>i3&lt;/em>, сохранив сессию.
&lt;pre>&lt;code class="language-conf-unix">## ~/.config/i3/config
## restart i3 inplace (preserves your layout/session, can be used to upgrade i3)
bindsym $mod+Shift+r restart
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>&lt;code>Mod&lt;/code> + &lt;code>Shift&lt;/code> + &lt;code>e&lt;/code>: выход из &lt;em>i3&lt;/em>.
&lt;pre>&lt;code class="language-conf-unix">## ~/.config/i3/config
## exit i3 (logs you out of your X session)
bindsym $mod+Shift+e exec &amp;quot;i3-nagbar -t warning -m 'You pressed the exit shortcut. Do you really want to exit i3? This will end your X session.' -B 'Yes, exit i3' 'i3-msg exit'&amp;quot;
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;h2 id="настройка">&lt;span class="section-num">5&lt;/span> Настройка&lt;/h2>
&lt;h3 id="терминал">&lt;span class="section-num">5.1&lt;/span> Терминал&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>В качестве терминала я использую kitty.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Конфигурация запуска терминала:&lt;/p>
&lt;pre>&lt;code class="language-conf-unix">set $term kitty
bindsym $mod+Return exec $term
&lt;/code>&lt;/pre>
&lt;ul>
&lt;li>В этом случае запускается одно окно терминала.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Для работы я использую специальную настройку сессии терминала. Я её запускаю при входе в сессию. Для этого я приспособил комбинацию &lt;code>Mod&lt;/code> + &lt;code>Shift&lt;/code> + &lt;code>Enter&lt;/code>:&lt;/p>
&lt;pre>&lt;code class="language-conf-unix">bindsym $mod+Shift+Return exec kitty --session ~/.config/kitty/startup
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;h3 id="управление-окном-с-помощью-мышки">&lt;span class="section-num">5.2&lt;/span> Управление окном с помощью мышки&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>Можно управлять окнами с помощью мышки.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Привязка осуществляется следующей командой:&lt;/p>
&lt;pre>&lt;code class="language-conf-unix">bindsym [--release] [--border] [--whole-window] [--exclude-titlebar] [&amp;lt;Modifiers&amp;gt;+]button&amp;lt;n&amp;gt; command
&lt;/code>&lt;/pre>
&lt;ul>
&lt;li>По умолчанию привязка запускается только при нажатии на строку заголовка окна.&lt;/li>
&lt;li>Если указан флаг &lt;code>--release&lt;/code>, он запустится, когда кнопка мыши будет отпущена.&lt;/li>
&lt;li>Если указан флаг &lt;code>--whole-window&lt;/code>, то привязка также будет выполняться при щелчке по любой части окна, за исключением границы.&lt;/li>
&lt;li>Чтобы привязка выполнялась при щелчке границы, нужно указать флаг &lt;code>--border&lt;/code>.&lt;/li>
&lt;li>Если задан флаг &lt;code>--exclude-titlebar&lt;/code>, заголовок не будет учитываться для привязки клавиш.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Примеры.&lt;/p>
&lt;ul>
&lt;li>Средняя кнопка на заголовке закрывает окно:
&lt;pre>&lt;code class="language-conf-unix">bindsym --release button2 kill
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Средняя кнопка и модификатор над любой частью окна закрывает окно:
&lt;pre>&lt;code class="language-conf-unix">bindsym --whole-window $mod+button2 kill
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Правая кнопка мыши переключает плавающий режим:
&lt;pre>&lt;code class="language-conf-unix">bindsym button3 floating toggle
bindsym $mod+button3 floating toggle
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Боковые кнопки мыши перемещают окно:
&lt;pre>&lt;code class="language-conf-unix">bindsym button9 move left
bindsym button8 move right
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="строка-статуса">&lt;span class="section-num">5.3&lt;/span> Строка статуса&lt;/h3>
&lt;h4 id="i3bar">&lt;span class="section-num">5.3.1&lt;/span> i3bar&lt;/h4>
&lt;ul>
&lt;li>Отрисовку панели осуществляет утилита &lt;code>i3bar&lt;/code>.&lt;/li>
&lt;li>Отображается вверху или внизу экрана.&lt;/li>
&lt;li>Содержит:
&lt;ul>
&lt;li>область с кнопками переключения рабочих областей &lt;em>i3&lt;/em>;&lt;/li>
&lt;li>системную строку, генерируемую при помощи &lt;code>i3status&lt;/code> или аналогов;&lt;/li>
&lt;li>системный трей с иконками программ.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>В конфигурационном файле задаётся следующим образом (&lt;a href="https://i3wm.org/docs/userguide.html#_configuring_i3bar" target="_blank" rel="noopener">https://i3wm.org/docs/userguide.html#_configuring_i3bar&lt;/a>):
&lt;pre>&lt;code class="language-conf-unix"># ~/.config/i3/config -*- mode: conf-unix; -*-
## Start i3bar to display a workspace bar
bar {
status_command i3status
position top
}
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;!--list-separator-->
&lt;ol>
&lt;li>
&lt;p>Поддержка иконок в i3bar&lt;/p>
&lt;ul>
&lt;li>В &lt;code>i3bar&lt;/code> можно использовать шрифты иконок (см. &lt;a href="https://yamadharma.github.io/ru/post/2021/05/21/monospace-fonts/">Моноширинные шрифты&lt;/a>).&lt;/li>
&lt;li>Наиболее распространённым является шрифт &lt;a href="https://fontawesome.com/" target="_blank" rel="noopener">Font Awesome&lt;/a>.&lt;/li>
&lt;li>Установка:
&lt;ul>
&lt;li>Gentoo
&lt;pre>&lt;code class="language-shell">emerge media-fonts/fontawesome
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Для вставки шрифта в файл можно использовать список кодов для иконок &lt;a href="https://fontawesome.com/cheatsheet" target="_blank" rel="noopener">https://fontawesome.com/cheatsheet&lt;/a>.&lt;/li>
&lt;li>Шрифт лучше явно обозначить в конфигурации:
&lt;pre>&lt;code class="language-conf-unix">## ~/.config/i3/config
bar {
…
font pango:Source Sans Pro, FontAwesome 5 Free 10
…
}
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Для набора символа по его коду следует использовать конфигурации клавиш. Например, для набора символа с кодом &lt;code>0xf004&lt;/code>, требуется набрать:
&lt;ul>
&lt;li>приложения на основе GTK: &lt;code>Ctrl&lt;/code> + &lt;code>Shift&lt;/code> + &lt;code>u&lt;/code>, &lt;code>f004&lt;/code>, &lt;code>Enter&lt;/code>;&lt;/li>
&lt;li>emacs: &lt;code>Ctrl&lt;/code> + &lt;code>x&lt;/code>, &lt;code>8&lt;/code>, &lt;code>Enter&lt;/code>, &lt;code>f004&lt;/code>, &lt;code>Enter&lt;/code>;&lt;/li>
&lt;li>vim: &lt;code>Ctrl&lt;/code> + &lt;code>v&lt;/code>, &lt;code>uf004&lt;/code>;&lt;/li>
&lt;li>urxvt: удерживая &lt;code>Ctrl&lt;/code> + &lt;code>Shift&lt;/code>, наберите &lt;code>f004&lt;/code>.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;!--list-separator-->
&lt;ol start="2">
&lt;li>
&lt;p>i3status&lt;/p>
&lt;ul>
&lt;li>Использовано &lt;a href="https://igancev.ru/2020-05-11-configuring-i3status-in-i3wm" target="_blank" rel="noopener">https://igancev.ru/2020-05-11-configuring-i3status-in-i3wm&lt;/a>.&lt;/li>
&lt;li>&lt;code>i3status&lt;/code> генерирует строку состояния для &lt;code>i3bar&lt;/code>.&lt;/li>
&lt;li>Содержит встроенные модули:
&lt;ul>
&lt;li>IPv6 &amp;mdash; получает и выводит IPv6 адрес.&lt;/li>
&lt;li>Disk &amp;mdash; отображает информацию о занятом и свободном месте в файловой системе.&lt;/li>
&lt;li>Run-watch &amp;mdash; мониторинг определённого процесса в системе.&lt;/li>
&lt;li>Path-exists &amp;mdash; проверяет на существование путь в файловой системе.&lt;/li>
&lt;li>Wireless &amp;mdash; позволяет выводить подключения к WIFI сети, уровень сигнала, имя точки доступа.&lt;/li>
&lt;li>Ethernet &amp;mdash; предоставляет IP адрес и скорость соединения сетевого интерфейса.&lt;/li>
&lt;li>Battery &amp;mdash; показ уровня заряда батареи.&lt;/li>
&lt;li>CPU-Temperature &amp;mdash; показ температуры процессора.&lt;/li>
&lt;li>CPU Usage &amp;mdash; использование процессора в процентах.&lt;/li>
&lt;li>Memory &amp;mdash; использование оперативной памяти.&lt;/li>
&lt;li>Load &amp;mdash; среднее значение загрузки системы за 1, 5 и 15 минут (Load Overage).&lt;/li>
&lt;li>Time &amp;mdash; время в текущей временной зоне.&lt;/li>
&lt;li>TzTime &amp;mdash; время в заданной временной зоне.&lt;/li>
&lt;li>DDate &amp;mdash; дата.&lt;/li>
&lt;li>Volume &amp;mdash; управление громкостью звука.&lt;/li>
&lt;li>File Contents &amp;mdash; вывод содержимого указанного файла.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Модули в строке можно переиспользовать по нескольку раз, управляя порядком вывода.&lt;/li>
&lt;li>Конфигурацию условно можно разделить на 3 части:
&lt;ul>
&lt;li>блок &lt;code>general&lt;/code> &amp;mdash; содержит общие параметры;&lt;/li>
&lt;li>переменная &lt;code>order&lt;/code> &amp;mdash; в неё записывается порядок вывода интересующих модулей;&lt;/li>
&lt;li>блоки конфигурации модулей &amp;mdash; непосредственно настройки самих блоков с метриками.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>В конфигурации i3bar задаётся конфигурационный файл для i3status:
&lt;pre>&lt;code class="language-conf-unix"># ~/.config/i3/config -*- mode: conf-unix; -*-
## Start i3bar to display a workspace bar
bar {
font pango:Source Sans Pro, FontAwesome 5 Free 10
status_command i3status --config ~/.config/i3/i3status/config
position top
}
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Структура информационной панели задаётся в конфигурационном файле:
&lt;pre>&lt;code class="language-conf-unix">### -*- mode: conf-unix; -*-
## ~/.config/i3/i3status/config
general {
colors = true # включение/выключение поддержки цветов true/false
interval = 1 # интервал обновления строки статуса, в секундах
output_format = &amp;quot;i3bar&amp;quot; # формат вывода, устанавливаем i3bar (JSON)
}
# порядок вывода модулей
order += &amp;quot;run_watch openvpn&amp;quot;
order += &amp;quot;run_watch openconnect&amp;quot;
order += &amp;quot;volume master&amp;quot;
order += &amp;quot;wireless _first_&amp;quot;
order += &amp;quot;battery all&amp;quot;
order += &amp;quot;disk /&amp;quot;
order += &amp;quot;memory&amp;quot;
order += &amp;quot;cpu_usage&amp;quot;
order += &amp;quot;cpu_temperature 0&amp;quot;
order += &amp;quot;tztime local&amp;quot;
# отслеживание процесса openvpn
# служит как индикатор работы openvpn клиента
# при запуске openvpn необходимо
# указывать параметр --writepid /var/run/openvpn.pid
run_watch openvpn {
pidfile = &amp;quot;/var/run/openvpn.pid&amp;quot;
format = &amp;quot; openvpn&amp;quot;
# если пареметр format_down оставить пустым,
# то при неактивном процессе блок будет отсутствовать
format_down=&amp;quot;&amp;quot;
}
# аналогичный блок индикатор openconnect vpn клиента
# требуется запуск клиента с параметром --pid-file=/var/run/openconnect.pid
run_watch openconnect {
pidfile = &amp;quot;/var/run/openconnect.pid&amp;quot;
format = &amp;quot; openconnect vpn&amp;quot;
format_down=&amp;quot;&amp;quot;
}
# управление громкостью звука
volume master {
format = &amp;quot; %volume&amp;quot; # шаблон громкости в активном состоянии
format_muted = &amp;quot; %volume&amp;quot; # шаблон громкости в состоянии muted (без звука)
device = &amp;quot;default&amp;quot;
mixer = &amp;quot;Master&amp;quot;
mixer_idx = 0
}
# индикатор WIFI
wireless _first_ {
# шаблон вывода, можно дополнить
# наименованием подключения %essid
# и ip адресом %ip
format_up = &amp;quot;%quality %frequency&amp;quot;
format_down = &amp;quot;&amp;quot;
}
# состояние заряда батареи
battery all {
# шаблон вывода, можно дополнить
# оставшимся временем работы %emptytime
# энергопотреблением %consumption в ваттах
format = &amp;quot;%status %percentage&amp;quot;
# true - показ процента заряда от 0 до 100
# false - показ процента заряда от 0 до n, с учетом
# изношенности аккумулятора
last_full_capacity = true
format_down = &amp;quot;&amp;quot;
status_chr = &amp;quot;&amp;quot; # статус подзарядки
status_bat = &amp;quot;&amp;quot; # статус в режиме работы от батареи
status_unk = &amp;quot;? UNK&amp;quot; # неизвестный статус
status_full = &amp;quot;&amp;quot; # статус полного заряда
path = &amp;quot;/sys/class/power_supply/BAT%d/uevent&amp;quot;
# нижний порог заряда, после которого блок
# будет окрашен в &amp;quot;color_bad&amp;quot; (по умолчанию красный)
# подробнее в man i3status
low_threshold = 10
}
# отслеживаемый накопитель
disk &amp;quot;/&amp;quot; {
# доступные переменные:
# %used, %percentage_used - занятое пространство
# %free, %percentage_free - свободное пространство
# %avail, %percentage_avail - доступное пространство
# %total - всего
format = &amp;quot; %avail&amp;quot;
# будет окрашен в &amp;quot;color_bad&amp;quot; (по умолчанию красный)
# при достижении нижнего порога менее 10GB доступного пространства
low_threshold = &amp;quot;10&amp;quot;
threshold_type = &amp;quot;gbytes_avail&amp;quot;
format_below_threshold = &amp;quot; Warning: %avail&amp;quot;
}
# миниторинг оперативной памяти
memory {
# доступные переменные:
# %total, percentage_total
# %used, percentage_used
# %free, percentage_free
# %available, percentage_available
# %shared, percentage_shared
format = &amp;quot; %used&amp;quot;
# порог, при котором вывод окрасится в
# желтый (degraded) или красный (critical)
# а формат вывода изменится на format_degraded
threshold_degraded = &amp;quot;1G&amp;quot;
threshold_critical = &amp;quot;200M&amp;quot;
format_degraded = &amp;quot;MEMORY &amp;lt; %available&amp;quot;
}
# температура процессора
cpu_temperature 0 {
format = &amp;quot; %degrees&amp;quot;
# верхний порог температуры, при достижении которого
# вывод окрасится красным,
# и формат изменится на format_above_threshold
max_threshold = &amp;quot;80&amp;quot;
format_above_threshold = &amp;quot; %degrees&amp;quot;
path = &amp;quot;/sys/class/thermal/thermal_zone0/temp&amp;quot;
}
# использование центрального процессора
cpu_usage {
# %usage - процентное использование ЦП
# %cpu&amp;lt;N&amp;gt; - начиная с %cpu0 и далее показывает использование ядер
format = &amp;quot; %usage&amp;quot;
# доступны параметры:
# degraded_threshold, окрас в желтый, по умолчанию 90
# max_threshold, окрас в красный, по умолчанию 95
# и кастомные форматы для них
# format_above_degraded_threshold и format_above_threshold
}
# вывод даты и времени по заданному формату
tztime local {
format = &amp;quot; %d %b %Y  %H:%M:%S&amp;quot;
}
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h4 id="py3status">&lt;span class="section-num">5.3.2&lt;/span> py3status&lt;/h4>
&lt;ul>
&lt;li>&lt;code>py3status&lt;/code> &amp;mdash; это расширяемая оболочка для &lt;code>i3status&lt;/code>, написанная на python.&lt;/li>
&lt;li>Сайт: &lt;a href="https://py3status.readthedocs.io/" target="_blank" rel="noopener">https://py3status.readthedocs.io/&lt;/a>.&lt;/li>
&lt;li>Репозиторий: &lt;a href="https://github.com/ultrabug/py3status" target="_blank" rel="noopener">https://github.com/ultrabug/py3status&lt;/a>.&lt;/li>
&lt;li>Можно управлять &lt;code>i3bar&lt;/code>:
&lt;ul>
&lt;li>используя один из доступных модулей, поставляемых с &lt;code>py3status&lt;/code>;&lt;/li>
&lt;li>группировать несколько модулей и автоматически или вручную циклически отображать их отображение;&lt;/li>
&lt;li>писать свои собственные модули и отображать их вывод на панели;&lt;/li>
&lt;li>обрабатывать события кликов на &lt;code>i3bar&lt;/code>.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Отображается вверху или внизу экрана.&lt;/li>
&lt;li>Содержит:
&lt;ul>
&lt;li>область с кнопками переключения рабочих областей &lt;em>i3&lt;/em>;&lt;/li>
&lt;li>системную строку;&lt;/li>
&lt;li>системный трей с иконками программ.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;!--list-separator-->
&lt;ol>
&lt;li>
&lt;p>Запуск py3status&lt;/p>
&lt;ul>
&lt;li>Запускается вместо &lt;code>i3bar&lt;/code>:
&lt;pre>&lt;code class="language-conf-unix"># ~/.config/i3/config -*- mode: conf-unix; -*-
## Start py3status to display a workspace bar
bar {
font pango:Iosevka Nerd Font 12
status_command py3status
position top
}
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Использует конфигурационный файл от &lt;code>i3status&lt;/code> или собственную конфигурацию.&lt;/li>
&lt;li>Порядок поиска конфигурационного файла:
&lt;ul>
&lt;li>&lt;code>$XDG_CONFIG_HOME/py3status/config&lt;/code>;&lt;/li>
&lt;li>&lt;code>$XDG_CONFIG_HOME/i3status/config&lt;/code>;&lt;/li>
&lt;li>&lt;code>$XDG_CONFIG_HOME/i3/i3status.conf&lt;/code>;&lt;/li>
&lt;li>&lt;code>~/.i3status.conf&lt;/code>;&lt;/li>
&lt;li>&lt;code>~/.i3/i3status.conf&lt;/code>;&lt;/li>
&lt;li>&lt;code>$XDG_CONFIG_DIRS/i3status/config&lt;/code>;&lt;/li>
&lt;li>&lt;code>/etc/i3status.conf&lt;/code>.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h4 id="polybar">&lt;span class="section-num">5.3.3&lt;/span> polybar&lt;/h4>
&lt;ul>
&lt;li>
&lt;p>Отдельное приложение для строки статуса.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Применяется для замены &lt;em>i3bar&lt;/em>.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://polybar.github.io/" target="_blank" rel="noopener">https://polybar.github.io/&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://github.com/polybar/polybar" target="_blank" rel="noopener">https://github.com/polybar/polybar&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Темы для &lt;em>polybar&lt;/em>: &lt;a href="https://github.com/adi1090x/polybar-themes" target="_blank" rel="noopener">https://github.com/adi1090x/polybar-themes&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Одним из побудительных мотивов установки &lt;em>polybar&lt;/em> может быть то, что здесь можно без проблем настроить индикатор раскладки клавиатуры.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Установка&lt;/p>
&lt;ul>
&lt;li>Gentoo:
&lt;pre>&lt;code class="language-shell">USE=&amp;quot;i3wm&amp;quot; emerge x11-misc/polybar
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Конфигурационный файл:&lt;/p>
&lt;ul>
&lt;li>стандартное расположение: &lt;code>~/.config/polybar/config&lt;/code> (&lt;code>$XDG_CONFIG_HOME/polybar/config&lt;/code>);&lt;/li>
&lt;li>использую для локальных настроек только для &lt;em>i3&lt;/em>: &lt;code>~/.config/i3/polybar/config&lt;/code>.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;!--list-separator-->
&lt;ol>
&lt;li>
&lt;p>Скрипт запуска&lt;/p>
&lt;ul>
&lt;li>Создадим скрипт запуска &lt;code>polybar&lt;/code>.
&lt;pre>&lt;code class="language-shell">#!/bin/bash
# ~/.config/i3/polybar/launch.sh
# Terminate already running bar instances
killall -q polybar
# If all your bars have ipc enabled, you can also use
# polybar-msg cmd quit
# Wait until the processes have been shut down
while pgrep -u $UID -x polybar &amp;gt;/dev/null; do sleep 1; done
# Launch Polybar, using config location ~/.config/i3/polybar/config
polybar --config=~/.config/i3/polybar/config i3 &amp;amp;
echo &amp;quot;Polybar launched...&amp;quot;
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Установим права на исполнение:
&lt;pre>&lt;code class="language-shell">chmod +x ~/.config/i3/polybar/launch.sh
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Добавим вызов &lt;code>polybar&lt;/code> в файл конфигурации &lt;em>i3&lt;/em>. Конфигурацию для &lt;em>i3bar&lt;/em> следует закомментировать.
&lt;pre>&lt;code class="language-conf-unix">## ~/.config/i3/config
## Start i3bar to display a workspace bar
# bar {
# font pango:Source Sans Pro, FontAwesome 5 Free 10
# status_command i3status --config ~/.config/i3/i3status/config
# position top
# }
## Start polybar
exec_always --no-startup-id ~/.config/i3/polybar/launch.sh
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h3 id="запуск-приложений">&lt;span class="section-num">5.4&lt;/span> Запуск приложений&lt;/h3>
&lt;ul>
&lt;li>По умолчанию используется &lt;code>dmenu&lt;/code>.&lt;/li>
&lt;li>Можно заменить на &lt;code>rofi&lt;/code> (см. &lt;a href="https://yamadharma.github.io/ru/post/2021/11/19/launcher_rofi/">Запуск приложений. Rofi&lt;/a>).&lt;/li>
&lt;/ul>
&lt;h4 id="rofi">&lt;span class="section-num">5.4.1&lt;/span> rofi&lt;/h4>
&lt;ul>
&lt;li>Используется для запуска приложений, переключения окон.&lt;/li>
&lt;li>&lt;a href="https://github.com/davatorium/rofi" target="_blank" rel="noopener">https://github.com/davatorium/rofi&lt;/a>&lt;/li>
&lt;li>Конфигурация по умолчанию находится в &lt;code>~/.config/rofi/config&lt;/code>.&lt;/li>
&lt;li>Для выбора темы можно использовать команду:
&lt;pre>&lt;code class="language-shell">rofi-theme-selector
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Для запуска программ используется несколько мод:
&lt;ul>
&lt;li>&lt;code>run&lt;/code>: запускать приложения из пути (&lt;code>$PATH&lt;/code>) с возможностью запуска в терминале.&lt;/li>
&lt;li>&lt;code>drun&lt;/code>: запускать приложения на основе desctop-файлов (по стандарту XDG).&lt;/li>
&lt;li>&lt;code>window&lt;/code>: переключение между окнами в оконном менеджере, совместимом со спецификацией EWMH.&lt;/li>
&lt;li>&lt;code>ssh&lt;/code>: подключение к удаленному хосту через &lt;code>ssh&lt;/code>.&lt;/li>
&lt;li>&lt;code>file-browser&lt;/code>: базовый файловый броузер для открытия файлов.&lt;/li>
&lt;li>&lt;code>keys&lt;/code>: список внутренних привязок клавиш.&lt;/li>
&lt;li>&lt;code>script&lt;/code>: использование простых скриптов.&lt;/li>
&lt;li>&lt;code>combi&lt;/code>: объединяет несколько мод в одну.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Использование запятых в файле настроек &lt;em>i3&lt;/em> может привести к проблемам. Лучше использовать файл настроек &lt;em>rofi&lt;/em> или замените запятые символом &lt;code>#&lt;/code>, например, заменить строку
&lt;pre>&lt;code class="language-conf-unix">rofi -combi-modi window,drun,ssh
&lt;/code>&lt;/pre>
на
&lt;pre>&lt;code class="language-conf-unix">rofi -combi-modi window#drun#ssh
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Возможная конфигурация в командной строке команды &lt;code>rofi&lt;/code>:
&lt;pre>&lt;code class="language-conf-unix">## ~/.config/i3/config
set $menu rofi -combi-modi window#drun -show combi -modi combi -show-icons
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Конфигурация с помощью конфигурационного файла (поместим его в &lt;code>~/.config/i3/rofi/config&lt;/code>).&lt;/li>
&lt;/ul>
&lt;h3 id="блокировка-экрана">&lt;span class="section-num">5.5&lt;/span> Блокировка экрана&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>Для отключения экрана можно использовать DPMS:&lt;/p>
&lt;pre>&lt;code class="language-cfg">exec --no-startup-id xset dpms 1800
&lt;/code>&lt;/pre>
&lt;ul>
&lt;li>Отключается через 30 минут.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h4 id="блокировщик-экрана-i3lock">&lt;span class="section-num">5.5.1&lt;/span> Блокировщик экрана &lt;code>i3lock&lt;/code>&lt;/h4>
&lt;ul>
&lt;li>
&lt;p>В качестве блокировщика экрана используем &lt;code>i3lock&lt;/code>.&lt;/p>
&lt;ul>
&lt;li>Установка
&lt;ul>
&lt;li>Gentoo
&lt;pre>&lt;code class="language-shell">emerge x11-misc/i3lock
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Использование в конфигурационном файле:&lt;/p>
&lt;pre>&lt;code class="language-cfg">set $Locker i3lock --color=000000 &amp;amp;&amp;amp; sleep 1
&lt;/code>&lt;/pre>
&lt;ul>
&lt;li>&lt;code>sleep 1&lt;/code> добавляет небольшую задержку, чтобы предотвратить возможное состояние гонки.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Для блокировки экрана после заданного периода времени можно использовать &lt;code>xautolock&lt;/code> или &lt;code>xss-lock&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Использование &lt;code>xautolock&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Установка&lt;/p>
&lt;ul>
&lt;li>Gentoo
&lt;pre>&lt;code class="language-shell">emerge x11-misc/xautolock
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Использование в конфигурационном файле:&lt;/p>
&lt;pre>&lt;code class="language-cfg">exec --no-startup-id xautolock -time 10 -locker &amp;quot;$Locker&amp;quot;
&lt;/code>&lt;/pre>
&lt;ul>
&lt;li>Блокирует через 10 минут.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Использование &lt;code>xss-lock&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Установка&lt;/p>
&lt;ul>
&lt;li>Gentoo
&lt;pre>&lt;code class="language-shell">emerge x11-misc/xss-lock
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Использование в конфигурационном файле:&lt;/p>
&lt;pre>&lt;code class="language-cfg">exec --no-startup-id xss-lock -- &amp;quot;$Locker&amp;quot;
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;h4 id="блокировщик-экрана-i3lock-color">&lt;span class="section-num">5.5.2&lt;/span> Блокировщик экрана &lt;code>i3lock-color&lt;/code>&lt;/h4>
&lt;ul>
&lt;li>Репозиторий: &lt;a href="https://github.com/Raymo111/i3lock-color" target="_blank" rel="noopener">https://github.com/Raymo111/i3lock-color&lt;/a>&lt;/li>
&lt;/ul>
&lt;!--list-separator-->
&lt;ol>
&lt;li>
&lt;p>Дополнительные возможности в i3lock-color&lt;/p>
&lt;ul>
&lt;li>Дополнительное управление цветом элементов.&lt;/li>
&lt;li>Размытие текущего экрана и использование его в качестве фона блокировки.&lt;/li>
&lt;li>Отображение часов в индикаторе.&lt;/li>
&lt;li>Обновление по таймеру, а не при каждом нажатии клавиши.&lt;/li>
&lt;li>Отображение раскладки клавиатуры.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;!--list-separator-->
&lt;ol start="2">
&lt;li>
&lt;p>Установка&lt;/p>
&lt;ul>
&lt;li>Gentoo
&lt;ul>
&lt;li>Порт находится в оверлее &lt;code>guru&lt;/code>:
&lt;pre>&lt;code class="language-shell">emerge x11-misc/i3lock-color
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h2 id="приложения">&lt;span class="section-num">6&lt;/span> Приложения&lt;/h2>
&lt;h3 id="снимки-экрана">&lt;span class="section-num">6.1&lt;/span> Снимки экрана&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>Для скриншотов можно использовать &lt;a href="https://github.com/resurrecting-open-source-projects/scrot" target="_blank" rel="noopener">scrot&lt;/a>.&lt;/p>
&lt;ul>
&lt;li>Gentoo
&lt;pre>&lt;code class="language-shell">emerge media-gfx/scrot
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Добавим в конфигурационный файл:&lt;/p>
&lt;pre>&lt;code class="language-conf-unix">## Screenshot
## Screenshot active display
bindsym --release Print exec --no-startup-id scrot '%Y-%m-%d_%H-%M-%S_$wx$h.png' -e 'mv $f `xdg-user-dir PICTURES` 2&amp;gt;/dev/null'
## Screenshot current window
bindsym --release $mod+Print exec --no-startup-id scrot -u '%Y-%m-%d_%H-%M-%S_$wx$h.png' -e 'mv $f `xdg-user-dir PICTURES` 2&amp;gt;/dev/null'
## Screenshot selected region
bindsym --release $mod+Shift+Print exec --no-startup-id scrot -s '%Y-%m-%d_%H-%M-%S_$wx$h.png' -e 'mv $f `xdg-user-dir PICTURES` 2&amp;gt;/dev/null'
&lt;/code>&lt;/pre>
&lt;ul>
&lt;li>По клавише &lt;code>PrtScr&lt;/code> делается скриншот.&lt;/li>
&lt;li>По клавише &lt;code>mod&lt;/code> + &lt;code>PrtScr&lt;/code> делается скриншот активного окна.&lt;/li>
&lt;li>По клавише &lt;code>mod&lt;/code> + &lt;code>Shift&lt;/code> + &lt;code>PrtScr&lt;/code> предлагается выделить область экрана, скриншот которой следует сделать.&lt;/li>
&lt;li>Скриншоты переносятся в каталог $XDG_PICTURES_DIR (обычно &lt;code>~/Pictures&lt;/code> или &lt;code>~/Изображения&lt;/code>) (см. &lt;a href="https://yamadharma.github.io/ru/post/2021/09/16/xdg-user-directories/">XDG. Пользовательские каталоги&lt;/a>).&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="совместимость-приложений">&lt;span class="section-num">7&lt;/span> Совместимость приложений&lt;/h2>
&lt;h3 id="java">&lt;span class="section-num">7.1&lt;/span> Java&lt;/h3>
&lt;h4 id="серое-окно-приложения-не-меняют-размер-с-помощью-wm-меню-сразу-закрываются">&lt;span class="section-num">7.1.1&lt;/span> Серое окно, приложения не меняют размер с помощью WM, меню сразу закрываются&lt;/h4>
&lt;ul>
&lt;li>В стандартных тулкитах для Java жестко зашит список оконных менеджеров.&lt;/li>
&lt;li>Следует установить переменную окружения:
&lt;pre>&lt;code class="language-shell">export _JAVA_AWT_WM_NONREPARENTING=1
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;h4 id="меню-в-приложениях-плавает-отдельно-им-невозможно-пользоваться">&lt;span class="section-num">7.1.2&lt;/span> Меню в приложениях плавает отдельно, им невозможно пользоваться&lt;/h4>
&lt;ul>
&lt;li>В выпусках Java до версии 9 GTK интерфейс ориентирован на GTK2, в последующих версиях на GTK3.&lt;/li>
&lt;li>GTK LookAndFeel может работать с GTK версий 2, 2.2 и 3.&lt;/li>
&lt;li>По умолчанию используется GTK3.&lt;/li>
&lt;li>Следует явно задать более старую версию:
&lt;pre>&lt;code class="language-shell">export JAVA_TOOL_OPTIONS='-Djdk.gtk.version=2.2'
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul></description></item><item><title>Мультимедиа сервер PipeWire</title><link>https://yamadharma.github.io/ru/post/2021/04/28/pipewire-multimedia-server/</link><pubDate>Wed, 28 Apr 2021 16:28:00 +0300</pubDate><guid>https://yamadharma.github.io/ru/post/2021/04/28/pipewire-multimedia-server/</guid><description>&lt;p>PipeWire есть новый аудио и видео сервер. В основном для Wayland. Должен заменить другие видео-серверы.&lt;/p>
&lt;details class="toc-inpage d-print-none " open>
&lt;summary class="font-weight-bold">Содержание&lt;/summary>
&lt;nav id="TableOfContents">
&lt;ul>
&lt;li>&lt;a href="#общая-информация">&lt;span class="section-num">1&lt;/span> Общая информация&lt;/a>&lt;/li>
&lt;li>&lt;a href="#установка">&lt;span class="section-num">2&lt;/span> Установка&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#gentoo">&lt;span class="section-num">2.1&lt;/span> Gentoo&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#настройка-пользовательской-сессии">&lt;span class="section-num">3&lt;/span> Настройка пользовательской сессии&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#права-пользователя">&lt;span class="section-num">3.1&lt;/span> Права пользователя&lt;/a>&lt;/li>
&lt;li>&lt;a href="#настройка-запуска-на-уровне-пользователя">&lt;span class="section-num">3.2&lt;/span> Настройка запуска на уровне пользователя&lt;/a>&lt;/li>
&lt;li>&lt;a href="#настройка-запуска-на-уровне-системы">&lt;span class="section-num">3.3&lt;/span> Настройка запуска на уровне системы&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#использование-с-другими-серверами">&lt;span class="section-num">4&lt;/span> Использование с другими серверами&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#замена-pulseaudio">&lt;span class="section-num">4.1&lt;/span> Замена PulseAudio&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#pulseaudio-с-поддержкой-запуска-как-демон">&lt;span class="section-num">4.1.1&lt;/span> PulseAudio с поддержкой запуска как демон&lt;/a>&lt;/li>
&lt;li>&lt;a href="#pulseaudio-без-поддержки-запуска-кок-демон">&lt;span class="section-num">4.1.2&lt;/span> PulseAudio без поддержки запуска кок демон&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#замена-jack">&lt;span class="section-num">4.2&lt;/span> Замена Jack&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#проверка-работы">&lt;span class="section-num">5&lt;/span> Проверка работы&lt;/a>&lt;/li>
&lt;li>&lt;a href="#конфигурация">&lt;span class="section-num">6&lt;/span> Конфигурация&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#конфигурационные-файлы">&lt;span class="section-num">6.1&lt;/span> Конфигурационные файлы&lt;/a>&lt;/li>
&lt;li>&lt;a href="#профили-устройств">&lt;span class="section-num">6.2&lt;/span> Профили устройств&lt;/a>&lt;/li>
&lt;li>&lt;a href="#изменение-частоты-дискретизации">&lt;span class="section-num">6.3&lt;/span> Изменение частоты дискретизации&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/nav>
&lt;/details>
&lt;h2 id="общая-информация">&lt;span class="section-num">1&lt;/span> Общая информация&lt;/h2>
&lt;ul>
&lt;li>Репозиторий проекта: &lt;a href="https://gitlab.freedesktop.org/pipewire/pipewire" target="_blank" rel="noopener">https://gitlab.freedesktop.org/pipewire/pipewire&lt;/a>&lt;/li>
&lt;li>Wiki проекта: &lt;a href="https://gitlab.freedesktop.org/pipewire/pipewire/-/wikis/home" target="_blank" rel="noopener">https://gitlab.freedesktop.org/pipewire/pipewire/-/wikis/home&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="установка">&lt;span class="section-num">2&lt;/span> Установка&lt;/h2>
&lt;h3 id="gentoo">&lt;span class="section-num">2.1&lt;/span> Gentoo&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>Чтобы использовать PipeWire вместо PulseAudio для звукового сервера, включите USE-флаг &lt;code>USE=sound-server&lt;/code> для &lt;code>media-video/pipewire&lt;/code> и отключите USE-флаг &lt;code>USE=daemon&lt;/code> для &lt;code>media-sound/pulseaudio&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Добавьте в файл &lt;code>/etc/portage/package.use&lt;/code>:&lt;/p>
&lt;pre>&lt;code class="language-conf-unix">media-video/pipewire sound-server
media-sound/pulseaudio -daemon
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>
&lt;p>Удалите &lt;code>media-sound/pulseaudio-daemon&lt;/code>:&lt;/p>
&lt;pre>&lt;code class="language-shell">emerge -Cv media-sound/pulseaudio-daemon
emerge -Cv media-sound/paprefs
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>
&lt;p>Установить само приложение:&lt;/p>
&lt;pre>&lt;code class="language-shell">emerge media-video/pipewire
emerge media-video/wireplumber
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;h2 id="настройка-пользовательской-сессии">&lt;span class="section-num">3&lt;/span> Настройка пользовательской сессии&lt;/h2>
&lt;h3 id="права-пользователя">&lt;span class="section-num">3.1&lt;/span> Права пользователя&lt;/h3>
&lt;ul>
&lt;li>Желательно добавить пользователя в группу &lt;code>audio&lt;/code>:
&lt;pre>&lt;code class="language-shell">usermod -aG audio &amp;lt;user&amp;gt;
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;h3 id="настройка-запуска-на-уровне-пользователя">&lt;span class="section-num">3.2&lt;/span> Настройка запуска на уровне пользователя&lt;/h3>
&lt;ul>
&lt;li>По умолчанию &lt;em>PipeWire&lt;/em> настроен на использование &lt;em>systemd&lt;/em>.&lt;/li>
&lt;li>Следует настроить его запуск для пользователя.&lt;/li>
&lt;li>Флаг &lt;code>--now&lt;/code> позволяет одновременно активировать и запускать сервис.&lt;/li>
&lt;li>Отключите &lt;code>pulseaudio&lt;/code>:
&lt;pre>&lt;code class="language-shell">systemctl --user disable --now pulseaudio.socket pulseaudio.service
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Для каждого пользователя можно установить активацию по обращению к сокету:
&lt;pre>&lt;code class="language-shell">systemctl --user enable --now pipewire.socket pipewire-pulse.socket
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>В качестве альтернативы можно сразу запускать необходимый процесс:
&lt;pre>&lt;code class="language-shell">systemctl --user enable --now pipewire.service pipewire-pulse.service
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Отключите демон сессии &lt;code>pipewire-media-session.service&lt;/code> и запустите &lt;code>wireplumber&lt;/code>:
&lt;pre>&lt;code class="language-shell">systemctl --user disable pipewire-media-session.service
systemctl --user --force enable --now wireplumber.service
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;h3 id="настройка-запуска-на-уровне-системы">&lt;span class="section-num">3.3&lt;/span> Настройка запуска на уровне системы&lt;/h3>
&lt;ul>
&lt;li>Под пользователем &lt;code>root&lt;/code> можно настроить запуск сервисов на уровне системы, заменив &lt;code>--user&lt;/code> на &lt;code>--global&lt;/code>:
&lt;pre>&lt;code class="language-shell">systemctl --global enable pipewire.socket pipewire-pulse.socket
systemctl --global --force enable wireplumber.service
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>При выборе этого варианта службы должны быть запущены вручную под пользователем пользователем.&lt;/li>
&lt;/ul>
&lt;h2 id="использование-с-другими-серверами">&lt;span class="section-num">4&lt;/span> Использование с другими серверами&lt;/h2>
&lt;h3 id="замена-pulseaudio">&lt;span class="section-num">4.1&lt;/span> Замена PulseAudio&lt;/h3>
&lt;h4 id="pulseaudio-с-поддержкой-запуска-как-демон">&lt;span class="section-num">4.1.1&lt;/span> PulseAudio с поддержкой запуска как демон&lt;/h4>
&lt;ul>
&lt;li>Ранее &lt;em>PulseAudio&lt;/em> собиралась только с поддержкой запуска как демон.&lt;/li>
&lt;li>Если &lt;em>PulseAudio&lt;/em> настроено с поддержкой запуска как демона&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>, то его необходимо отключить:
&lt;ul>
&lt;li>запретить запуск &lt;code>pulseaudio&lt;/code>;&lt;/li>
&lt;li>отключить запуск в файле конфигурации:
&lt;ul>
&lt;li>отредактируйте файл &lt;code>/etc/pulse/daemon.conf&lt;/code> и замените &lt;code>daemonize&lt;/code> на &lt;code>daemonize = no&lt;/code>.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Одновременно отключим &lt;em>PulseAudio&lt;/em> и включим &lt;em>PipeWire&lt;/em> для каждого пользователя:
&lt;pre>&lt;code class="language-shell">systemctl --user disable --now pulseaudio.socket pulseaudio.service
systemctl --user enable --now pipewire.socket pipewire-pulse.socket wireplumber.service
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Можно замаскировать PulseAudio (но он всё равно может стартовать автоматически):
&lt;pre>&lt;code class="language-shell">systemctl --user mask pulseaudio.socket pulseaudio.service
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Кроме того, рекомендуется удалить файлы, оставшиеся от PulseAudio:
&lt;pre>&lt;code class="language-shell">rm -r ~/.config/pulse/
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;h4 id="pulseaudio-без-поддержки-запуска-кок-демон">&lt;span class="section-num">4.1.2&lt;/span> PulseAudio без поддержки запуска кок демон&lt;/h4>
&lt;ul>
&lt;li>Теперь &lt;em>PulseAudio&lt;/em> рекомендуется собирать без поддержки демона.&lt;/li>
&lt;li>В этом случае всё работает сразу.&lt;/li>
&lt;li>Напомним, что на уровне пользователя следует подключить &lt;code>pipewire-pulse.socket&lt;/code>:
&lt;pre>&lt;code class="language-shell">systemctl --user disable --now pulseaudio.socket pulseaudio.service
systemctl --user enable --now pipewire.socket pipewire-pulse.socket wireplumber.service
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;h3 id="замена-jack">&lt;span class="section-num">4.2&lt;/span> Замена Jack&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>Для маршрутизации клиентов Jack через PipeWire в настоящее время
предпочтительно запускать их через &lt;code>pw-jack&lt;/code>, который использует
&lt;code>LD_PRELOAD&lt;/code> для использования библиотек PipeWire вместо Jack, например:&lt;/p>
&lt;pre>&lt;code class="language-shell">pw-jack &amp;lt;application&amp;gt;
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>
&lt;p>Можно задать собственный размер буфера, установив размер_буфера/частота_дискретизации:&lt;/p>
&lt;pre>&lt;code class="language-shell">PIPEWIRE_LATENCY=&amp;quot;128/48000&amp;quot; pw-jack &amp;lt;application&amp;gt;
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;h2 id="проверка-работы">&lt;span class="section-num">5&lt;/span> Проверка работы&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>Для &lt;em>PipeWire&lt;/em> возможно посмотреть информацию по серверу &lt;code>pipewire&lt;/code>:&lt;/p>
&lt;pre>&lt;code class="language-shell">LANG=C pactl info | grep &amp;quot;Server Name&amp;quot;
&lt;/code>&lt;/pre>
&lt;ul>
&lt;li>В результате должна присутствовать строчка типа такой:
&lt;pre>&lt;code class="language-shell">Server Name: PulseAudio (on PipeWire 0.3.56)
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="конфигурация">&lt;span class="section-num">6&lt;/span> Конфигурация&lt;/h2>
&lt;h3 id="конфигурационные-файлы">&lt;span class="section-num">6.1&lt;/span> Конфигурационные файлы&lt;/h3>
&lt;ul>
&lt;li>Конфигурация, идущая в комплекте с дистрибутивом, находится в &lt;code>/usr/share/pipewire&lt;/code>.&lt;/li>
&lt;li>Для изменения параметров скопируйте файлы конфигурации в:
&lt;ul>
&lt;li>&lt;code>/etc/pipewire&lt;/code>: уровень системы;&lt;/li>
&lt;li>&lt;code>~/.config/pipewire&lt;/code>: уровень пользователя.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="профили-устройств">&lt;span class="section-num">6.2&lt;/span> Профили устройств&lt;/h3>
&lt;ul>
&lt;li>Профили устройств хранятся в каталоге &lt;code>~/.local/state/pipewire/media-session.d/&lt;/code>.&lt;/li>
&lt;li>При запуске в первый раз с подключёнными внешними устройствами (например, usb-устройствами), профили для них не создаются. Необходимо их переподключить в этом случае.&lt;/li>
&lt;/ul>
&lt;h3 id="изменение-частоты-дискретизации">&lt;span class="section-num">6.3&lt;/span> Изменение частоты дискретизации&lt;/h3>
&lt;ul>
&lt;li>По умолчанию &lt;em>PipeWire&lt;/em> глобально устанавливает частоту дискретизации равную 48 КГц.&lt;/li>
&lt;li>Для изменения нужно отредактировать строку &lt;code>default.clock.rate = 48000&lt;/code> в файле конфигурации &lt;code>/etc/pipewire/pipewire.conf&lt;/code> или &lt;code>~/.config/pipewire/pipewire.conf&lt;/code>.&lt;/li>
&lt;li>Например, если вы хотите частоту дискретизации в 192 КГц, раскомментируйте строку и поменяйте её на &lt;code>default.clock.rate = 192000&lt;/code>.&lt;/li>
&lt;/ul>
&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>В Gentoo это означает, что &lt;code>pulseaudio&lt;/code> скомпилирован с флагом &lt;code>daemon&lt;/code>.&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>Переход на Sway</title><link>https://yamadharma.github.io/ru/post/2020/09/10/migration-sway/</link><pubDate>Thu, 10 Sep 2020 10:33:15 +0300</pubDate><guid>https://yamadharma.github.io/ru/post/2020/09/10/migration-sway/</guid><description>&lt;p>Решил попробовать &lt;a href="https://wayland.freedesktop.org/" target="_blank" rel="noopener">Wayland&lt;/a>. По этой причине пришлось &lt;a href="http://way-cooler.org/blog/2020/01/09/way-cooler-post-mortem.html" target="_blank" rel="noopener">перейти&lt;/a> с &lt;a href="https://awesomewm.org/" target="_blank" rel="noopener">awesome&lt;/a> на &lt;a href="https://swaywm.org/" target="_blank" rel="noopener">swlay&lt;/a>.&lt;/p>
&lt;details class="toc-inpage d-print-none " open>
&lt;summary class="font-weight-bold">Содержание&lt;/summary>
&lt;nav id="TableOfContents">
&lt;ul>
&lt;li>&lt;a href="#общая-информация">&lt;span class="section-num">1&lt;/span> Общая информация&lt;/a>&lt;/li>
&lt;li>&lt;a href="#установка-sway">&lt;span class="section-num">2&lt;/span> Установка &lt;code>sway&lt;/code>&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#репозитории-gentoo">&lt;span class="section-num">2.1&lt;/span> Репозитории &lt;code>gentoo&lt;/code>&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#первоначальная-конфигурация">&lt;span class="section-num">3&lt;/span> Первоначальная конфигурация&lt;/a>&lt;/li>
&lt;li>&lt;a href="#комбинации-клавиш">&lt;span class="section-num">4&lt;/span> Комбинации клавиш&lt;/a>&lt;/li>
&lt;li>&lt;a href="#замена-приложений">&lt;span class="section-num">5&lt;/span> Замена приложений&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#ресурсы-по-миграции-с-x-window">&lt;span class="section-num">5.1&lt;/span> Ресурсы по миграции с X Window&lt;/a>&lt;/li>
&lt;li>&lt;a href="#снимки-экрана">&lt;span class="section-num">5.2&lt;/span> Снимки экрана&lt;/a>&lt;/li>
&lt;li>&lt;a href="#видеозапись-экрана--скринкаст">&lt;span class="section-num">5.3&lt;/span> Видеозапись экрана (скринкаст)&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#видеозапись-экрана-командная-строка">&lt;span class="section-num">5.3.1&lt;/span> Видеозапись экрана &amp;ndash; командная строка&lt;/a>&lt;/li>
&lt;li>&lt;a href="#видеозапись-экрана-графическое-приложение">&lt;span class="section-num">5.3.2&lt;/span> Видеозапись экрана &amp;ndash; графическое приложение&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#строка-состояний">&lt;span class="section-num">5.4&lt;/span> Строка состояний&lt;/a>&lt;/li>
&lt;li>&lt;a href="#уведомления">&lt;span class="section-num">5.5&lt;/span> Уведомления&lt;/a>&lt;/li>
&lt;li>&lt;a href="#настройка-вывода">&lt;span class="section-num">5.6&lt;/span> Настройка вывода&lt;/a>&lt;/li>
&lt;li>&lt;a href="#меню-программ--launcher">&lt;span class="section-num">5.7&lt;/span> Меню программ (launcher)&lt;/a>&lt;/li>
&lt;li>&lt;a href="#буфер-обмена">&lt;span class="section-num">5.8&lt;/span> Буфер обмена&lt;/a>&lt;/li>
&lt;li>&lt;a href="#блокировка-экрана">&lt;span class="section-num">5.9&lt;/span> Блокировка экрана&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#swaylock">&lt;span class="section-num">5.9.1&lt;/span> swaylock&lt;/a>&lt;/li>
&lt;li>&lt;a href="#swaylock-effects">&lt;span class="section-num">5.9.2&lt;/span> swaylock-effects&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#совместимость-приложений">&lt;span class="section-num">6&lt;/span> Совместимость приложений&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#java">&lt;span class="section-num">6.1&lt;/span> Java&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#серое-окно-приложения-не-меняют-размер-с-помощью-wm-меню-сразу-закрываются">&lt;span class="section-num">6.1.1&lt;/span> Серое окно, приложения не меняют размер с помощью WM, меню сразу закрываются&lt;/a>&lt;/li>
&lt;li>&lt;a href="#меню-в-приложениях-плавает-отдельно-им-невозможно-пользоваться">&lt;span class="section-num">6.1.2&lt;/span> Меню в приложениях плавает отдельно, им невозможно пользоваться&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#приложения-gtk-plus-запускаются-с-задержкой">&lt;span class="section-num">6.2&lt;/span> Приложения GTK+ запускаются с задержкой&lt;/a>&lt;/li>
&lt;li>&lt;a href="#qt-приложения">&lt;span class="section-num">6.3&lt;/span> Qt приложения&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/nav>
&lt;/details>
&lt;h2 id="общая-информация">&lt;span class="section-num">1&lt;/span> Общая информация&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://swaywm.org/" target="_blank" rel="noopener">https://swaywm.org/&lt;/a>&lt;/li>
&lt;li>Создавался для замены i3 (см. &lt;a href="https://yamadharma.github.io/ru/post/2021/05/14/window-manager-i3/">Window manager i3&lt;/a>) под Wayland.&lt;/li>
&lt;/ul>
&lt;h2 id="установка-sway">&lt;span class="section-num">2&lt;/span> Установка &lt;code>sway&lt;/code>&lt;/h2>
&lt;pre>&lt;code class="language-shell">emerge -v gui-wm/sway
&lt;/code>&lt;/pre>
&lt;h3 id="репозитории-gentoo">&lt;span class="section-num">2.1&lt;/span> Репозитории &lt;code>gentoo&lt;/code>&lt;/h3>
&lt;p>Программы для Wayland есть как в основном репозитории, так и
дополнительных. Хочу порекомендовать для просмотра следующие
репозитории:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/epsilon-0/wayland-desktop" target="_blank" rel="noopener">wayland-desktop&lt;/a>&lt;/li>
&lt;/ul>
&lt;!--listend-->
&lt;pre>&lt;code class="language-shell">layman -a wayland-desktop
&lt;/code>&lt;/pre>
&lt;ul>
&lt;li>&lt;a href="https://wiki.gentoo.org/wiki/Project:GURU" target="_blank" rel="noopener">guru&lt;/a>&lt;/li>
&lt;/ul>
&lt;!--listend-->
&lt;pre>&lt;code class="language-shell">layman -a guru
&lt;/code>&lt;/pre>
&lt;h2 id="первоначальная-конфигурация">&lt;span class="section-num">3&lt;/span> Первоначальная конфигурация&lt;/h2>
&lt;ul>
&lt;li>Файл конфигурации ищется в следующем порядке:
&lt;ul>
&lt;li>&lt;code>~/.sway/config&lt;/code>;&lt;/li>
&lt;li>&lt;code>$XDG_CONFIG_HOME/sway/config&lt;/code>;&lt;/li>
&lt;li>&lt;code>~/.i3/config&lt;/code>;&lt;/li>
&lt;li>&lt;code>$XDG_CONFIG_HOME/i3/config&lt;/code>;&lt;/li>
&lt;li>&lt;code>/etc/sway/config&lt;/code>;&lt;/li>
&lt;li>&lt;code>/etc/i3/config&lt;/code>.&lt;/li>
&lt;li>Переменная окружения &lt;code>$XDG_CONFIG_HOME&lt;/code> по умолчанию установлена в &lt;code>~/.config/&lt;/code>.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Пакет устанавливает глобальную конфигурацию в &lt;code>/etc/sway/config&lt;/code>.&lt;/li>
&lt;li>При желании внести изменение в конфигурацию можно скопировать файл глобальной конфигурации в локальную:
&lt;pre>&lt;code class="language-shell">mkdir -p ~/.config/sway
cp /etc/sway/config ~/.config/sway/
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;h2 id="комбинации-клавиш">&lt;span class="section-num">4&lt;/span> Комбинации клавиш&lt;/h2>
&lt;p>Основные сочетания клавиш:&lt;/p>
&lt;ul>
&lt;li>&lt;code>Mod&lt;/code> + &lt;code>Enter&lt;/code> &amp;ndash; открыть новый терминал;&lt;/li>
&lt;li>&lt;code>Mod&lt;/code> + &lt;code>d&lt;/code> &amp;ndash; запустить программу;&lt;/li>
&lt;li>&lt;code>Mod&lt;/code> + &lt;code>0&lt;/code>.. &lt;code>9&lt;/code> &amp;ndash; переключение между workspace&amp;rsquo;ами;&lt;/li>
&lt;li>&lt;code>Mod&lt;/code> + &lt;code>Shift&lt;/code> + &lt;code>0&lt;/code> .. &lt;code>9&lt;/code> &amp;ndash; перемещение окон в заданный workspace;&lt;/li>
&lt;li>&lt;code>Mod&lt;/code> + &lt;code>Shift&lt;/code> + &lt;code>q&lt;/code> &amp;ndash; закрыть текущее окно;&lt;/li>
&lt;li>&lt;code>Mod&lt;/code> + стрелки &amp;ndash; перемещение между окнами, вместо стрелочек также могут быть использованы клавиши «J» (влево), «K» (вниз), «L» (вверх) и «;» (вправо);&lt;/li>
&lt;li>&lt;code>Mod&lt;/code> + &lt;code>Shift&lt;/code> + стрелки &amp;ndash; перемещение окон в пределах workspace&amp;rsquo;а, вместо стрелок также могут быть использованы буквы и точка с запятой;&lt;/li>
&lt;li>&lt;code>Mod&lt;/code> + &lt;code>v&lt;/code> &amp;ndash; использовать вертикальное разбиение;&lt;/li>
&lt;li>&lt;code>Mod&lt;/code> + &lt;code>h&lt;/code> &amp;ndash; использовать горизонтальное разбиение;&lt;/li>
&lt;li>&lt;code>Mod&lt;/code> + &lt;code>e&lt;/code> &amp;ndash; размещение окон по-умолчанию (default layout);&lt;/li>
&lt;li>&lt;code>Mod&lt;/code> + &lt;code>s&lt;/code> &amp;ndash; стековое размещение (stacking layout);&lt;/li>
&lt;li>&lt;code>Mod&lt;/code> + &lt;code>w&lt;/code> &amp;ndash; размещение с табами (tabbed layout);&lt;/li>
&lt;li>&lt;code>Mod&lt;/code> + &lt;code>f&lt;/code> &amp;ndash; раскрыть окно во весь экран или свернуть его обратно;&lt;/li>
&lt;li>&lt;code>Mod&lt;/code> + &lt;code>Shift&lt;/code> + &lt;code>Space&lt;/code> &amp;ndash; разрешить свободное перемещение окна (floating mode) или вернуть его в мозаику;&lt;/li>
&lt;li>&lt;code>Mod&lt;/code> + &lt;code>Shift&lt;/code> + &lt;code>c&lt;/code> &amp;ndash; перечитать конфигурацию &lt;code>sway&lt;/code> (перестартовать);&lt;/li>
&lt;li>&lt;code>Mod&lt;/code> + &lt;code>Shift&lt;/code> + &lt;code>e&lt;/code> &amp;ndash; выйти из &lt;code>sway&lt;/code>.&lt;/li>
&lt;/ul>
&lt;p>Кроме того, часть сочетаний клавиш определяется в файлах, определяющих конкретный функционал.&lt;/p>
&lt;h2 id="замена-приложений">&lt;span class="section-num">5&lt;/span> Замена приложений&lt;/h2>
&lt;h3 id="ресурсы-по-миграции-с-x-window">&lt;span class="section-num">5.1&lt;/span> Ресурсы по миграции с X Window&lt;/h3>
&lt;ul>
&lt;li>&lt;a href="https://github.com/swaywm/sway/wiki/i3-Migration-Guide" target="_blank" rel="noopener">https://github.com/swaywm/sway/wiki/i3-Migration-Guide&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/swaywm/sway/wiki/Useful-add-ons-for-sway" target="_blank" rel="noopener">https://github.com/swaywm/sway/wiki/Useful-add-ons-for-sway&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://wiki.gentoo.org/wiki/List_of_software_for_Wayland" target="_blank" rel="noopener">https://wiki.gentoo.org/wiki/List_of_software_for_Wayland&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/natpen/awesome-wayland" target="_blank" rel="noopener">https://github.com/natpen/awesome-wayland&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://arewewaylandyet.com/" target="_blank" rel="noopener">https://arewewaylandyet.com/&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="снимки-экрана">&lt;span class="section-num">5.2&lt;/span> Снимки экрана&lt;/h3>
&lt;p>Исходно использовался &lt;code>scrot&lt;/code>.&lt;/p>
&lt;p>Для Wayland перешёл на связку &lt;a href="https://github.com/emersion/grim" target="_blank" rel="noopener">grim&lt;/a> (получение снимка экрана) + &lt;a href="https://github.com/emersion/slurp" target="_blank" rel="noopener">slurp&lt;/a> (выделение области экрана):&lt;/p>
&lt;pre>&lt;code class="language-shell">emerge -uv gui-apps/slurp gui-apps/grim
&lt;/code>&lt;/pre>
&lt;p>Настроим получение снимков экрана:&lt;/p>
&lt;pre>&lt;code class="language-conf-unix"># ~/.config/sway/config.d/80-screenshots.conf
# Screenshot active display
bindsym Print exec grim -t png &amp;quot;$(xdg-user-dir PICTURES)&amp;quot;/$(date +%Y-%m-%d_%H-%M-%S).png
# Screenshot current window
bindsym $mod+Print exec grim -g &amp;quot;$(swaymsg -t get_tree | jq -r '.. | select(.pid? and .visible?) | .rect | &amp;quot;\(.x),\(.y) \(.width)x\(.height)&amp;quot;')&amp;quot; &amp;quot;$(xdg-user-dir PICTURES)&amp;quot;/$(date +%Y-%m-%d_%H-%M-%S).png
# Screenshot selected region
bindsym $mod+Shift+Print exec grim -t png -g &amp;quot;$(slurp)&amp;quot; &amp;quot;$(xdg-user-dir PICTURES)&amp;quot;/$(date +%Y-%m-%d_%H-%M-%S).png
&lt;/code>&lt;/pre>
&lt;ul>
&lt;li>При нажатии клавиши &lt;code>PrtScr&lt;/code> делается снимок всего экрана.&lt;/li>
&lt;li>При нажатии &lt;code>Mod4&lt;/code> + &lt;code>PrtScr&lt;/code> делается снимок активного окна.&lt;/li>
&lt;li>При нажатии &lt;code>Mod4&lt;/code> + &lt;code>Shift&lt;/code> + &lt;code>PrtScr&lt;/code> предлагается выбрать область экрана, снимок которой следует сделать.&lt;/li>
&lt;/ul>
&lt;h3 id="видеозапись-экрана--скринкаст">&lt;span class="section-num">5.3&lt;/span> Видеозапись экрана (скринкаст)&lt;/h3>
&lt;p>Ранее использовался &lt;a href="https://www.maartenbaert.be/simplescreenrecorder/" target="_blank" rel="noopener">SimpleScreenRecorder&lt;/a>.&lt;/p>
&lt;h4 id="видеозапись-экрана-командная-строка">&lt;span class="section-num">5.3.1&lt;/span> Видеозапись экрана &amp;ndash; командная строка&lt;/h4>
&lt;p>Для записи из командной строки используем &lt;a href="https://github.com/ammen99/wf-recorder" target="_blank" rel="noopener">wf-recorder&lt;/a>:&lt;/p>
&lt;pre>&lt;code class="language-shell">emerge -v gui-apps/wf-recorder
&lt;/code>&lt;/pre>
&lt;p>Варианты использования:&lt;/p>
&lt;ul>
&lt;li>Запись всего экрана в файл &lt;code>recording.mkv&lt;/code> (только видео):&lt;/li>
&lt;/ul>
&lt;!--listend-->
&lt;pre>&lt;code class="language-shell">wf-recorder -f recording$(date +%Y-%m-%d_%H-%M-%S).mkv
&lt;/code>&lt;/pre>
&lt;p>Если файл не указывать, запись будет в текущий каталог.&lt;/p>
&lt;ul>
&lt;li>Запись фрагмента экрана (тут имя файла задаётся по времени начала
записи):&lt;/li>
&lt;/ul>
&lt;!--listend-->
&lt;pre>&lt;code class="language-shell">wf-recorder -g &amp;quot;$(slurp)&amp;quot; -f $(date +%Y-%m-%d_%H-%M-%S).mkv
&lt;/code>&lt;/pre>
&lt;ul>
&lt;li>Запись со звуком:&lt;/li>
&lt;/ul>
&lt;!--listend-->
&lt;pre>&lt;code class="language-shell">wf-recorder --audio -f $(date +%Y-%m-%d_%H-%M-%S).mkv
&lt;/code>&lt;/pre>
&lt;ul>
&lt;li>Запись с использование GPU (VAAPI интерфейс):&lt;/li>
&lt;/ul>
&lt;!--listend-->
&lt;pre>&lt;code class="language-shell">wf-recorder --audio -f $(date +%Y-%m-%d_%H-%M-%S).mkv -c h264_vaapi -d /dev/dri/renderD128
&lt;/code>&lt;/pre>
&lt;h4 id="видеозапись-экрана-графическое-приложение">&lt;span class="section-num">5.3.2&lt;/span> Видеозапись экрана &amp;ndash; графическое приложение&lt;/h4>
&lt;p>Для захвата десктопа в Wayland используется плагин &lt;a href="https://hg.sr.ht/~scoopta/wlrobs" target="_blank" rel="noopener">wlrobs&lt;/a>.&lt;/p>
&lt;h3 id="строка-состояний">&lt;span class="section-num">5.4&lt;/span> Строка состояний&lt;/h3>
&lt;p>Sway поддерживает свою строку состояний &lt;code>sway-bar&lt;/code>. Удобное и минималистическое приложение. Однако, удручает, что иконки в трее не активны.&lt;/p>
&lt;p>Попробуем использовать более продвинутый вариант &amp;ndash; &lt;a href="https://github.com/Alexays/Waybar" target="_blank" rel="noopener">waybar&lt;/a>&lt;/p>
&lt;pre>&lt;code class="language-shell">emerge -v gui-apps/waybar
&lt;/code>&lt;/pre>
&lt;p>Конфигурация:&lt;/p>
&lt;pre>&lt;code class="language-conf-unix">## sway-bar
# Read `man 5 sway-bar` for more information about this section.
# bar {
# position top
# # When the status_command prints a new line to stdout, swaybar updates.
# # The default just shows the current date and time.
# status_command while date +'%Y-%m-%d %H:%M:%S'; do sleep 1; done
# colors {
# statusline #ffffff
# background #323232
# inactive_workspace #32323200 #32323200 #5c5c5c
# }
# }
## Waybar
# &amp;lt;https://github.com/Alexays/Waybar&amp;gt;
exec_always ~/.config/sway/scripts/waybar.sh
# Waybar Tooltips don't steel focus
no_focus [app_id=&amp;quot;waybar&amp;quot;]
for_window [app_id=&amp;quot;waybar&amp;quot; floating] {
move position cursor
move down 60px # adjust if some menus still don't fit
}
&lt;/code>&lt;/pre>
&lt;p>Конфигурацию &lt;code>waybar&lt;/code> поместил в &lt;code>~/.config/sway/other/waybar&lt;/code>.&lt;/p>
&lt;h3 id="уведомления">&lt;span class="section-num">5.5&lt;/span> Уведомления&lt;/h3>
&lt;p>Используется &lt;a href="https://github.com/emersion/mako" target="_blank" rel="noopener">mako&lt;/a>.&lt;/p>
&lt;pre>&lt;code class="language-shell">emerge -v gui-apps/mako
&lt;/code>&lt;/pre>
&lt;p>Сконфигурировал следующим образом:&lt;/p>
&lt;pre>&lt;code class="language-conf-unix"># ~/.config/sway/config.d/80-mako.conf
# Light
exec_always mako --font 'Source Code Pro 10' --background-color '#fdf6e3' --text-color '#657b83' --default-timeout 5000 --width 400 --markup 1 --border-radius 5
# Dark
# exec_always mako --font 'Source Code Pro 10' --background-color '#002b36' --text-color '#839496' --default-timeout 5000 --width 400 --markup 1 --border-radius 5
&lt;/code>&lt;/pre>
&lt;h3 id="настройка-вывода">&lt;span class="section-num">5.6&lt;/span> Настройка вывода&lt;/h3>
&lt;p>В XWindow используется программа &lt;code>xrandr&lt;/code> (с её помощью можно изменять параметры вывода изображения RandR). В &lt;code>sway&lt;/code> можно управлять с помощью &lt;code>swaymsg output&lt;/code> или с помощью утилиты &lt;a href="https://github.com/emersion/wlr-randr" target="_blank" rel="noopener">wlr-randr&lt;/a>.&lt;/p>
&lt;pre>&lt;code class="language-shell">emerge -v gui-apps/wlr-randr
&lt;/code>&lt;/pre>
&lt;h3 id="меню-программ--launcher">&lt;span class="section-num">5.7&lt;/span> Меню программ (launcher)&lt;/h3>
&lt;p>Для запуска программы используется &lt;code>dmenu&lt;/code>. Если не нравится, можно заменить.&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://hg.sr.ht/~scoopta/wofi" target="_blank" rel="noopener">wofi&lt;/a> &amp;mdash; аналог &lt;code>rofi&lt;/code> для Wayland. Попроще, конечно.&lt;/li>
&lt;/ul>
&lt;!--listend-->
&lt;pre>&lt;code class="language-shell">emerge -v gui-apps/wofi
&lt;/code>&lt;/pre>
&lt;p>В отличии от &lt;code>dmenu&lt;/code> запоминает последние выбранные команды.&lt;/p>
&lt;p>Общая конфигурация:&lt;/p>
&lt;pre>&lt;code class="language-conf-unix"># ~/.config/sway/config.d/80-launcher.conf
# dmenu
set $menu dmenu_path | dmenu | xargs swaymsg exec --
# wofi
# --show &amp;lt;mode&amp;gt;
# &amp;lt;mode&amp;gt;:
# - `run` - searches $PATH for executables and allows them to be run by selecting them.
# - `drun` - searches $XDG_DATA_HOME/applications and $XDG_DATA_DIRS/applications for desktop files and allows them to be run by selecting them.
# - `dmenu` - reads from stdin and displays options which when selected will be output to stdout.
# set $menu dmenu_path | wofi -c ~/.config/sway/other/wofi/config -s ~/.config/sway/other/wofi/style.css --show dmenu | xargs swaymsg exec --
# rofi
# set $menu rofi -combi-modi window#drun -show combi -modi combi -show-icons
# set $menu rofi -m $(swaymsg -t get_outputs | jq 'map(select(.active) | .focused) | index(true)') -show combi -modi combi -combi-modi window#drun -show-icons -run-command 'swaymsg exec -- {cmd}'
# gmenu
# set $menu gtkmenu --width 500 --height 260 -no-generic
# set $menu nwggrid
# bemenu
# set $menu j4-dmenu-desktop --dmenu=&amp;quot;bemenu-run.sh -l 30&amp;quot; --term=&amp;quot;alacritty&amp;quot; --no-generic
# Start your launcher
bindsym $mod+d exec $menu
&lt;/code>&lt;/pre>
&lt;h3 id="буфер-обмена">&lt;span class="section-num">5.8&lt;/span> Буфер обмена&lt;/h3>
&lt;p>Предлагается использовать &lt;a href="https://github.com/bugaevc/wl-clipboard" target="_blank" rel="noopener">wl-clipboard&lt;/a>.&lt;/p>
&lt;pre>&lt;code class="language-shell">emerge -v gui-apps/wl-clipboard
&lt;/code>&lt;/pre>
&lt;p>Пакет содержит две утилиты: &lt;code>wl-copy&lt;/code> и &lt;code>wl-paste&lt;/code>.&lt;/p>
&lt;p>Пример использования:&lt;/p>
&lt;pre>&lt;code class="language-shell"># copy a simple text message
$ wl-copy Hello world!
# copy the list of files in Downloads
$ ls ~/Downloads | wl-copy
# copy an image file
$ wl-copy &amp;lt; ~/Pictures/photo.png
# paste to a file
$ wl-paste &amp;gt; clipboard.txt
# grep each pasted word in file source.c
$ for word in $(wl-paste); do grep $word source.c; done
# copy the previous command
$ wl-copy &amp;quot;!!&amp;quot;
# replace the current selection with the list of types it's offered in
$ wl-paste --list-types | wl-copy
&lt;/code>&lt;/pre>
&lt;h3 id="блокировка-экрана">&lt;span class="section-num">5.9&lt;/span> Блокировка экрана&lt;/h3>
&lt;h4 id="swaylock">&lt;span class="section-num">5.9.1&lt;/span> swaylock&lt;/h4>
&lt;!--list-separator-->
&lt;ol>
&lt;li>
&lt;p>Общая информация&lt;/p>
&lt;ul>
&lt;li>Официальное приложение для блокировки экрана для &lt;em>Sway&lt;/em> &amp;mdash; &lt;em>swaylock&lt;/em>.&lt;/li>
&lt;li>Репозиторий: &lt;a href="https://github.com/swaywm/swaylock" target="_blank" rel="noopener">https://github.com/swaywm/swaylock&lt;/a>&lt;/li>
&lt;li>Установка:
&lt;ul>
&lt;li>Gentoo:
&lt;pre>&lt;code class="language-shell">emerge gui-apps/swaylock
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>В информационной панеле &lt;em>waybar&lt;/em> есть опция для отключения блокировки при простое (например, для демонстрации слайдов).&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;!--list-separator-->
&lt;ol start="2">
&lt;li>
&lt;p>Блокировка при простое&lt;/p>
&lt;ul>
&lt;li>Заблокировать экран после 300 секунд бездействия.&lt;/li>
&lt;li>Затем выключить дисплей ещё через 300 секунд.&lt;/li>
&lt;li>Включить экран при возобновлении работы.&lt;/li>
&lt;li>Также заблокировать экран перед тем, как компьютер перейдет в спящий режим.&lt;/li>
&lt;li>Конфигурационный файл:
&lt;pre>&lt;code class="language-conf-unix">### ~/.config/sway/config.d/80-lock.conf
### Idle lock
## - Lock your screen after 300 seconds of inactivity
## - Then turn off your displays after another 300 seconds
## - Turn your screens back on when resumed
## - Also lock your screen before your computer goes to sleep
exec swayidle -w \
timeout 300 'swaylock -f -c 000000 -k' \
timeout 600 'swaymsg &amp;quot;output * dpms off&amp;quot;' \
resume 'swaymsg &amp;quot;output * dpms on&amp;quot;' \
before-sleep 'swaylock -f -c 000000 -k'
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;!--list-separator-->
&lt;ol start="3">
&lt;li>
&lt;p>Ручная блокировка&lt;/p>
&lt;ul>
&lt;li>&lt;code>Mod&lt;/code> + &lt;code>Ctrl&lt;/code> + &lt;code>l&lt;/code> для немедленной блокировки экрана.&lt;/li>
&lt;li>Через 10 секунд выключить экран.&lt;/li>
&lt;li>Конфигурационный файл:
&lt;pre>&lt;code class="language-conf-unix">### ~/.config/sway/config.d/80-lock.conf
### Manual lock
## - Mod + Ctrl + l to lock the screen immediately
## - In 10 sec also switch the screen off
set $lockman exec bash ~/.config/sway/scripts/lockman.sh
bindsym $mod+Ctrl+l exec $lockman
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Скрипт блокировки:
&lt;pre>&lt;code class="language-shell">#!/bin/bash
# ~/.config/sway/scripts/lockman.sh
# Times the screen off and puts it to background
swayidle \
timeout 10 'swaymsg &amp;quot;output * dpms off&amp;quot;' \
resume 'swaymsg &amp;quot;output * dpms on&amp;quot;' &amp;amp;
# Locks the screen immediately
swaylock -c 550000 -k
# Kills last background task so idle timer doesn't keep running
kill %%
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h4 id="swaylock-effects">&lt;span class="section-num">5.9.2&lt;/span> swaylock-effects&lt;/h4>
&lt;ul>
&lt;li>&lt;em>swaylock-effects&lt;/em> является форком &lt;em>swaylock&lt;/em>:
&lt;ul>
&lt;li>Репозиторий: &lt;a href="https://github.com/mortie/swaylock-effects" target="_blank" rel="noopener">https://github.com/mortie/swaylock-effects&lt;/a>&lt;/li>
&lt;li>Добавляет встроенные скриншоты и эффекты манипулирования изображениями, такие как размытие.&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="совместимость-приложений">&lt;span class="section-num">6&lt;/span> Совместимость приложений&lt;/h2>
&lt;h3 id="java">&lt;span class="section-num">6.1&lt;/span> Java&lt;/h3>
&lt;h4 id="серое-окно-приложения-не-меняют-размер-с-помощью-wm-меню-сразу-закрываются">&lt;span class="section-num">6.1.1&lt;/span> Серое окно, приложения не меняют размер с помощью WM, меню сразу закрываются&lt;/h4>
&lt;ul>
&lt;li>В стандартных тулкитах для Java жестко зашит список оконных менеджеров.&lt;/li>
&lt;li>Следует установить переменную окружения:
&lt;pre>&lt;code class="language-shell">export _JAVA_AWT_WM_NONREPARENTING=1
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;h4 id="меню-в-приложениях-плавает-отдельно-им-невозможно-пользоваться">&lt;span class="section-num">6.1.2&lt;/span> Меню в приложениях плавает отдельно, им невозможно пользоваться&lt;/h4>
&lt;ul>
&lt;li>В выпусках Java до версии 9 GTK интерфейс ориентирован на GTK2, в последующих версиях на GTK3.&lt;/li>
&lt;li>GTK LookAndFeel может работать с GTK версий 2, 2.2 и 3.&lt;/li>
&lt;li>По умолчанию используется GTK3.&lt;/li>
&lt;li>Следует явно задать более старую версию:
&lt;pre>&lt;code class="language-shell">export JAVA_TOOL_OPTIONS='-Djdk.gtk.version=2.2'
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>Например, в файле &lt;code>~/.profile&lt;/code>:
&lt;pre>&lt;code class="language-shell">if [ &amp;quot;$XDG_SESSION_DESKTOP&amp;quot; = &amp;quot;sway&amp;quot; ] || [ &amp;quot;$XDG_SESSION_DESKTOP&amp;quot; = &amp;quot;i3&amp;quot; ]
then
# https://github.com/swaywm/sway/issues/595
export _JAVA_AWT_WM_NONREPARENTING=1
export JAVA_TOOL_OPTIONS='-Djdk.gtk.version=2.2'
fi
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;h3 id="приложения-gtk-plus-запускаются-с-задержкой">&lt;span class="section-num">6.2&lt;/span> Приложения GTK+ запускаются с задержкой&lt;/h3>
&lt;ul>
&lt;li>Приложения GTK+ ожидают запуск &lt;code>xdg-desktop-portal&lt;/code> через D-Bus.&lt;/li>
&lt;li>Ожидание прекращается по таймауту потому, что активированная служба D-Bus не знает, к какому &lt;code>WAYLAND_DISPLAY&lt;/code> подключиться.&lt;/li>
&lt;li>Это можно исправить, добавив в файл конфигурации следующее:
&lt;pre>&lt;code class="language-shell">exec systemctl --user import-environment DISPLAY WAYLAND_DISPLAY SWAYSOCK
exec hash dbus-update-activation-environment 2&amp;gt;/dev/null &amp;amp;&amp;amp; dbus-update-activation-environment --systemd DISPLAY WAYLAND_DISPLAY SWAYSOCK
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;h3 id="qt-приложения">&lt;span class="section-num">6.3&lt;/span> Qt приложения&lt;/h3>
&lt;ul>
&lt;li>Qt по умолчанию использует бэкэнд X11 вместо собственного бэкэнда Wayland. Чтобы использовать бэкэнд Wayland, установите &lt;code>QT_QPA_PLATFORM=wayland&lt;/code>.&lt;/li>
&lt;li>Qt прорисовает оформление окон на стороне клиента. Чтобы отключить это, установите &lt;code>QT_WAYLAND_DISABLE_WINDOWDECORATION=&amp;quot;1&amp;quot;&lt;/code>.&lt;/li>
&lt;/ul></description></item><item><title>amd64 и flash</title><link>https://yamadharma.github.io/ru/post/2006/09/24/amd64-i-flash/</link><pubDate>Sun, 24 Sep 2006 15:19:00 +0000</pubDate><guid>https://yamadharma.github.io/ru/post/2006/09/24/amd64-i-flash/</guid><description>&lt;p>Попробовал использовать сначала &lt;code>nspluginwrapper&lt;/code>. Работает хорошо. Через &lt;code>qemu&lt;/code>. Но &lt;code>qemu&lt;/code>, откомпилированный &lt;code>gcc-4&lt;/code>, не работает. Поэтому пришлось перейти на &lt;code>gnash&lt;/code>. Snapshot августовский не откомпилировался. Июньский нормально, но нет звука. Поставил из cvs &amp;mdash; проблемы с прозрачностью. Звука тоже нет.&lt;/p></description></item><item><title>Monit и gentoo rc-scripts</title><link>https://yamadharma.github.io/ru/post/2006/09/17/monit-i-gentoo-rc-scripts/</link><pubDate>Sun, 17 Sep 2006 20:55:00 +0000</pubDate><guid>https://yamadharma.github.io/ru/post/2006/09/17/monit-i-gentoo-rc-scripts/</guid><description>&lt;p>При использовании monit для перезапуска rc-скриптов в gentoo использовал killall и опцию zap.&lt;br>
Нашёл это-же решение, но оформленное красивее.&lt;/p>
&lt;p>Это файл /etc/monit.d/bin/kickservice&lt;/p>
&lt;pre>&lt;code class="language-bash">##!/bin/sh
## kickservice by Eric Radman
## Script used by monit to kill off and restart daemons
## /etc/monit.d/bin/kickservice
function stop ()
{
    /etc/init.d/$1 pause
    /etc/init.d/$1 zap
    if [ &amp;quot;$2&amp;quot; == &amp;quot;kill&amp;quot; ]
        then
        /bin/killall $3
    fi
}
function start ()
{
    /etc/init.d/$1 zap
    /etc/init.d/$1 start
}
case &amp;quot;$1&amp;quot; in
start)
    start $2 $3 $4
    ;;
stop)
    stop $2 $3 $4
    ;;
*)
    echo &amp;quot;Usage: kickservice [start|stop] [service] kill [daemon]&amp;quot;
    ;;
esac
&lt;/code>&lt;/pre>
&lt;p>Проблема возникла из-за того, что при установке baselayout-1.12.x перестал нормально работать pppd (при подключении через pptp к VPN-серверу провайдера). Очень часто соединение не устанавливается (вина, думаю, провайдерского сервера). По идее после этого он должен перезапускаться, а он просто ничего не делал. Решил снять проблему с помощью monit.&lt;br>
Убрал net.ppp0 из загрузки, и заставил monit мониторить ppp0.&lt;/p>
&lt;p>Вот скрипт /etc/monit.d/ppp0&lt;/p>
&lt;pre>&lt;code class="language-bash">check process pppd with pidfile /var/run/ppp0.pid
   start program = &amp;quot;/etc/monit.d/bin/kickservice start net.ppp0&amp;quot;
   stop program = &amp;quot;/etc/monit.d/bin/kickservice stop net.ppp0 kill pppd&amp;quot;
  if 5 restarts within 5 cycles then timeout
&lt;/code>&lt;/pre>
&lt;p>P. S. Хотел запостить скрипты, но не знаю как :(&lt;/p></description></item><item><title>Openoffice on amd64</title><link>https://yamadharma.github.io/ru/post/2006/09/04/openoffice-on-amd64/</link><pubDate>Mon, 04 Sep 2006 09:16:00 +0000</pubDate><guid>https://yamadharma.github.io/ru/post/2006/09/04/openoffice-on-amd64/</guid><description>&lt;p>Вчера откомпилил openoffice-2.0.4_rc1-r1 под amd64.&lt;/p></description></item><item><title>Gentoo: конвертация из x86 в x86_64 (2)</title><link>https://yamadharma.github.io/ru/post/2006/08/21/gentoo-konvertatsija-iz-x86-v-x86-64-2/</link><pubDate>Mon, 21 Aug 2006 12:19:00 +0000</pubDate><guid>https://yamadharma.github.io/ru/post/2006/08/21/gentoo-konvertatsija-iz-x86-v-x86-64-2/</guid><description>&lt;ol>
&lt;li>Провозившись с данной проблемой выходные (и частично неделю),
провёл конвертацию.&lt;/li>
&lt;li>Оказалось, что всё очень просто.&lt;/li>
&lt;li>Однако, после начала обновления системы (&lt;code>emerge -e system&lt;/code>), стали
отваливаться приложения (не могут подгрузить библиотеки).&lt;/li>
&lt;li>К сожалению, в новом профайле не поддерживается построение
библиотек под несколько архитектур (может, просто я не знаю).&lt;/li>
&lt;li>Хотя в консоли всё функционирует нормально.&lt;/li>
&lt;li>Скоро, надеюсь, всё конвертну.&lt;/li>
&lt;/ol></description></item><item><title>Gentoo: конвертация из x86 в x86_64</title><link>https://yamadharma.github.io/ru/post/2006/08/18/gentoo-konvertatsija-iz-x86-v-x86-64/</link><pubDate>Fri, 18 Aug 2006 09:21:00 +0000</pubDate><guid>https://yamadharma.github.io/ru/post/2006/08/18/gentoo-konvertatsija-iz-x86-v-x86-64/</guid><description>&lt;ol>
&lt;li>На недавно обновлённом компьютере (до этого был Pentium III)
крутится 32-битная ОС (Gentoo Linux) (Hurd и Plan9 не учитываю).&lt;/li>
&lt;li>Решил конвертнуть в 64-битную. Однако документации по этому вопросу
не нашёл.&lt;/li>
&lt;li>Так-что решил заняться самодеятельностью. Как получится, напишу об этом (с приложением скриптов).&lt;/li>
&lt;/ol></description></item></channel></rss>