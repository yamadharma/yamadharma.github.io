---
title: "Cisco. Защита от широковещательного шторма"
author: ["Dmitry S. Kulyabov"]
date: 2021-06-16T11:48:00+03:00
lastmod: 2023-10-06T17:07:00+03:00
tags: ["cisco", "network", "sysadmin"]
categories: ["computer-science"]
draft: false
slug: "cisco-storm-control"
---

Для борьбы с широковещательным штормом в сетевых устройствах Cisco используется параметр `storm-control`.

<!--more-->

{{< toc >}}


## <span class="section-num">1</span> Описание {#описание}

-   Параметр `storm-control` задаёт количество бродкастов в секунду.
-   Всё, что свыше этого значения, отбрасывается.
-   Порт при этом продолжает работать для пересылки всего остального трафика.
-   В случае высокого значения `storm-contorol` можно получить перегрузку ЦПУ коммутатора, в случае низкого значения можно иметь проблемы с работой DHCP и ARP.


## <span class="section-num">2</span> Настройка {#настройка}


### <span class="section-num">2.1</span> Задание порогов срабатывания {#задание-порогов-срабатывания}

-   Максимальный уровень широковещательного трафика задаётся либо в процентах от полосы пропускания (безразмерные значения), либо в битах в секунду (bps).
-   Есть два варианта конфигурирования:
    -   однопороговое,
    -   двупороговое.


#### <span class="section-num">2.1.1</span> Однопороговый вариант {#однопороговый-вариант}

-   Задаётся максимальный порог и действие по достижении этого порога:
    ```shell
    (config)# int f0/1
    (config-if)# storm-control broadcast level 30.00
    (config-if)# storm-control multicast level 30.00
    ```
-   Команда устанавливает максимальный уровень широковещательного трафика в 30% от полосы пропускания.


#### <span class="section-num">2.1.2</span> Двупороговый вариант {#двупороговый-вариант}

-   Указывается два порога.
-   При достижении первого порога порт будет отключаться.
-   При падении уровня трафика до второго порога порт будет включаться:
    ```shell
    (config-if)# storm-control broadcast level 30.00 10.00
    (config-if)# storm-control multicast level 30.00 10.00
    ```
-   Здесь первый порог --- 30% от полосы пропускания, второй порог --- 10% от полосы пропускания.


### <span class="section-num">2.2</span> Реакция на шторм {#реакция-на-шторм}

-   Необходимо задать действие при возникновении шторма
    ```shell
    (config)# int f0/1
    (config-if)# storm-control action shutdown
    ```
-   Вторая команда указывает на то, какое действие должно быть совершено, когда лимит будет достигнут. В данном случае мы отключаем порт (`shutdown`).
-   Если действие не указывать, то свитч будет просто фильтровать трафик, превышающий порог, и не отправлять никаких оповещений.
-   Можно включить SNMP-трапы и сообщения в Syslog:
    ```shell
    (config-if)# storm-control action trap
    ```


### <span class="section-num">2.3</span> Восстановление портов {#восстановление-портов}

-   Чтобы коммутатор автоматически восстанавливал порт через некоторое время после отключения, необходимо в глобальной конфигурации задать:
    ```shell
    (config)# errdisable recovery cause storm-control
    (config)# errdisable recovery interval 180
    ```
-   В данном случае восстановление происходит через 3 минуты (180 секунд).


### <span class="section-num">2.4</span> Обнаружение петель {#обнаружение-петель}

-   У коммутаторов Cisco есть также штатное средство обнаружения петель, основанное на периодической отправке keepalive-сообщений.
-   Эта опция обычно включена по умолчанию, и в случае срабатывания порт отключается.
-   Для механизма keepalive можно также настроить автоматическое включение интерфейса:
    ```shell
    (config)# errdisable recovery cause loopback
    ```


### <span class="section-num">2.5</span> Настройка на все порты сразу {#настройка-на-все-порты-сразу}

-   Для настройки параметров всех портов сразу используйте _диапазон портов_:
    ```shell
    (config)# interface range f0/1 - 24
    (config-if-range)# storm-control broadcast level 30.00 10.00
    ```


## <span class="section-num">3</span> Проверка работы {#проверка-работы}

-   Используйте команду `show storm-control`, чтобы проверить конфигурацию функции подавления широковещательной и многоадресной рассылки.
-   Используйте команду `show storm-control <интерфейс>`, чтобы проверить конфигурацию функции подавления широковещательной и многоадресной рассылки на интерфейсе.
-   Используйте команду `show run interface <интерфейс>`, чтобы проверить ловушку (trap), настроенную для порта.
